<!DOCTYPE html>
<html>
  <head>
    <title>Medication Reconciliation Tool</title>
    <style>
      /* Base styles and layout */
      * {
        font-family: Verdana, sans-serif;
        font-size: 10pt;
      }

      /* Container styling for split-screen layout */
      .container {
        display: flex;
        justify-content: space-between;
      }

      /* Column styling for each medication list */
      .column {
        width: 48%;
        padding: 10px;
        border: 1px solid #ccc;
      }

      /* Individual medication entry styling */
      .medication-entry {
        margin-bottom: 10px;
        padding: 5px;
        background-color: #f0f0f0;
      }

      /* Table styling for formatted display */
      .data-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 10px;
      }

      .data-table th,
      .data-table td {
        border: 1px solid #ddd;
        padding: 8px;
        text-align: left;
      }

      .data-table th {
        background-color: #f2f2f2;
      }

      /* Utility classes */
      .hidden {
        display: none;
      }

      .error-row {
        background-color: #ffe6e6;
      }

      .merged-row {
        background-color: #e6ffe6;
      }

      /* Input area styling */
      textarea {
        width: 100%;
        font-family: Verdana, sans-serif;
        font-size: 10pt;
        white-space: pre;
      }

      /* Button styling */
      button {
        margin: 5px;
        padding: 5px 10px;
        background-color: #4caf50;
        color: white;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }

      button:hover {
        background-color: #45a049;
      }

      /* Comparison Results Styling */
      #comparisonResults {
        margin: 20px;
        padding: 20px;
        border: 1px solid #ccc;
        border-radius: 4px;
        background-color: #fff;
      }

      #comparisonResults h2 {
        color: #333;
        margin-bottom: 20px;
        text-align: center;
        font-size: 12pt;
      }

      #comparisonResults h3 {
        color: #666;
        margin: 15px 0;
        padding-bottom: 5px;
        border-bottom: 2px solid #4caf50;
        font-size: 11pt;
      }

      #comparisonResults .data-table {
        margin-bottom: 30px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      #comparisonResults .data-table th {
        background-color: #4caf50;
        color: white;
      }

      #comparisonResults .data-table tr:nth-child(even) {
        background-color: #f9f9f9;
      }

      #comparisonResults .data-table tr:hover {
        background-color: #f5f5f5;
      }

      /* Report container styling */
      .report-container {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: white;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
        max-width: 90%;
        max-height: 90vh;
        overflow-y: auto;
        z-index: 1000;
      }

      .report-table td {
        padding: 12px;
      }

      .report-controls {
        margin-top: 20px;
        text-align: center;
        display: flex;
        justify-content: center;
        gap: 10px;
      }

      .print-btn,
      .close-btn,
      .copy-btn {
        margin: 0 10px;
        padding: 8px 16px;
        border: none;
        border-radius: 4px;
        cursor: pointer;
      }

      .print-btn {
        background-color: #4caf50;
        color: white;
      }

      .close-btn {
        background-color: #f44336;
        color: white;
      }

      .copy-btn {
        background-color: #2196f3;
        color: white;
      }

      .copy-btn:hover {
        background-color: #1976d2;
      }

      .generate-report-btn {
        background-color: #2196f3;
        color: white;
        padding: 10px 20px;
        margin-top: 20px;
      }

      /* Comparison table specific styling */
      .comparison-table {
        margin-bottom: 30px;
      }

      .medication-group td {
        background-color: #f8f8f8;
      }

      .medication-subrow td {
        border-top: 1px dashed #ddd;
      }

      .medication-detail {
        padding: 5px 0;
      }

      .medication-detail .original-name {
        font-weight: bold;
        color: #333;
      }

      .medication-detail .instructions {
        color: #666;
        margin-top: 3px;
      }

      .medication-detail .comments {
        color: #888;
        margin-top: 3px;
        font-style: italic;
        font-size: 0.9em;
      }

      /* Table cell styling */
      .comments-cell {
        min-width: 200px;
        background-color: #fff;
      }

      .comments-cell:focus {
        outline: 2px solid #2196f3;
        padding: 11px;
      }
      .formulation-match {
        background-color: #50c878; /* Green */
        color: white;
        padding: 0 2px;
        border-radius: 2px;
      }

      .formulation-similar {
        background-color: #ff8c00; /* Orange */
        color: white;
        padding: 0 2px;
        border-radius: 2px;
      }

      .formulation-different {
        background-color: #ff4444; /* Red */
        color: white;
        padding: 0 2px;
        border-radius: 2px;
      }

      .formulation-term {
        background-color: #e0e0e0; /* Gray for single-list items */
        color: black;
        padding: 0 2px;
        border-radius: 2px;
      }
      /* Add these to your existing styles section */
      .strength-match {
        background-color: #50c878;
        color: white;
        padding: 0 2px;
        border-radius: 2px;
      }
      .strength-similar {
        background-color: #ff8c00; /* Orange */
        color: white;
        padding: 0 2px;
        border-radius: 2px;
      }
      .strength-different {
        background-color: #ff4444;
        color: white;
        padding: 0 2px;
        border-radius: 2px;
      }

      .strength-term {
        background-color: #e0e0e0;
        color: black;
        padding: 0 2px;
        border-radius: 2px;
      }
      /* Print styles */
      @media print {
        body * {
          visibility: hidden;
        }
        .report-container,
        .report-container * {
          visibility: visible;
        }
        .report-container {
          position: absolute;
          left: 0;
          top: 0;
        }
        .report-controls {
          display: none;
        }
        .report-table .comments-cell {
          border: 1px solid #ddd !important;
        }
      }
    </style>
  </head>
  <body>
    <h1>Medication Reconciliation Tool</h1>
    <div class="container">
      <div class="column">
        <h2>List 1</h2>
        <textarea
          id="list1"
          rows="20"
          cols="50"
          onpaste="handlePaste(event, 1)"
          placeholder="Paste medication list here"
        ></textarea>
        <button onclick="processList(1)">Process List 1</button>
        <div id="table1Container"></div>
      </div>
      <div class="column">
        <h2>List 2</h2>
        <textarea
          id="list2"
          rows="20"
          cols="50"
          onpaste="handlePaste(event, 2)"
          placeholder="Paste medication list here"
        ></textarea>
        <button onclick="processList(2)">Process List 2</button>
        <div id="table2Container"></div>
      </div>
    </div>
    <div style="text-align: center; margin: 20px">
      <button
        onclick="compareMedicationLists()"
        style="font-size: 1.2em; padding: 10px 20px"
      >
        Compare Lists
      </button>
    </div>
    <script>
      // Medication dictionary for future use in matching medications
      const medicationDict = {
        medications: {
          abacavir: ["abacavir", "ziagen"],
          "abacavir/lamivudine": ["abacavir/lamivudine", "kivexa", "epzicom"],
          abatacept: ["abatacept", "orencia"],
          abemaciclib: ["abemaciclib", "verzenios", "verzenio"],
          abiraterone: ["abiraterone", "zytiga"],
          acalabrutinib: ["acalabrutinib", "calquence"],
          acamprosate: ["acamprosate", "campral"],
          acarbose: ["acarbose", "glucobay"],
          accufusor: ["accufusor"],
          "accu-chek": ["accu-chek"],
          acenocoumarol: ["acenocoumarol", "sinthrome", "nicoumalone"],
          acetylcysteine: [
            "acetylcysteine",
            "parvolex",
            "nacsys",
            "n-acetylcysteine",
            "nac",
          ],
          acetazolamide: ["acetazolamide", "diamox"],
          "acetic acid": ["acetic acid"],
          acetone: ["acetone"],
          acetylcholine: ["acetylcholine"],
          aciclovir: ["aciclovir", "acyclovir", "zovirax", "acyvir"],
          "acid citrate dextrose": [
            "acid citrate dextrose",
            "Acid Cit. Dextrose",
          ],
          acipimox: ["acipimox", "olbetam"],
          acitretin: ["acitretin", "neotigason"],
          aclidinium: ["aclidinium", "eklira", "bretaris"],
          acriflex: ["acriflex"],
          actimel: ["actimel"],
          "activated charcoal": [
            "activated charcoal",
            "charcodote",
            "carbomix",
          ],
          "actifed multi-action": ["actifed multi-action"],
          adalimumab: [
            "adalimumab",
            "humira",
            "amgevita",
            "hulio",
            "hyrimoz",
            "idacio",
            "imraldi",
          ],
          adapalene: ["adapalene", "differin"],
          "additive a": ["additive a"],
          addaven: ["addaven"],
          additrace: ["additrace"],
          adenosine: ["adenosine", "adenocor"],
          adrenaline: [
            "adrenaline",
            "epinephrine",
            "anapen",
            "emerade",
            "epipen",
            "jext",
          ],
          aerochamber: ["aerochamber"],
          afatinib: ["afatinib", "giotrif"],
          aflibercept: ["aflibercept", "eylea", "zaltrap"],
          ajmaline: ["ajmaline"],
          akynzeo: ["akynzeo", "netupitant/palonosetron"],
          alaris: ["alaris"],
          albendazole: ["albendazole", "eskazole"],
          albumin: ["albumin", "alburex", "albutein", "zenalb"],
          "alcohol absolute": ["alcohol absolute"],
          alectinib: ["alectinib", "alecensa"],
          alemtuzumab: ["alemtuzumab", "lemtrada", "campath"],
          "alendronic acid": [
            "alendronic acid",
            "alendronate",
            "fosamax",
            "binosto",
          ],
          alfacalcidol: ["alfacalcidol", "one-alpha"],
          alfentanil: ["alfentanil", "rapifen"],
          alfuzosin: ["alfuzosin", "xatral", "besavar"],
          alhydran: ["alhydran"],
          alimemazine: ["alimemazine", "theralen", "vallergan"],
          alirocumab: ["alirocumab", "praluent"],
          aliskiren: ["aliskiren", "rasilez"],
          alitretinoin: ["alitretinoin", "toctino"],
          "alliance calcium": ["alliance calcium"],
          allopurinol: ["allopurinol", "zyloric", "uricto"],
          "allogenic serum": ["allogenic serum"],
          almotriptan: ["almotriptan", "almogran"],
          alogliptin: ["alogliptin", "vipidia"],
          alpelisib: ["alpelisib", "piqray"],
          "alpha tocopherol": ["alpha tocopherol", "vitamin e"],
          "alphosyl hc": ["alphosyl hc"],
          alprostadil: [
            "alprostadil",
            "caverject",
            "muse",
            "vitaros",
            "prostin VR",
          ],
          alteplase: ["alteplase", "actilyse", "metalyse"],
          altraplen: ["altraplen"],
          "aluminium chloride": [
            "aluminium chloride",
            "anhydrol forte",
            "driclor",
          ],
          "aluminium hydroxide": ["aluminium hydroxide", "alu-cap"],
          alverine: ["alverine", "spasmonal"],
          amantadine: ["amantadine", "symmetrel"],
          ambrisentan: ["ambrisentan", "volibris"],
          amersham: ["amersham"],
          amifampridine: ["amifampridine", "firdapse"],
          amikacin: ["amikacin", "amikin"],
          amiloride: ["amiloride", "amilamont"],
          "amiloride/cyclopenthiazide": [
            "amiloride/cyclopenthiazide",
            "navispare",
          ],
          aminophylline: [
            "aminophylline",
            "phyllocontin",
            "aminophylline modified release",
          ],
          "aminocaproic acid": ["aminocaproic acid"],
          amiodarone: ["amiodarone", "cordarone x"],
          amisulpride: ["amisulpride", "solian", "amipride"],
          amitriptyline: ["amitriptyline", "elavil", "tryptizol", "lentizol"],
          amlodipine: [
            "amlodipine",
            "istin",
            "amlostin",
            "vascalpha",
            "exforge",
          ],
          "ammonium chloride": ["ammonium chloride"],
          amobarbital: ["amobarbital"],
          amorolfine: ["amorolfine", "loceryl", "curanail"],
          amoxicillin: ["amoxicillin", "amoxil", "amoxycillin"],
          amphotericin: ["amphotericin", "fungizone", "ambisome", "abelcet"],
          amsacrine: ["amsacrine"],
          anagrelide: ["anagrelide", "xagrid"],
          anakinra: ["anakinra", "kineret"],
          "anaphylaxis shock pack": ["anaphylaxis shock pack"],
          anastrozole: ["anastrozole", "arimidex"],
          anbesol: ["anbesol"],
          andexanet: ["andexanet", "ondexxya"],
          androstanolone: ["androstanolone"],
          anoro: ["anoro", "umeclidinium/vilanterol"],
          "antithymocyte globulin": [
            "antithymocyte globulin",
            "a.t.g horse",
            "thymoglobuline",
            "grafalon",
          ],
          "antimicrobial mat": ["antimicrobial mat"],
          "antacid/oxetacaine": ["antacid/oxetacaine"],
          antox: ["antox"],
          anusol: ["anusol"],
          apalutamide: ["apalutamide", "erleada"],
          apixaban: ["apixaban", "eliquis"],
          apomorphine: ["apomorphine", "apo-go", "dacepton", "kinzide"],
          apraclonidine: ["apraclonidine", "iopidine"],
          apremilast: ["apremilast", "otezla"],
          aprepitant: ["aprepitant", "emend"],
          aproderm: ["aproderm"],
          aptamil: ["aptamil"],
          "arachis oil": ["arachis oil", "peanut oil"],
          argatroban: ["argatroban", "exembol"],
          argipressin: ["argipressin", "synthetic vasopressin", "empressin"],
          arginine: ["arginine", "l-arginine"],
          aripiprazole: ["aripiprazole", "abilify", "abilify maintena"],
          "arsenic trioxide": ["arsenic trioxide", "trisenox"],
          artesunate: ["artesunate"],
          arthrotec: ["arthrotec", "diclofenac/misoprostol"],
          "articaine/adrenaline": ["articaine/adrenaline", "septanest"],
          "artificial saliva": [
            "artificial saliva",
            "biotene",
            "glandosane",
            "saliveze",
          ],
          asasantin: ["asasantin", "dipyridamole/aspirin"],
          "ascorbic acid": ["ascorbic acid", "vitamin c"],
          "ascorbic acid/zinc": ["ascorbic acid/zinc"],
          asciminib: ["asciminib", "scemblix"],
          asenapine: ["asenapine", "sycrest"],
          asparaginase: ["asparaginase", "spectrila", "erwinase"],
          aspirin: [
            "aspirin",
            "acetylsalicylic acid",
            "caprin",
            "micropirin",
            "nu-seals",
            "dispersible aspirin",
          ],
          atazanavir: ["atazanavir", "reyataz"],
          atenolol: ["atenolol", "tenormin", "beta-cardone"],
          atezolizumab: ["atezolizumab", "tecentriq"],
          atogepant: ["atogepant", "aquipta"],
          atomoxetine: ["atomoxetine", "strattera"],
          atorvastatin: ["atorvastatin", "lipitor"],
          atosiban: ["atosiban", "tractocile"],
          atovaquone: ["atovaquone", "wellvone"],
          "atovaquone/proguanil": ["atovaquone/proguanil", "malarone"],
          atracurium: ["atracurium", "atracurium besilate", "tracrium"],
          atropine: ["atropine", "atropine sulphate", "minims atropine"],
          autodrop: ["autodrop"],
          autosqueeze: ["autosqueeze"],
          avacopan: ["avacopan", "tavneos"],
          avanafil: ["avanafil", "spedra"],
          avatrombopag: ["avatrombopag", "doptelet"],
          aveeno: ["aveeno"],
          avelumab: ["avelumab", "bavencio"],
          "aviptadil/phentolamine": ["aviptadil/phentolamine", "invicorp"],
          axitinib: ["axitinib", "inlyta"],
          "aymes actasolve": ["aymes actasolve"],
          "aymes actagain": ["aymes actagain"],
          "aymes shake": ["aymes shake"],
          azacitidine: ["azacitidine", "vidaza"],
          azarga: ["azarga", "brinzolamide/timolol"],
          azathioprine: ["azathioprine", "imuran"],
          azelastine: ["azelastine", "optilast", "rhinolast", "dymista"],
          "azelaic acid": ["azelaic acid", "finacea", "skinoren"],
          azithromycin: ["azithromycin", "zithromax"],
          azowipes: ["azowipes"],
          aztreonam: ["aztreonam", "azactam", "cayston"],
          "b-ketone": ["b-ketone"],
          baclofen: ["baclofen", "lioresal", "lyflex", "gablofen"],
          "prescription bag": ["prescription bag"],
          "bum bag": ["bum bag"],
          "brown bag": ["brown bag"],
          "sterile ziplock bag": ["sterile ziplock bag"],
          "balanced salt solution": ["balanced salt solution", "bss"],
          balneum: ["balneum"],
          balsalazide: ["balsalazide", "colazide"],
          bambuterol: ["bambuterol", "bambec"],
          baricitinib: ["baricitinib", "olumiant"],
          "barium sulphate": ["barium sulphate", "baritop"],
          "baxa pharmacy dispensing pin": ["baxa pharmacy dispensing pin"],
          "baxter infusor": ["baxter ce", "baxter infusor"],
          bcg: ["bcg", "bcg tice", "bcg-medac", "connaught bcg", "onco-tice"],
          beclometasone: [
            "beclometasone",
            "clenil",
            "qvar",
            "kelhale",
            "beclomethasone",
            "asmabec",
            "beconase",
            "soprobec",
          ],
          bedaquiline: ["bedaquiline", "sirturo"],
          belantamab: ["belantamab mafodotin", "blenrep"],
          belimumab: ["belimumab", "benlysta"],
          "bempedoic acid": ["bempedoic acid", "nilemdo"],
          "bempedoic/ezetimibe": [
            "bempedoic/ezetimibe",
            "bempedoic acid/ezetimibe",
            "nustendi",
          ],
          bendamustine: ["bendamustine", "levact"],
          bendroflumethiazide: [
            "bendroflumethiazide",
            "bendrofluazide",
            "aprinox",
            "neo-naclex",
          ],
          benperidol: ["benperidol", "anquil"],
          benralizumab: ["benralizumab", "fasenra"],
          benzydamine: ["benzydamine", "difflam"],
          benzylpenicillin: ["benzylpenicillin", "penicillin g", "crystapen"],
          "benzathine penicillin": ["benzathine penicillin", "Benzathine Pen"],
          benzbromarone: ["benzbromarone"],
          beriplex: ["beriplex"],
          berotralstat: ["berotralstat", "orladeyo"],
          betamethasone: [
            "betamethasone",
            "betnesol",
            "betnovate",
            "beta-gel",
            "betacap",
            "betesil",
            "betnovate-rd",
            "vistamethasone",
          ],
          betaxolol: ["betaxolol", "betoptic"],
          betahistine: ["betahistine", "serc"],
          betaine: ["betaine", "cystadane"],
          "betamethasone/clioquinol": [
            "betamethasone/clioquinol",
            "betnovate-c",
          ],
          "betamethasone/neomycin": [
            "betamethasone/neomycin",
            "betnovate-n",
            "Betnesol-N",
          ],
          bevacizumab: ["bevacizumab", "avastin", "mvasi", "zirabev"],
          bexarotene: ["bexarotene", "targretin"],
          bezafibrate: ["bezafibrate", "bezalip", "fibrazate"],
          bicalutamide: ["bicalutamide", "casodex"],
          "bictegravir/emtricitabine/tenofovir": [
            "bictegravir/emtricitabine/tenofovir",
            "biktarvy",
          ],
          bimatoprost: ["bimatoprost", "lumigan", "ganfort"],
          biocide: ["biocide"],
          biotin: ["biotin", "vitamin h", "vitamin b7"],
          bisacodyl: ["bisacodyl", "dulcolax"],
          bismuth: ["bismuth salicylate", "bismuth iodoform", "de-noltab"],
          bisoprolol: ["bisoprolol", "cardicor", "congescor"],
          bivalirudin: ["bivalirudin", "angiox"],
          bleomycin: ["bleomycin", "bleo-kyowa"],
          blinatumomab: ["blinatumomab", "blincyto"],
          boceprevir: ["boceprevir", "victrelis"],
          "boric acid": ["boric acid"],
          bortezomib: ["bortezomib", "velcade"],
          bosentan: ["bosentan", "tracleer"],
          bosutinib: ["bosutinib", "bosulif"],
          "botulinum toxin": [
            "botulinum a",
            "botulinum b",
            "dysport",
            "botox",
            "xeomin",
            "vistabel",
            "bocouture",
            "neurobloc",
          ],
          brentuximab: ["brentuximab vedotin", "adcetris"],
          brevinor: ["brevinor"],
          brigatinib: ["brigatinib", "alunbrig"],
          brimonidine: ["brimonidine", "alphagan", "mirvaso"],
          brinzolamide: ["brinzolamide", "azopt"],
          brivaracetam: ["brivaracetam", "briviact"],
          brodalumab: ["brodalumab", "kyntheum"],
          brolucizumab: ["brolucizumab", "beovu"],
          bromocriptine: ["bromocriptine", "parlodel"],
          bromfenac: ["bromfenac", "yellox"],
          budesonide: [
            "pulmicort",
            "budelin",
            "rhinocort",
            "entocort",
            "budenofalk",
          ],
          "budesonide/formoterol": [
            "budesonide/formoterol",
            "symbicort",
            "duoresp",
            "fobumix",
            "wockair",
          ],
          "buffered sodium chloride": ["buffered sodium chloride"],
          bumetanide: ["bumetanide"],
          bupivacaine: ["bupivacaine", "marcain"],
          "bupivacaine/adrenaline": [
            "bupivacaine/adrenaline",
            "marcain with adrenaline",
          ],
          "bupivacaine/fentanyl": ["bupivacaine/fentanyl"],
          buprenorphine: [
            "buprenorphine",
            "subutex",
            "temgesic",
            "butrans",
            "bupeaze",
            "buvidal",
            "prefibin",
            "transtec",
          ],
          bupropion: ["bupropion", "zyban"],
          buserelin: ["buserelin", "suprecur", "suprefact"],
          buspirone: ["buspirone", "buspar"],
          busulfan: ["busulfan", "myleran", "busilvex"],
          "c1-esterase inhibitor": [
            "c1-esterase inhibitor",
            "cinryze",
            "berinert",
            "ruconest",
          ],
          cabazitaxel: ["cabazitaxel", "jevtana"],
          cabergoline: ["cabergoline", "dostinex"],
          cabozantinib: ["cabozantinib", "cabometyx", "cometriq"],
          cabotegravir: ["cabotegravir", "vocabria"],
          caffeine: [
            "caffeine citrate",
            "caffeine sodium benzoate",
            "caffeine na benzoate",
            "peyona",
          ],
          calamine: ["calamine"],
          "calcipotriol/betamethasone": [
            "calcipotriol/betamethasone",
            "enstilar",
            "dovobet",
            "xamiol",
          ],
          calcipotriol: ["calcipotriol"],
          "calcium acetate": [
            "calcium acetate",
            "phosex",
            "renacet",
            "phylorinol",
          ],
          "calcium carbonate": [
            "calcium carbonate",
            "calcium",
            "Calcium Carb.",
            "adcal",
            "calcichew",
            "cacit",
            "caltrate",
            "calcium-500",
          ],
          "calcium chloride": ["calcium chloride"],
          "calcium gluconate": ["calcium gluconate"],
          "calcium/vitamin d3": [
            "calcium/vitamin d3",
            "Accrete D3",
            "Accrete-D3",
            "calceos",
            "Calcium Carb/Vit D3",
            "calcium carbonate/colecal",
            "Calc Carb/Vit D3",
            "calcium/colecalciferol",
            "calc/colecalciferol",
            "calcium/colecalciferol",
            "calcichew d3",
            "calfovit d3",
            "cacit d3",
            "calcium/vitamin d3",
            "calcichew-d3",
            "calfovit-d3",
            "cacit-d3",
            "adcal-d3",
            "calceos",
            "natecal",
            "calcichew d3 forte",
            "evacal d3",
          ],
          "calcium/ergocalciferol": ["calcium/ergocalciferol"],
          calcitonin: ["calcitonin", "calcitonin salmon", "miacalcic"],
          calcitriol: ["calcitriol", "rocaltrol", "silkis"],
          calmurid: ["calmurid"],
          calogen: ["calogen"],
          calotherm: ["calotherm", "caloclear"],
          canagliflozin: ["canagliflozin", "invokana"],
          candesartan: ["candesartan", "amias", "atacand"],
          cannabidiol: ["cannabidiol", "epidyolex", "sativex"],
          capasal: ["capasal"],
          capd: ["capd balance", "capd sleep safe", "capd stay safe"],
          capecitabine: ["capecitabine", "xeloda"],
          caphosol: ["caphosol"],
          caplacizumab: ["caplacizumab", "cablivi"],
          capsaicin: ["capsaicin", "zacin", "axsain", "qutenza"],
          captopril: ["captopril", "capoten", "ecopace"],
          carbomer: [
            "carbomer",
            "viscotears",
            "gel tears",
            "clinitas carbomer",
          ],
          carbamazepine: ["carbamazepine", "tegretol", "carbagen"],
          carbimazole: ["carbimazole", "neomercazole"],
          carbocisteine: ["carbocisteine", "mucodyne"],
          carboplatin: ["carboplatin", "paraplatin"],
          carboprost: ["carboprost", "hemabate"],
          carbex: ["carbex"],
          carfilzomib: ["carfilzomib", "kyprolis"],
          cariprazine: ["cariprazine", "reagila"],
          carmellose: [
            "carmellose",
            "optive",
            "carmize",
            "celluvisc",
            "lumecare",
            "melophthal",
            "optho-lube",
            "viscotears",
          ],
          "carnoys solution": ["carnoys solution"],
          levocarnitine: ["levocarnitine", "carnitor"],
          carobel: ["carobel"],
          carteolol: ["carteolol", "teoptic"],
          carvedilol: ["carvedilol", "eucardic"],
          "casirivimab/imdevimab": [
            "casirivimab/imdevimab",
            "REGEN?COV",
            "ronapreve",
          ],
          cavilon: ["cavilon"],
          caspofungin: ["caspofungin", "cancidas"],
          cefalexin: ["cefalexin", "cephalexin", "ceporex", "keflex"],
          cefixime: ["cefixime", "suprax"],
          cefotaxime: ["cefotaxime", "claforan"],
          cefradine: ["cefradine", "velosef"],
          ceftazidime: ["ceftazidime", "fortum", "kefadim"],
          ceftriaxone: ["ceftriaxone", "rocephin"],
          "ceftazidime/avibactam": ["ceftazidime/avibactam", "zavicefta"],
          "ceftolozane/tazobactam": ["ceftolozane/tazobactam", "zerbaxa"],
          cefuroxime: ["cefuroxime", "zinacef", "zinnat", "cefuroxim"],
          celecoxib: ["celecoxib", "celebrex"],
          celiprolol: ["celiprolol", "celectol"],
          cemiplimab: ["cemiplimab", "libtayo"],
          cenobamate: ["cenobamate", "ontozry"],
          ceritinib: ["ceritinib", "zykadia"],
          cernevit: ["cernevit"],
          certolizumab: ["certolizumab pegol", "cimzia"],
          cerumol: ["cerumol"],
          cetirizine: ["cetirizine", "zirtek", "benadryl allergy"],
          cetraben: ["cetraben"],
          cetuximab: ["cetuximab", "erbitux"],
          chlorambucil: ["chlorambucil", "leukeran"],
          chlordiazepoxide: ["chlordiazepoxide", "librium"],
          "chloral hydrate": ["chloral hydrate", "welldorm"],
          chlorhexidine: [
            "chlorhexidine",
            "corsodyl",
            "chlorhex",
            "unisept",
            "hibitane",
          ],
          chloramphenicol: [
            "chloramphenicol",
            "chloromycetin",
            "minims chloramphenicol",
          ],
          chlortetracycline: ["chlortetracycline", "aureomycin"],
          chlorphenamine: ["chlorphenamine", "piriton", "chlorpheniramine"],
          chlortalidone: ["chlortalidone", "chlorthalidone", "hygroton"],
          chloroform: ["chloroform"],
          chlorpromazine: ["chlorpromazine", "largactil"],
          chloroquine: ["chloroquine phosphate", "avloclor", "malarivon"],
          chlorothiazide: ["chlorothiazide"],
          "cholic acid": ["cholic acid", "orphacol"],
          "choline salicylate": ["choline salicylate", "bonjela"],
          "chorionic gonadotrophin": [
            "chorionic gonadotrophin",
            "choriogonadotropin alfa",
            "ovitrelle",
            "pregnyl",
          ],
          ciclosporin: [
            "ciclosporin",
            "deximune",
            "neoral",
            "vanquoral",
            "sandimmun",
            "cyclosporin",
            "cyclosporine",
          ],
          ciclesonide: ["ciclesonide", "alvesco"],
          cilest: ["cilest"],
          cilique: ["cilique"],
          cilostazol: ["cilostazol", "pletal"],
          cimetidine: ["cimetidine", "tagamet"],
          cinacalcet: ["cinacalcet", "mimpara"],
          cinnarizine: ["cinnarizine", "stugeron"],
          ciprofloxacin: ["ciprofloxacin", "ciproxin"],
          "ciprofloxacin/dexamethasone": [
            "ciprofloxacin/dexamethasone",
            "cilodex",
          ],
          ciprofibrate: ["ciprofibrate"],
          cisplatin: ["cisplatin"],
          citalopram: ["citalopram", "cipramil"],
          "citric acid": ["citric acid"],
          cladribine: ["cladribine", "mavenclad", "leustat", "litak"],
          clarithromycin: ["clarithromycin", "klaricid", "xetinin"],
          climagest: ["climagest"],
          clinimix: ["clinimix"],
          clindamycin: ["clindamycin", "dalacin", "zindaclin"],
          clobetasol: ["clobetasol", "dermovate", "etrivex"],
          clobetasone: ["clobetasone", "eumovate"],
          clobazam: ["clobazam", "frisium", "tapclob"],
          clofarabine: ["clofarabine", "evoltra"],
          clofazimine: ["clofazimine", "lamprene"],
          clomipramine: ["clomipramine", "anafranil"],
          clomethiazole: ["clomethiazole", "heminevrin"],
          clomifene: ["clomifene", "clomid"],
          clonidine: ["clonidine", "catapres"],
          clonazepam: ["clonazepam", "rivotril"],
          clopidogrel: ["clopidogrel", "plavix"],
          "cloral betaine": ["cloral betaine"],
          clotrimazole: ["clotrimazole", "canesten"],
          "clove oil": ["clove oil"],
          clozapine: ["clozapine", "clozaril", "denzapine", "zaponex"],
          "co-amoxiclav": [
            "co-amoxiclav",
            "augmentin",
            "amoxicillin/clavulanic acid",
          ],
          "amiloride/furosemide": [
            "amiloride/furosemide",
            "co-amilofruse",
            "frumil",
          ],
          "coal tar": ["coal tar", "exorex", "psoriderm", "cocois"],
          "amiloride/hydrochlorothiazide": [
            "amiloride/hydrochlorothiazide",
            "co-amilozide",
            "moduretic",
          ],
          "irbesartan/hydrochlorothiazide": [
            "irbesartan/hydrochlorothiazide",
            "co-aprovel",
          ],
          "levodopa/benserazide": [
            "levodopa/benserazide",
            "co-beneldopa",
            "madopar",
          ],
          cobicistat: ["cobicistat", "tybost"],
          cocaine: ["cocaine"],
          "levodopa/carbodopa": [
            "levodopa/carbodopa",
            "co-careldopa",
            "duodopa",
            "sinemet",
            "caramet",
          ],
          cocois: ["cocois", "sebco"],
          "codeine/paracetamol": [
            "codeine/paracetamol",
            "co-codamol",
            "solpadol",
            "zapain",
            "kapake",
            "tylex",
          ],
          "dantron/poloxamer": [
            "dantron/poloxamer",
            "co-danthramer",
            "codalax",
          ],
          codeine: ["codeine", "codeine phosphate"],
          "dihydrocodeine/paracetamol": [
            "dihydrocodeine/paracetamol",
            "co-dydramol",
            "paramol",
            "remedeine",
          ],
          colchicine: ["colchicine", "colcrys"],
          colecalciferol: [
            "colecalciferol",
            "vitamin d3",
            "fultium",
            "strivit",
            "invita d3",
            "thorens",
            "stexerol",
          ],
          colestipol: ["colestipol", "colestid"],
          colesevelam: ["colesevelam", "cholestagel"],
          colestyramine: ["colestyramine", "questran", "cholestyramine"],
          colistin: ["colistin", "colistimethate", "colomycin", "promixin"],
          collagenase: ["collagenase", "xiapex"],
          "co-magaldrox": ["co-magaldrox", "maalox", "mucogel"],
          "dutasteride/tamsulosin": ["dutasteride/tamsulosin", "combodart"],
          "lamivudine/zidovudine": ["lamivudine/zidovudine", "combivir"],
          combigan: ["combigan", "brimonidine/timolol"],
          "compound sodium lactate": ["compound sodium lactate", "hartmann's"],
          complan: ["complan"],
          competact: ["competact", "pioglitazone/metformin"],
          "conestat alfa": ["conestat alfa", "ruconest"],
          copaxone: ["copaxone", "glatiramer"],
          "co-phenotrope": [
            "co-phenotrope",
            "diphenoxylate/atropine",
            "lomotil",
          ],
          "copper histidine": ["copper-histidine"],
          "co-proxamol": ["co-proxamol", "dextropropoxyphene/paracetamol"],
          corticorelin: ["corticorelin"],
          "dorzolamide/timollol": [
            "cosopt",
            "dorzolamide/timolol",
            "Eylamdo",
            "Glaucopt",
            "Visidor Duo",
          ],
          "co-trimoxazole": [
            "co-trimoxazole",
            "septrin",
            "trimethoprim/sulfamethoxazole",
          ],
          "co-tenidone": [
            "co-tenidone",
            "atenolol/chlortalidone",
            "tenoret",
            "tenoretic",
          ],
          "covid-19 vaccine": [
            "comirnaty",
            "spikevax",
            "pfizer-biontech",
            "moderna",
          ],
          creon: ["creon", "pancreatin", "Pancrex V", "Nutrizym 22"],
          crisantaspase: ["crisantaspase", "erwinase"],
          crizotinib: ["crizotinib", "xalkori"],
          crotamiton: ["crotamiton", "eurax"],
          cyanocobalamin: ["cyanocobalamin", "vitamin b12"],
          cyclopentolate: ["cyclopentolate", "minims cyclopentolate"],
          cyclophosphamide: ["cyclophosphamide", "endoxana"],
          cycloserine: ["cycloserine"],
          cyclizine: ["cyclizine", "valoid"],
          cyproheptadine: ["cyproheptadine", "periactin"],
          cyproterone: ["cyproterone acetate", "cyprostat", "androcur"],
          cytarabine: ["cytarabine", "ara-c", "cytosine arabinoside"],
          dabigatran: ["dabigatran etexilate", "pradaxa"],
          dabrafenib: ["dabrafenib", "tafinlar"],
          dacarbazine: ["dacarbazine", "dtic"],
          daclatasvir: ["daclatasvir", "daklinza"],
          dactinomycin: ["dactinomycin", "actinomycin d", "cosmegen"],
          daktacort: ["daktacort", "miconazole/hydrocortisone"],
          dalbavancin: ["dalbavancin", "xydalba"],
          dalteparin: ["dalteparin", "fragmin"],
          danazol: ["danazol", "danogar"],
          danaparoid: ["danaparoid", "orgaran"],
          dantrolene: ["dantrolene", "dantrium"],
          dapagliflozin: ["dapagliflozin", "forxiga"],
          dapoxetine: ["dapoxetine", "priligy"],
          dapsone: ["dapsone"],
          daptomycin: ["daptomycin", "cubicin"],
          daratumumab: ["daratumumab", "darzalex"],
          darbepoetin: ["darbepoetin alfa", "aranesp"],
          darifenacin: ["darifenacin", "emselex"],
          darolutamide: ["darolutamide", "nubeqa"],
          darunavir: ["darunavir", "prezista", "rezolsta"],
          dasatinib: ["dasatinib", "sprycel"],
          dasabuvir: ["dasabuvir", "exviera"],
          daunorubicin: ["daunorubicin", "cerubidine"],
          deegans: ["deegans"],
          "deep heat": ["deep heat"],
          deferasirox: ["deferasirox", "exjade"],
          deferiprone: ["deferiprone", "ferriprox"],
          degarelix: ["degarelix", "firmagon"],
          delstrigo: ["delstrigo", "doravirine/lamivudine/tenofovir"],
          demeclocycline: ["demeclocycline", "ledermycin"],
          denosumab: ["denosumab", "prolia", "xgeva"],
          "isopropyl myristate/paraffin": ["Dermol", "Dermol Cream", "Hydromol", "Hydromol Cream", "Doublebase", "doublebase gel", "doublebase gel 100", "doublebase gel 500", "isopropyl myristate/paraffin"],          
          descovy: ["descovy", "emtricitabine/tenofovir alafenamide"],
          desferrioxamine: ["desferrioxamine", "desferal"],
          desflurane: ["desflurane", "suprane"],
          desloratadine: ["desloratadine", "neoclarityn"],
          desmopressin: [
            "desmopressin",
            "ddavp",
            "desmomelt",
            "noqdirna",
            "octim",
          ],
          desogestrel: ["desogestrel", "cerazette", "cerelle"],
          dexamethasone: [
            "dexamethasone",
            "maxidex",
            "ozurdex",
            "dexsol",
            "neofordex",
          ],
          dexamfetamine: ["dexamfetamine", "dexamphetamine", "amfexa"],
          dexmedetomidine: ["dexmedetomidine", "dexdor"],
          dextrose: ["dextrose", "dextrosol"],
          diamorphine: ["diamorphine", "heroin", "diagesil"],
          diaminopyridine: ["diaminopyridine", "firdapse"],
          dianette: [
            "dianette",
            "co-cyprindiol",
            "cyproterone/ethinylestradiol",
          ],
          diazepam: ["diazepam", "valium", "diazepam rectubes", "stesolid"],
          diazoxide: ["diazoxide", "eudemine", "proglycem"],
          dibrompropamidine: ["dibrompropamidine", "brolene"],
          diclofenac: [
            "diclofenac",
            "voltarol",
            "pennsaid",
            "solaraze",
            "voltaren",
          ],
          "dicobalt edetate": ["dicobalt edetate"],
          diconal: ["diconal"],
          dicycloverine: ["dicycloverine", "dicyclomine", "merbentyl"],
          didanosine: ["didanosine", "videx"],
          "diethylamine salicylate": ["diethylamine salicylate"],
          diethylstilbestrol: ["diethylstilbestrol"],
          difelikefalin: ["difelikefalin", "kapruvia"],
          digoxin: ["digoxin", "lanoxin"],
          "digoxin immune fab": ["digoxin immune fab", "digibind", "digifab"],
          dihydrocodeine: ["dihydrocodeine", "df118", "dhc continus"],
          diltiazem: [
            "diltiazem",
            "tildiem",
            "viazem",
            "zemtard",
            "adizem",
            "angitil",
            "dilzem",
          ],
          "dimethyl fumarate": ["dimethyl fumarate", "tecfidera", "skilarence"],
          dimeticone: ["dimeticone", "hedrin", "nyda"],
          dimercaprol: ["dimercaprol"],
          dinoprostone: ["dinoprostone", "prostin e2"],
          dioralyte: ["dioralyte"],
          diprosalic: ["diprosalic", "betamethasone/salicylic acid"],
          diprobase: ["diprobase"],
          dipyridamole: ["dipyridamole", "persantin", "attia"],
          "diroximel fumarate": ["diroximel fumarate", "vumerity"],
          "disodium edetate": ["disodium edetate"],
          disopyramide: ["disopyramide", "rythmodan"],
          disulfiram: ["disulfiram", "antabuse"],
          dithrocream: ["dithrocream"],
          dobutamine: ["dobutamine"],
          docetaxel: ["docetaxel", "taxotere"],
          docusate: ["docusate sodium", "dioctyl"],
          dolutegravir: ["dolutegravir", "tivicay"],
          "dolutegravir/lamivudine": ["dolutegravir/lamivudine", "dovato"],
          "dolutegravir/rilpivirine": ["dolutegravir/rilpivirine", "juluca"],
          domperidone: ["domperidone", "motilium"],
          donepezil: ["donepezil", "aricept"],
          dopamine: ["dopamine", "intropin"],
          dopexamine: ["dopexamine"],
          doravirine: ["doravirine", "pifeltro"],
          "dornase alfa": ["dornase alfa", "pulmozyme"],
          dorzolamide: ["dorzolamide", "trusopt"],
          "dorzolamide/timolol": [
            "dorzolamide/timolol",
            "cosopt",
            "cosopt preservative free",
          ],
          dostarlimab: ["dostarlimab", "jemperli"],
          dosulepin: ["dosulepin", "dothiepin", "prothiaden"],
          dovobet: ["dovobet", "calcipotriol/betamethasone", "enstilar"],
          doxapram: ["doxapram", "dopram"],
          doxazosin: ["doxazosin", "cardura", "doxadura"],
          doxepin: ["doxepin", "sinequan"],
          doxorubicin: [
            "doxorubicin",
            "doxorubicin pegylated liposomal",
            "caelyx",
            "myocet",
          ],
          doxycycline: [
            "doxycycline",
            "vibramycin",
            "efracea",
            "periostat",
            "acticlate",
          ],
          "doxylamine/pyridoxine": ["doxylamine/pyridoxine", "Xonvea"],
          dronedarone: ["dronedarone", "multaq"],
          droxidopa: ["droxidopa"],
          vaccines: [
            "dtap/ipv/hib",
            "dtap/ipv/hib/hepb",
            "td/ipv",
            "dtap/ipv",
            "pediacel",
            "infanrix",
            "boostrix",
            "repevax",
          ],
          duac: ["duac", "clindamycin/benzoyl peroxide"],
          duaklir: ["duaklir genuair", "aclidinium/formoterol"],
          dulaglutide: ["dulaglutide", "trulicity"],
          duloxetine: ["duloxetine", "cymbalta", "yentreve"],
          duocal: ["duocal"],
          duolube: ["duolube", "soothe"],
          duoresp: ["duoresp spiromax", "budesonide/formoterol"],
          durvalumab: ["durvalumab", "imfinzi"],
          dutasteride: ["dutasteride", "avodart"],
          dymista: ["dymista", "azelastine/fluticasone"],
          E45: ["E45"],
          "E45 itch relief cream": ["E45 Itch Relief"],
          eculizumab: ["eculizumab", "soliris"],
          edoxaban: ["edoxaban", "lixiana"],
          efavirenz: ["efavirenz", "sustiva"],
          "efavirenz/emtricitabine/tenofovir": [
            "efavirenz/emtricitabine/tenofovir",
            "atripla",
          ],
          eflornithine: ["eflornithine", "vaniqa"],
          elemental: ["elemental 028", "elemental 028 extra"],
          elleste: ["elleste-duet", "elleste-duet conti"],
          elranatamab: ["elranatamab", "elrexfio"],
          eltrombopag: ["eltrombopag", "revolade"],
          eluxadoline: ["eluxadoline", "truberzi"],
          emla: ["emla", "lidocaine/prilocaine"],
          emollin: ["emollin"],
          empagliflozin: ["empagliflozin", "jardiance"],
          emtricitabine: ["emtricitabine", "emtriva"],
          "emtricitabine/tenofovir": [
            "emtricitabine/tenofovir",
            "truvada",
            "descovy",
          ],
          "emulsifying ointment": ["emulsifying ointment"],
          enalapril: ["enalapril", "innovace"],
          enbucrilate: ["enbucrilate"],
          encorafenib: ["encorafenib", "braftovi"],
          enoxaparin: ["enoxaparin", "clexane", "inhixa"],
          entacapone: ["entacapone", "comtess"],
          entecavir: ["entecavir", "baraclude"],
          enzalutamide: ["enzalutamide", "xtandi"],
          epaderm: ["epaderm"],
          epclusa: ["epclusa", "sofosbuvir/velpatasvir"],
          epcoritamab: ["epcoritamab", "tepkinly"],
          ephedrine: ["ephedrine hydrochloride", "ephedrine"],
          epiduo: ["epiduo", "adapalene/benzoyl peroxide"],
          epimax: ["epimax"],
          epinephrine: ["epinephrine", "adrenaline"],
          epirubicin: ["epirubicin", "pharmorubicin"],
          eplerenone: ["eplerenone", "inspra"],
          forticreme: ["forticreme dessert feed"],
          fortisip: ["fortisip sip feed"],
          "fortisip compact": ["fortisip compact"],
          "fortisip compact fibre": ["fortisip compact fibre"],
          "fortisip compact protein": ["fortisip compact protein"],
          "fortisip extra": ["fortisip extra feed"],
          "fortisip multifibre": ["fortisip multifibre feed"],
          "fortisip plant based": ["fortisip plant based"],
          fortijuice: ["fortijuice sip feed"],
          fresubin: ["fresubin 2kcal"],
          infatrini: ["infatrini liquid", "infatrini peptisorb"],
          nepro: ["nepro hp"],
          nutricreme: ["nutricreme"],
          nutrini: [
            "nutrini",
            "nutrini energy",
            "nutrini multifibre",
            "nutrini energy multifibre",
            "nutrini low energy multifibre",
            "nutrini peptisorb",
          ],
          nutrison: [
            "nutrison enteral feed",
            "nutrison concentrate",
            "nutrison energy",
            "nutrison low sodium",
            "nutrison multifibre",
            "nutrison peptisorb",
            "nutrison peptisorb advance",
            "nutrison peptisorb plus hehp",
            "nutrison soya",
            "nutrison protein plus",
          ],
          osmolite: ["osmolite hp"],
          paediasure: ["paediasure peptide"],
          prosource: ["prosource jelly"],
          resource: ["resource energy", "resource fibre"],
          tentrini: [
            "tentrini",
            "tentrini energy",
            "tentrini energy multifibre",
          ],
          vital: ["vital 1.5 kcal"],
          epoetin: [
            "epoetin alfa",
            "epoetin beta",
            "eprex",
            "neorecormon",
            "binocrit",
          ],
          epoprostenol: ["epoprostenol", "flolan", "veletri"],
          eprosartan: ["eprosartan", "teveten"],
          erdosteine: ["erdosteine"],
          erenumab: ["erenumab", "aimovig"],
          ergocalciferol: ["ergocalciferol", "vitamin d2"],
          ergometrine: ["ergometrine"],
          eribulin: ["eribulin", "halaven"],
          erlotinib: ["erlotinib", "tarceva"],
          ertapenem: ["ertapenem", "invanz"],
          ertugliflozin: ["ertugliflozin", "steglatro"],
          erythromycin: ["erythromycin", "erymax", "erythrocin", "erythroped"],
          "escherichia coli lysate": ["escherichia coli lysate", "uro-vaxom"],
          escitalopram: ["escitalopram", "cipralex"],
          eslicarbazepine: ["eslicarbazepine", "zebinix"],
          esmolol: ["esmolol", "brevibloc"],
          esomeprazole: ["esomeprazole", "nexium"],
          estradiol: [
            "estradiol",
            "estrace",
            "elleste solo",
            "progynova",
            "zumenon",
            "bedol",
            "climaval",
            "hormonin",
          ],
          estriol: ["estriol", "ovestin"],
          etamsylate: ["etamsylate", "dicynene"],
          etanercept: ["etanercept", "enbrel", "benepali", "erelzi"],
          etelcalcetide: ["etelcalcetide", "parsabiv"],
          ethambutol: ["ethambutol"],
          "ethacrynic acid": ["ethacrynic acid"],
          ethanol: ["ethanol"],
          ethinylestradiol: ["ethinylestradiol"],
          ethosuximide: ["ethosuximide", "zarontin"],
          "ethyl chloride": ["ethyl chloride"],
          etodolac: ["etodolac", "lodine"],
          etonogestrel: ["etonogestrel", "nexplanon"],
          etoposide: ["etoposide", "vepesid", "etopophos"],
          etoricoxib: ["etoricoxib", "arcoxia"],
          etravirine: ["etravirine", "intelence"],
          eucreas: ["eucreas", "vildagliptin/metformin"],
          everolimus: ["everolimus", "afinitor", "certican", "votubia"],
          eviplera: ["eviplera", "rilpivirine/emtricitabine/tenofovir"],
          evolocumab: ["evolocumab", "repatha"],
          evorel: ["evorel"],
          evotaz: ["evotaz", "atazanavir/cobicistat"],
          evra: ["evra"],
          exemestane: ["exemestane", "aromasin"],
          exenatide: ["exenatide", "byetta", "bydureon"],
          extreneal: ["extreneal"],
          eylamdo: ["eylamdo"],
          ezetimibe: ["ezetimibe", "ezetrol"],
          famciclovir: ["famciclovir", "famvir"],
          famotidine: ["famotidine", "pepcid"],
          faricimab: ["faricimab", "vabysmo"],
          febuxostat: ["febuxostat", "adenuric"],
          fedratinib: ["fedratinib", "inrebic"],
          feiba: ["feiba"],
          felbinac: ["felbinac", "traxam"],
          felodipine: [
            "felodipine",
            "cardioplen",
            "felogen",
            "plendil",
            "vascalpha",
          ],
          femoston: ["femoston"],
          femodene: ["femodene"],
          femulen: ["femulen", "etynodiol"],
          fenfluramine: ["fenfluramine", "fintepla"],
          fenofibrate: ["fenofibrate", "lipantil", "supralip"],
          fentanyl: [
            "fentanyl",
            "abstral",
            "effentora",
            "instanyl",
            "pecfent",
            "durogesic",
            "matrifen",
            "osmanil",
            "fencino",
            "victanyl",
          ],
          "ferrous sulfate": [
            "ferrous sulfate",
            "ferrous sulphate",
            "ferrograd",
            "feospan",
            "ferrograd c",
          ],
          "ferrous fumarate": ["ferrous fumarate", "pregaday"],
          "ferrous gluconate": ["ferrous gluconate"],
          "ferric carboxymaltose": ["ferric carboxymaltose", "ferinject"],
          "ferric maltol": ["ferric maltol", "feraccru"],
          "ferric subsulphate": ["ferric subsulphate"],
          "ferric derisomaltose": ["ferric derisomaltose", "monofer"],
          "iron dextran": ["cosmofer"],
          "sodium feredetate": ["sytron"],
          fesoterodine: ["fesoterodine", "toviaz"],
          fexofenadine: ["fexofenadine", "telfast"],
          fidaxomicin: ["fidaxomicin", "dificlir"],
          filgotinib: ["filgotinib", "jyseleca"],
          filgrastim: [
            "filgrastim",
            "neupogen",
            "accofil",
            "nivestim",
            "zarzio",
          ],
          finasteride: ["finasteride", "proscar", "propecia"],
          finerenone: ["finerenone", "kerendia"],
          fingolimod: ["fingolimod", "gilenya"],
          flaminal: ["flaminal"],
          flavoxate: ["flavoxate"],
          flecainide: ["flecainide", "tambocor"],
          fleet: ["fleet phospho-soda"],
          flucytosine: ["flucytosine", "ancotil"],
          flucloxacillin: ["flucloxacillin", "fluclox", "floxapen"],
          fluconazole: ["fluconazole", "diflucan"],
          fludrocortisone: ["fludrocortisone", "florinef"],
          fludarabine: ["fludarabine", "fludara"],
          fludroxycortide: ["fludroxycortide", "haelan"],
          flumazenil: ["flumazenil", "anexate"],
          flunarizine: ["flunarizine", "sibelium"],
          fluocinolone: ["fluocinolone", "synalar", "iluvien"],
          fluorometholone: ["fluorometholone", "fml"],
          fluorescein: ["fluorescein sodium", "minims fluorescein sodium"],
          fluorouracil: ["fluorouracil", "5-fu", "efudix"],
          fluoxetine: ["fluoxetine", "prozac", "oxactin"],
          flupentixol: ["flupentixol", "depixol", "fluanxol"],
          fluphenazine: ["fluphenazine", "modecate"],
          flurbiprofen: ["flurbiprofen", "froben"],
          fluticasone: [
            "fluticasone",
            "flixotide",
            "flixonase",
            "avamys",
            "cutivate",
          ],
          "fluticasone/salmeterol": [
            "fluticasone/salmeterol",
            "seretide",
            "airflusol forspiro",
            "avenor",
            "combisal",
            "fixkoh",
            "fusacomb",
            "seffalair",
            "stalpex",
          ],
          "fluticasone/formoterol": ["fluticasone/formoterol", "flutiform"],
          flutamide: ["flutamide"],
          fluvastatin: ["fluvastatin", "lescol"],
          fluvoxamine: ["fluvoxamine", "faverin"],
          fmt: ["faecal microbiota transplant"],
          "folic acid": ["folic acid"],
          "folinic acid": [
            "folinic acid",
            "calcium folinate",
            "leucovorin",
            "refolinon",
            "isovorin",
          ],
          follitropin: [
            "follitropin alfa",
            "follitropin beta",
            "puregon",
            "gonal-f",
            "bemfola",
          ],
          fomepizole: ["fomepizole"],
          fondaparinux: ["fondaparinux", "arixtra"],
          forceval: ["forceval"],
          formoterol: ["formoterol", "foradil", "oxis", "atimos"],
          fosaprepitant: ["fosaprepitant", "ivemend"],
          fosamprenavir: ["fosamprenavir", "telzir"],
          fosavance: ["fosavance", "alendronic acid/colecalciferol"],
          foscarnet: ["foscarnet", "foscavir"],
          fosfomycin: ["fosfomycin", "monuril"],
          fosinopril: ["fosinopril"],
          "foslevodopa/foscarbidopa": ["foslevodopa/foscarbidopa"],
          "beclometasone/formoterol": [
            "beclometasone/formoterol",
            "beclomethasone/formoterol",
            "fostair",
            "luforbec",
          ],
          fostamatinib: ["fostamatinib", "tavlesse"],
          fremanezumab: ["fremanezumab", "ajovy"],
          fructose: ["fructose"],
          "betamethasone/fusidic acid": [
            "betamethasone/fusidic acid",
            "fucibet",
          ],
          "hydrocortisone/fusidic acid": [
            "hydrocortisone/fusidic acid",
            "fucidin h",
          ],
          fulvestrant: ["fulvestrant", "faslodex"],
          "fumaric acid": ["fumaric acid"],
          furosemide: ["furosemide", "frusemide", "lasix", "frusol"],
          "fusidic acid": ["fusidic acid", "fucidin", "fucithalmic"],
          gabapentin: ["gabapentin", "neurontin"],
          gadoxetate: ["gadoxetate disodium", "primovist"],
          gadobutrol: ["gadobutrol", "gadovist"],
          "gadoteric acid": ["gadoteric acid", "dotarem"],
          galantamine: ["galantamine", "reminyl"],
          galcanezumab: ["galcanezumab", "emgality"],
          ganciclovir: ["ganciclovir", "cymevene"],
          "bimatoprost/timolol": ["bimatoprost/timolol", "ganfort"],
          ganirelix: ["ganirelix", "orgalutran"],
          gastrografin: ["gastrografin"],
          "gaviscon advance": [
            "gaviscon advance",
            "sodium alginate/potassium bicarbonate",
          ],
          "gaviscon infant": ["gaviscon infant"],
          gedarel: ["gedarel"],
          gefitinib: ["gefitinib", "iressa"],
          gelclair: ["gelclair"],
          gelofusine: ["gelofusine"],
          gemcitabine: ["gemcitabine", "gemzar"],
          gemeprost: ["gemeprost"],
          gemtuzumab: ["gemtuzumab ozogamicin", "mylotarg", "gemtuzumab"],
          "generic emollient": ["emollient cream", "emollient"],
          gentamicin: ["gentamicin", "genticin", "cidomycin"],
          "gentamicin/hydrocortisone": ["gentamicin/hydrocortisone"],
          "gentamicin/heparin": ["gentamicin/heparin"],
          "elvitegravir/cobicistat/emtricitabine/tenofovir": [
            "elvitegravir/cobicistat/emtricitabine/tenofovir",
            "genvoya",
          ],
          gilteritinib: ["gilteritinib", "xospata"],
          "glacial acetic acid": ["glacial acetic acid"],
          glatiramer: ["glatiramer", "brabio", "copaxone", "remurel"],
          glibenclamide: ["glibenclamide", "daonil"],
          gliclazide: ["gliclazide", "diamicron", "nasulin"],
          glimepiride: ["glimepiride", "amaryl"],
          glipizide: ["glipizide", "minodiab"],
          glofitamab: ["glofitamab", "columvi"],
          glucarpidase: ["glucarpidase", "voraxaze"],
          glucose: ["glucose", "dextrose"],
          glucagon: ["glucagon", "ogluo", "glucagen", "glucagen hypokit"],
          glycopyrronium: [
            "glycopyrronium",
            "glycopyrronium bromide",
            "glycopyrrolate",
            "seebri",
            "Seebri Breezhaler",
            "sialanar",
          ],
          "glycopyrronium/neostigmine": ["glycopyrronium/neostigmine"],
          glycine: ["glycine"],
          "glyceryl trinitrate": [
            "glyceryl trinitrate",
            "gtn",
            "nitrolingual",
            "minitran",
            "deponit",
            "nitro-dur",
            "transiderm-nitro",
            "glytrin",
            "rectogesic",
            "suscard",
          ],
          glycerol: ["glycerol"],
          "glycopyrronium/formoterol": [
            "glycopyrronium/formoterol",
            "bevespi aerosphere",
          ],
          "glycopyrronium/formoterol/budesonide": [
            "glycopyrronium/formoterol/budesonide",
            "trixeo aerosphere",
          ],
          golimumab: ["golimumab", "simponi"],
          gonadorelin: ["gonadorelin"],
          goserelin: ["goserelin", "zoladex"],
          granisetron: ["granisetron", "kytril", "sancuso"],
          "grass pollen extract": ["grass pollen extract", "grazax"],
          griseofulvin: ["griseofulvin"],
          guanfacine: ["guanfacine", "intuniv"],
          guselkumab: ["guselkumab", "tremfya"],
          "haem arginate": ["haem arginate", "normosang"],
          haloperidol: ["haloperidol", "haldol", "serenace"],
          "haloperidol decanoate": [
            "haloperidol decanoate",
            "haldol decanoate",
          ],
          harvoni: ["harvoni", "ledipasvir/sofosbuvir"],
          "hepatitis vaccines": [
            "hepatitis a vaccine",
            "hepatitis b vaccine",
            "hepatitis a/b vaccine",
            "havrix",
            "avaxim",
            "vaqta",
            "engerix b",
            "fendrix",
            "hbvaxpro",
            "twinrix",
            "ambirix",
          ],
          heparin: ["heparin", "heparin sodium", "minihep", "monoparin"],
          heparinoid: ["heparinoid", "hirudoid"],
          hexamidine: ["hexamidine"],
          "hib/men c": ["hib/men c", "menitorix"],
          hyaluronidase: ["hyaluronidase", "hyalase"],
          "hyaluronic acid": [
            "hyaluronic acid",
            "hyaluronate",
            "optive fusion",
            "vismed",
            "hyabak",
            "hylo-tear",
            "hylo-forte",
          ],
          "Hylo-Night": ["Hylo-Night"],
          hydrocortisone: [
            "hydrocortisone",
            "efcortesol",
            "solu-cortef",
            "hydrocortone",
            "plenadren",
          ],
          "hydrocortisone/clotrimazole": [
            "hydrocortisone/clotrimazole",
            "hydrocortisone/clotrimazo",
            "Canesten HC",
          ],
          "hydrocortisone acetate": ["hydrocortisone acetate", "colifoam"],
          "hydrogen peroxide": ["hydrogen peroxide", "crystacide"],
          hydroxycarbamide: [
            "hydroxycarbamide",
            "siklos",
            "hydroxyurea",
            "hydrea",
          ],
          hydroxychloroquine: ["hydroxychloroquine", "plaquenil"],
          hydromorphone: ["hydromorphone", "palladone"],
          hydralazine: ["hydralazine", "apresoline"],
          hydromol: ["hydromol"],
          hydroxyzine: ["hydroxyzine", "atarax", "ucerax"],
          hydroxocobalamin: ["hydroxocobalamin", "cobalin-h", "neo-cytamen"],
          hyoscine: [
            "hyoscine hydrobromide",
            "scopoderm",
            "scopolamine",
            "kwells",
          ],
          "hyoscine butylbromide": ["hyoscine butylbromide", "buscopan"],
          hypromellose: [
            "hypromellose",
            "isopto plain",
            "artelac",
            "lumecare",
            "hydroxypropylmethylcellulose",
            "hpmc",
            "artificial tears",
          ],
          "hypochlorous acid": ["hypochlorous acid"],
          "ibandronic acid": [
            "ibandronic acid",
            "bondronat",
            "bonviva",
            "iasibon",
          ],
          ibrutinib: ["ibrutinib", "imbruvica"],
          ibuprofen: [
            "ibuprofen",
            "brufen",
            "nurofen",
            "calprofen",
            "nurofen plus",
            "brufen retard",
            "fenbid",
            "ibucalm",
            "ibuleve",
            "ibumousse",
            "ibuspray",
            "rimafen",
          ],
          icatibant: ["icatibant", "firazyr"],
          ichthammol: ["ichthammol"],
          "icosapent ethyl": ["icosapent ethyl", "vazkepa"],
          idarubicin: ["idarubicin hydrochloride", "zavedos"],
          idarucizumab: ["idarucizumab", "praxbind"],
          idelalisib: ["idelalisib", "zydelig"],
          ifosfamide: ["ifosfamide"],
          iloprost: ["iloprost", "ventavis", "ilomedin"],
          imatinib: ["imatinib", "glivec", "gleevec"],
          imidapril: ["imidapril", "tanatril"],
          imipramine: ["imipramine", "tofranil"],
          imiquimod: ["imiquimod", "aldara", "zyclara"],
          "immunoglobulin human": [
            "gamunex",
            "iqymune",
            "tegeline",
            "privigen",
            "octogam",
            "subcuvia",
            "hizentra",
            "vigam",
            "kiovig",
            "subgam",
            "cutaquig",
            "gammanorm",
            "cuvitru",
            "flebogamma",
            "gammaplex",
            "octagam",
            "panzyga",
          ],
          "immunoglobulin anti d": [
            "immunoglobulin anti d",
            "rhophylac",
            "d-gam",
          ],
          "immunoglobulin tetanus": ["immunoglobulin tetanus"],
          "immunoglobulin varicella zoster": [
            "immunoglobulin varicella zoster",
          ],
          "immunoglobulin rabies": [
            "immunoglobulin human rabies",
            "rabies immunoglobulin",
          ],
          inclisiran: ["inclisiran", "leqvio"],
          indapamide: ["indapamide", "natrilix", "tensaid"],
          indacaterol: ["indacaterol", "onbrez breezhaler", "oslif breezhaler"],
          "indigo carmine": ["indigo carmine"],
          "indian ink": ["indian ink"],
          indometacin: ["indometacin", "indomethacin"],
          "indocyanine green": ["indocyanine green"],
          indoramin: ["indoramin", "doralese"],
          infliximab: [
            "infliximab",
            "remicade",
            "inflectra",
            "remsima",
            "zessly",
            "flixabi",
          ],
          "influenza vaccines": [
            "influenza vaccine fluarix tetra",
            "influenza egg free vaccine",
            "influenza quadrivalent vaccine",
            "influenza nasal spray",
            "influenza trivalent vaccine",
            "fluenz tetra",
            "flucelvax tetra",
            "fluad",
            "quadrivalent influenza vaccine",
          ],
          "inotuzumab ozogamicin": ["inotuzumab ozogamicin", "besponsa"],
          "insuman comb 15": ["insuman comb 15"],
          "insuman comb 25": ["insuman comb 25"],
          "insulin degludec": ["insulin degludec", "tresiba"],
          "insulin aspart": ["insulin aspart", "novorapid", "fiasp"],
          "insulin glargine": [
            "insulin glargine",
            "lantus",
            "toujeo",
            "semglee",
          ],
          "insulin abasaglar": ["insulin abasaglar", "abasaglar"],
          "insulin Semglee": ["insulin semglee", "semglee"],
          "insulin glulisine": ["insulin glulisine", "apidra"],
          "insulin lispro": ["insulin lispro", "humalog"],
          "insulin lispro sanofi": ["insulin lispro sanofi", "lispro sanfi"],
          "insulin lispro mix 25": ["insulin lispro mix 25", "humalog mix 25"],
          "insulin lispro mix 50": ["insulin lispro mix 50", "humalog mix 50"],
          "insulin lispro lyumjev": ["insulin lispro lyumjev", "lyumjev"],
          "insulin human soluble": [
            "insulin human soluble",
            "actrapid",
            "humulin s",
            "insuman rapid",
          ],
          "insulin human isophane": [
            "insulin human isophane",
            "humulin i",
            "insulatard",
            "insuman basal",
          ],
          "insulin human mix 30/70": [
            "insulin human mix 30/70",
            "humulin m3",
            "insuman comb 30",
          ],
          "insulin aspart mix 30": [
            "insulin aspart mix 30",
            "insulin biphasic aspart",
            "insulin aspart prota 70",
            "novomix 30",
          ],
          "insulin detemir": ["insulin detemir", "levemir"],
          "insulin porcine isophane": [
            "insulin porcine isophane",
            "hypurin porcine isophane",
          ],
          "insulin porcine neutral": [
            "insulin porcine neutral",
            "hypurin porcine neutral",
          ],
          "insulin porcine mix 30/70": [
            "insulin porcine mix 30/70",
            "hypurin mix 30/70",
          ],
          "insulin aspart biosimilar": ["insulin aspart biosimilar", "trurapi"],
          "lidocaine/chlorhexidine": ["lidocaine/chlorhexidine", "instillagel"],
          interferon: ["interferon", "intron a", "roferon-a"],
          "interferon beta-1a": [
            "interferon beta-1a",
            "avonex",
            "rebif",
            "plegridy",
          ],
          "interferon beta-1b": ["interferon beta-1b", "betaferon", "extavia"],
          intralipid: ["intralipid"],
          "intralipid/vitlipid": ["intralipid/vitlipid"],
          invertase: ["invertase"],
          iodine: [
            "iodine aqueous",
            "iodine weak",
            "iodine tincture",
            "videne",
          ],
          iodoform: ["iodoform compound"],
          "iohexol 140": ["iohexol 140", "omnipaque 140"],
          "iohexol 240": ["iohexol 240", "omnipaque 240"],
          "iohexol 300": ["iohexol 300", "omnipaque 300"],
          "iohexol 350": ["iohexol 350", "omnipaque 350"],
          "iopamidol 30.6%": ["iopamidol 30.6%", "niopam 150"],
          "iopamidol 61.2%": ["iopamidol 61.2%", "niopam 300", "gastromiro"],
          "iopamidol 69.4%": ["iopamidol 69.4%", "niopam 340"],
          "iopamidol 75.5%": ["iopamidol 75.5%", "niopam 370"],
          ipilimumab: ["ipilimumab", "yervoy"],
          ipratropium: [
            "ipratropium",
            "atrovent",
            "respontin",
            "ipratropium steri-neb",
          ],
          irbesartan: ["irbesartan", "aprovel"],
          irinotecan: [
            "irinotecan hydrochloride",
            "campto",
            "irinotecan accord",
            "irinotecan fresenius",
          ],
          "iron dextran": ["iron dextran", "cosmofer"],
          "iron sucrose": ["iron sucrose", "venofer"],
          "ferric derisomaltose": ["ferric derisomaltose", "monofer"],
          "iron iii chloride": ["iron iii chloride"],
          isatuximab: ["isatuximab", "sarclisa"],
          isavuconazole: ["isavuconazole", "cresemba"],
          isoflurane: ["isoflurane"],
          isoniazid: ["isoniazid", "rimifon"],
          isoprenaline: [
            "isoprenaline",
            "isoprenaline hydrochloride",
            "isoprenaline sulphate",
            "isuprel",
          ],
          "isosorbide mononitrate": [
            "isosorbide mononitrate",
            "imdur",
            "ismo",
            "isotard",
            "modisal",
            "monomil",
            "elantan",
          ],
          "isosorbide dinitrate": ["isosorbide dinitrate", "isordil"],
          isotretinoin: ["isotretinoin", "roaccutane", "isotrex", "isotrexin"],
          "ispaghula husk": ["ispaghula husk", "fybogel", "isogel"],
          itraconazole: ["itraconazole", "sporanox"],
          "levonorgestrel iud": [
            "levonorgestrel iud",
            "jaydess",
            "kyleena",
            "levosert",
            "mirena",
          ],
          "copper iud": [
            "copper iud",
            "flexi-t",
            "neo-safe t",
            "t-safe",
            "novaplus t",
            "ancora",
            "cu-safe",
            "load 375",
            "multi-safe",
            "nova-t",
          ],
          ivabradine: ["ivabradine", "procoralan"],
          ivermectin: ["ivermectin", "soolantra", "stromectol"],
          ivosidenib: ["ivosidenib", "tibsovo"],
          ixazomib: ["ixazomib", "ninlaro"],
          ixekizumab: ["ixekizumab", "taltz"],
          kabiven: ["kabiven peripheral"],
          "lopinavir/ritonavir": ["lopinavir/ritonavir", "kaletra"],
          kaolin: ["kaolin mixture"],
          "kaolin/morphine": ["kaolin/morphine"],
          "triamcinolone/neomycin/nystatin/gramicidin": [
            "triamcinolone/neomycin/nystatin/gramicidin",
            "kenacomb",
          ],
          ketamine: ["ketamine hydrochloride", "ketalar"],
          ketorolac: ["ketorolac", "acuvail", "acular"],
          ketotifen: ["ketotifen", "zaditen"],
          ketoprofen: ["ketoprofen", "oruvail", "powergel"],
          ketoconazole: ["ketoconazole", "nizoral"],
          ketovite: ["ketovite"],
          labetalol: ["labetalol", "trandate"],
          lacidipine: ["lacidipine"],
          lacosamide: ["lacosamide", "vimpat"],
          "l-arginine": ["l-arginine"],
          "l-serine": ["l-serine"],
          lacrilube: ["lacrilube"],
          lactulose: ["lactulose", "duphalac"],
          lactose: ["lactose"],
          lamivudine: ["lamivudine", "epivir", "zeffix"],
          lamotrigine: ["lamotrigine", "lamictal"],
          lanreotide: ["lanreotide", "somatuline"],
          lansoprazole: ["lansoprazole", "zoton"],
          lanthanum: ["lanthanum", "lanthanum carbonate", "fosrenol"],
          lapatinib: ["lapatinib", "tyverb"],
          larotrectinib: ["larotrectinib", "vitrakvi"],
          laronidase: ["laronidase", "aldurazyme"],
          "lassars paste": ["lassars paste"],
          latanoprost: ["latanoprost", "xalatan", "monopost"],
          "latanoprost/timolol": ["latanoprost/timolol", "xalacom"],
          lecicarbon: ["lecicarbon"],
          leflunomide: ["leflunomide", "arava"],
          lenalidomide: ["lenalidomide", "revlimid"],
          lenograstim: ["lenograstim", "granocyte"],
          lenvatinib: ["lenvatinib", "kisplyx", "lenvima"],
          lercanidipine: ["lercanidipine", "zanidip"],
          letrozole: ["letrozole", "femara"],
          leuprorelin: ["leuprorelin acetate", "prostap", "lutrate"],
          levamisole: ["levamisole"],
          levetiracetam: ["levetiracetam", "keppra", "desitrend"],
          levonorgestrel: [
            "levonorgestrel",
            "levest",
            "levonelle",
            "upostelle",
            "emerres",
            "norgeston",
          ],
          levofloxacin: ["levofloxacin", "evoxil", "tavanic"],
          levobunolol: ["levobunolol", "betagan"],
          levothyroxine: ["levothyroxine", "levothyroid", "eltroxin"],
          levosimendan: ["levosimendan", "simdax"],
          levobupivacaine: ["levobupivacaine", "chirocaine"],
          levomepromazine: ["levomepromazine", "nozinan"],
          "levobupivacaine/fentanyl": ["levobupivacaine/fentanyl"],
          lidocaine: ["lidocaine", "lignocaine", "xylocaine", "versatis"],
          "lidocaine/adrenaline": [
            "lidocaine/adrenaline",
            "lignocaine/epinephrine",
            "xylocaine with adrenaline",
          ],
          "lidocaine/glucose": ["lidocaine/glucose"],
          "lidocaine/phenylephrine": ["lidocaine/phenylephrine", "instillagel"],
          "lidocaine/fluorescein": [
            "lidocaine/fluorescein",
            "minims lignocaine and fluorescein",
          ],
          linaclotide: ["linaclotide", "constella"],
          linagliptin: ["linagliptin", "trajenta"],
          linezolid: ["linezolid", "zyvox"],
          liothyronine: ["liothyronine", "tertroxin", "thybon"],
          lipegfilgrastim: ["lipegfilgrastim", "lonquex"],
          lipiodol: ["lipiodol ultra fluid"],
          liquigen: ["liquigen"],
          liraglutide: ["liraglutide", "victoza", "saxenda"],
          lisdexamfetamine: ["lisdexamfetamine", "elvanse"],
          lisinopril: ["lisinopril", "zestril", "lisicostad"],
          "lisinopril/hydrochlorothiazide": [
            "lisinopril/hydrochlorothiazide",
            "zestoretic",
          ],
          lithium: [
            "lithium chloride",
            "lithium citrate",
            "lithium carbonate",
            "priadel",
            "camcolit",
            "liskonum",
            "lithonate",
          ],
          lixisenatide: ["lixisenatide", "lyxumia"],
          locasol: ["locasol"],
          "flumetasone/clioquinol": ["flumetasone/clioquinol", "locorten"],
          lodoxamide: ["lodoxamide", "alomide"],
          loestrin: ["loestrin"],
          lofepramine: ["lofepramine", "gamanil"],
          logynon: ["logynon"],
          lomustine: ["lomustine", "ccnu"],
          loncastuximab: ["loncastuximab tesirine", "zynlonta"],
          loperamide: ["loperamide", "imodium", "diareze"],
          loprazolam: ["loprazolam"],
          loratadine: ["loratadine", "clarityn"],
          lorazepam: ["lorazepam", "ativan"],
          "lorenzos oil": ["lorenzos oil"],
          lorlatinib: ["lorlatinib", "lorviqua"],
          lormetazepam: ["lormetazepam"],
          "l-ornithine/l-aspartate": ["l-ornithine/l-aspartate"],
          losartan: ["losartan", "cozaar"],
          "losartan/hydrochlorothiazide": [
            "losartan/hydrochlorothiazide",
            "cozaar comp",
          ],
          loteprednol: ["loteprednol", "lotemax"],
          "clotrimazole/betamethasone": [
            "clotrimazole/betamethasone",
            "lotriderm",
          ],
          lurasidone: ["lurasidone", "latuda"],
          lutrol: ["lutrol"],
          lymecycline: ["lymecycline", "tetralysal"],
          macitentan: ["macitentan", "opsumit"],
          macrogol: [
            "macrogol",
            "movicol",
            "laxido",
            "cosmocol",
            "molaxole",
            "macilax",
            "polyethylene glycol with elect",
          ],
          magnesium: [
            "magnesium aspartate",
            "magnesium glycerophosphate",
            "magnesium sulphate",
            "magnesium trisilicate",
            "magnaspartate",
            "magnesiocard",
            "magnophate",
          ],
          malathion: ["malathion", "derbac", "prioderm", "suleo-m"],
          manevac: ["manevac"],
          mannitol: ["mannitol", "bronchitol", "osmohale"],
          maraviroc: ["maraviroc", "celsentri"],
          marvelon: ["marvelon"],
          mavacamten: ["mavacamten", "camzyos"],
          "glecaprevir/pibrentasvir": ["glecaprevir/pibrentasvir", "maviret"],
          "dexamethasone/neomycin/polymyxin": [
            "dexamethasone/neomycin/polymyxin",
            "maxitrol",
          ],
          mebendazole: ["mebendazole", "vermox", "ovex"],
          mebeverine: ["mebeverine", "colofac", "aurobeverine"],
          "Medi Derma-S": ["Medi Derma-S", "medi-derma s"],
          medroxyprogesterone: [
            "medroxyprogesterone",
            "provera",
            "depo-provera",
            "sayana press",
          ],
          "mefenamic acid": ["mefenamic acid", "ponstan"],
          megestrol: ["megestrol", "megace"],
          melatonin: ["melatonin", "circadin", "slenyto"],
          meloxicam: ["meloxicam", "mobic"],
          melphalan: ["melphalan", "alkeran"],
          memantine: ["memantine", "ebixa", "nemdatine"],
          menadiol: ["menadiol diphosphate"],
          "meningococcal vaccines": [
            "meningococcal acwy conjugate",
            "meningococcal b multicomponent",
            "meningococcal c",
            "menjugate",
            "nimenrix",
            "menveo",
            "bexsero",
            "trumenba",
          ],
          menthol: ["menthol", "menthol/eucalyptus"],
          mepacrine: ["mepacrine"],
          mepivacaine: ["mepivacaine", "scandonest"],
          mepolizumab: ["mepolizumab", "nucala"],
          meptazinol: ["meptazinol", "meptid"],
          mercaptamine: ["mercaptamine", "cystagon", "procysbi"],
          mercaptopurine: ["mercaptopurine", "puri-nethol", "xaluprine"],
          mercilon: ["mercilon"],
          meropenem: ["meropenem", "meronem"],
          mesalazine: [
            "mesalazine",
            "pentasa",
            "asacol",
            "octasa",
            "salofalk",
            "mezavant",
          ],
          mesna: ["mesna", "uromitexan"],
          metaraminol: ["metaraminol"],
          metanium: ["metanium"],
          metformin: [
            "metformin",
            "glucophage",
            "bolamyn",
            "diagemet",
            "glucient",
            "metabet",
          ],
          "metformin/alogliptin": ["metformin/alogliptin", "Vipdomet"],
          methadone: ["methadone", "physeptone", "methadose"],
          methacholine: ["methacholine", "provocholine"],
          methenamine: ["methenamine hippurate", "hiprex"],
          methocarbamol: ["methocarbamol", "robaxin"],
          methylcellulose: ["methylcellulose"],
          methyldopa: ["methyldopa", "aldomet"],
          methoxyflurane: ["methoxyflurane", "penthrox"],
          methylprednisolone: [
            "methylprednisolone",
            "medrone",
            "solu-medrone",
            "depo-medrone",
          ],
          "methylprednisolone/lidocaine": [
            "methylprednisolone/lidocaine",
            "depo-medrone with lidocaine",
          ],
          methotrexate: [
            "methotrexate",
            "maxtrex",
            "metoject",
            "nordimet",
            "zlatal",
          ],
          methylphenidate: [
            "methylphenidate",
            "ritalin",
            "concerta",
            "equasym",
            "medikinet",
            "xaggitin",
          ],
          "methoxy polyethylene glycol-epoetin beta": [
            "methoxy polyethylene glycol-epoetin beta",
            "mircera",
          ],
          metoclopramide: ["metoclopramide", "maxolon"],
          metolazone: ["metolazone", "xaqua", "zaroxolyn"],
          metoprolol: ["metoprolol", "betaloc", "lopresor"],
          metronidazole: [
            "metronidazole",
            "flagyl",
            "metrogel",
            "rozex",
            "acea",
            "anabact",
            "metrotop",
            "zyomet",
          ],
          metyrapone: ["metyrapone", "metopirone"],
          mexiletine: ["mexiletine", "namuscla"],
          mianserin: ["mianserin", "tolvon"],
          miconazole: ["miconazole", "daktarin", "gyno-daktarin", "micatin"],
          micronor: ["micronor"],
          midazolam: ["midazolam", "epistatis", "buccolam", "hypnovel"],
          "midazolam/lidocaine": ["midazolam/lidocaine"],
          midodrine: ["midodrine", "bramox"],
          midostaurin: ["midostaurin", "rydapt"],
          mifepristone: ["mifepristone", "mifegyne"],
          migraleve: ["migraleve pink", "migraleve duopack"],
          millinette: ["millinette"],
          milrinone: ["milrinone"],
          minocycline: ["minocycline", "minocin", "aknemin"],
          minoxidil: ["minoxidil", "loniten", "rogaine", "regaine"],
          mirabegron: ["mirabegron", "betmiga"],
          mirikizumab: ["mirikizumab", "omvoh"],
          mirtazapine: ["mirtazapine", "zispin"],
          misoprostol: ["misoprostol", "cytotec"],
          mitomycin: ["mitomycin", "mitomycin-c"],
          mitoxantrone: ["mitoxantrone", "onkotrone"],
          mitotane: ["mitotane", "lysodren"],
          "medical gases": [
            "air",
            "argon",
            "carbon dioxide",
            "entonox",
            "helium",
            "heliox",
            "nitrogen",
            "nitrous oxide",
            "oxygen",
            "nitronox",
          ],
          mivacurium: ["mivacurium", "mivacron"],
          "mmr vaccine": ["mmr vaccine", "priorix", "mmrvaxpro"],
          mobocertinib: ["mobocertinib", "exkivity"],
          moclobemide: ["moclobemide", "manerix"],
          modafinil: ["modafinil", "provigil"],
          modulen: ["modulen ibd"],
          molnupiravir: ["molnupiravir", "lagevrio"],
          mometasone: ["mometasone", "elocon", "nasonex", "asmanex"],
          momelotinib: ["momelotinib"],
          monogen: ["monogen"],
          montelukast: ["montelukast", "singulair"],
          morphine: [
            "morphine",
            "morphine sulphate",
            "morphine sulfate",
            "mst",
            "zomorph",
            "morphgesic",
            "mxl",
            "actimorp",
            "sevredol",
            "oramorph",
            "filnarine",
          ],
          moxifloxacin: ["moxifloxacin", "avelox", "moxivig"],
          moxisylyte: ["moxisylyte", "opilon"],
          moxonidine: ["moxonidine", "physiotens"],
          mupirocin: ["mupirocin", "bactroban"],
          mycophenolate: [
            "mycophenolate",
            "myfortic",
            "cellcept",
            "mycophenolate mofetil",
          ],
          mydricaine: ["mydricaine"],
          mydrane: ["mydrane"],
          nabilone: ["nabilone", "cesamet"],
          nabumetone: ["nabumetone", "relifex"],
          nadolol: ["nadolol", "corgard"],
          nafarelin: ["nafarelin", "synarel"],
          naftidrofuryl: ["naftidrofuryl", "praxilene"],
          naldemedine: ["naldemedine", "rizmoic"],
          "nalidixic acid": ["nalidixic acid"],
          naloxegol: ["naloxegol", "moventig"],
          naloxone: ["naloxone", "prenoxad", "nyxoid"],
          naltrexone: ["naltrexone", "nalcrom", "adepend"],
          naproxen: ["naproxen", "naprosyn", "stirlescent"],
          naratriptan: ["naratriptan", "naramig"],
          naseptin: ["naseptin", "chlorhexidine/neomycin"],
          natamycin: ["natamycin"],
          natalizumab: ["natalizumab", "tysabri", "tyruko"],
          nateglinide: ["nateglinide", "starlix"],
          nebivolol: ["nebivolol", "nebilet"],
          nefopam: ["nefopam", "acupan"],
          nelarabine: ["nelarabine", "atriance"],
          neocate: ["neocate advance", "neocate lcp"],
          neomycin: ["neomycin"],
          neostigmine: ["neostigmine", "prostigmin"],
          nepafenac: ["nepafenac", "nevanac"],
          neratinib: ["neratinib", "nerlynx"],
          nevirapine: ["nevirapine", "viramune"],
          nicardipine: ["nicardipine", "cardene"],
          nicotine: [
            "nicotine",
            "nicorette",
            "nicotinell",
            "niquitin",
            "nicopass",
            "nicopatch",
            "nicotrol",
          ],
          nicorandil: ["nicorandil", "ikorel"],
          nifedipine: [
            "nifedipine",
            "tensipine",
            "adalat",
            "adipine",
            "fortipine",
            "nifedipress",
            "coracten",
          ],
          nilotinib: ["nilotinib", "tasigna"],
          nimodipine: ["nimodipine", "nimotop"],
          nintedanib: ["nintedanib", "vargatef", "ofev"],
          niraparib: ["niraparib", "zejula"],
          nitrofurantoin: ["nitrofurantoin", "macrobid", "macrodantin"],
          nitrazepam: ["nitrazepam", "mogadon"],
          nivolumab: ["nivolumab", "opdivo"],
          nizatidine: ["nizatidine", "axid"],
          nonoxinol: ["nonoxinol-9", "gygel"],
          noradrenaline: ["noradrenaline", "norepinephrine"],
          norethisterone: [
            "norethisterone",
            "noriday",
            "primolut n",
            "utovlan",
            "noristerat",
          ],
          norgeston: [
            "norgeston",
            "levonorgestrel",
            "Levonorgestrel (Norgeston)",
          ],
          nortriptyline: ["nortriptyline", "allegron"],
          nuvaring: ["nuvaring"],
          nuvelle: ["nuvelle"],
          nystaform: ["nystaform"],
          nystatin: ["nystatin", "nystan"],
          "nystatin/chlorhexidine/hydrocortisone": [
            "nystatin/chlorhexidine/hydrocortisone",
            "Nystatin/Chlorhex/Hydrocortisone",
            "nystaform HC",
          ],
          "obeticholic acid": ["obeticholic acid", "ocaliva"],
          obinutuzumab: ["obinutuzumab", "gazyvaro"],
          ocrelizumab: ["ocrelizumab", "ocrevus"],
          ocriplasmin: ["ocriplasmin", "jetrea"],
          octenidine: ["octenidine", "octenilin", "octenisan"],
          olanzapine: ["olanzapine", "Zyprexa"],
          Olmesartan: ["Olmesartan", "Olmesartan medoxomil"],
          "Olmesartan/amlodipine": ["Olmesartan/amlodipine", "Sevikar"],
          "Olmesartan/amlodipine/hydrochlorothiazide": [
            "Olmesartan/amlodipine/hydrochlorothiazide",
            "Sevikar HCT",
          ],
          omeprazole: ["omeprazole", "Losec", "Mezzopram"],
          ondansetron: ["ondansetron", "Zofran"],
          otigo: ["otigo"],
          otinova: ["otinova"],
          otocomb: ["otocomb"],
          otomize: ["otomize"],
          "otrivine-antistin": [
            "otrivine-antistin",
            "xylometazoline/antazoline",
          ],
          oseltamivir: ["oseltamivir", "tamiflu"],
          oxaliplatin: ["oxaliplatin", "eloxatin"],
          oxazepam: ["oxazepam"],
          oxcarbazepine: ["oxcarbazepine", "trileptal"],
          oxerutins: ["oxerutins", "paroven"],
          pentoxifylline: ["pentoxifylline", "trental"],
          oxprenolol: ["oxprenolol", "trasicor"],
          oxybuprocaine: ["oxybuprocaine", "benoxinate"],
          oxybutynin: ["oxybutynin", "kentera", "lyrinel xl"],
          oxycodone: [
            "oxycodone",
            "oxynorm",
            "oxycontin",
            "shortec",
            "longtec",
            "reltebon",
            "oxypro",
          ],
          "oxycodone/naloxone": ["oxycodone/naloxone", "targinact"],
          oxygen: ["oxygen"],
          oxymetholone: ["oxymetholone", "anapolon"],
          oxytocin: ["oxytocin", "syntocinon"],
          oxytetracycline: ["oxytetracycline", "oxymycin"],
          ozanimod: ["ozanimod", "zeposia"],
          pabrinex: ["pabrinex"],
          paclitaxel: ["paclitaxel", "taxol", "abraxane"],
          palbociclib: ["palbociclib", "ibrance"],
          palivizumab: ["palivizumab", "synagis"],
          paliperidone: ["paliperidone", "invega", "xeplion", "trevicta"],
          palonosetron: ["palonosetron", "aloxi"],
          pancuronium: ["pancuronium"],
          panitumumab: ["panitumumab", "vectibix"],
          panobinostat: ["panobinostat", "farydak"],
          pantoprazole: ["pantoprazole", "protium"],
          papaverine: ["papaverine"],
          "papaverine/phentolamine": ["papaverine/phentolamine"],
          "hpv vaccine": ["papilloma vaccine", "gardasil", "cervarix"],
          paracetamol: [
            "paracetamol",
            "panadol",
            "calpol",
            "disprol",
            "perfalgan",
            "acetaminophen",
          ],
          paraffin: ["paraffin", "yellow soft paraffin", "liquid paraffin"],
          paraldehyde: ["paraldehyde"],
          parecoxib: ["parecoxib", "dynastat"],
          paricalcitol: ["paricalcitol", "zemplar"],
          paroxetine: ["paroxetine", "seroxat"],
          paromomycin: ["paromomycin", "humatin"],
          pasireotide: ["pasireotide", "signifor"],
          "patent blue": ["patent blue v"],
          patiromer: ["patiromer", "veltassa"],
          "nirmatrelvir/ritonavir": ["nirmatrelvir/ritonavir", "paxlovid"],
          pazopanib: ["pazopanib", "votrient"],
          pegaspargase: ["pegaspargase", "oncaspar"],
          pegfilgrastim: [
            "pegfilgrastim",
            "neulasta",
            "pelgraz",
            "ziextenzo",
            "fulphila",
            "pelmeg",
            "nyvepria",
          ],
          "peginterferon alfa-2a": ["peginterferon alfa-2a", "pegasys"],
          "peginterferon alfa-2b": ["peginterferon alfa-2b", "viraferonpeg"],
          "peginterferon beta": ["peginterferon beta-1a", "plegridy"],
          pembrolizumab: ["pembrolizumab", "keytruda"],
          pemetrexed: ["pemetrexed", "alimta"],
          "penicillin v": ["penicillin v", "phenoxymethylpenicillin"],
          penicillamine: ["penicillamine", "distamine"],
          pentosan: ["pentosan polysulphate", "elmiron"],
          pentostatin: ["pentostatin", "nipent"],
          pentamidine: ["pentamidine isethionate", "pentacarinat"],
          "peppermint oil": ["peppermint oil", "colpermin", "mintec"],
          peptamen: [
            "peptamen af",
            "peptamen hn",
            "peptamen jnr",
            "peptamen vanilla",
          ],
          "pepti-junior": ["pepti-junior"],
          peptisorb: ["peptisorb", "nutrison peptisorb plus hehp"],
          peptac: ["peptac"],
          perampanel: ["perampanel", "fycompa"],
          pergolide: ["pergolide", "celance"],
          pergoveris: ["follitropin/lutropin", "pergoveris"],
          pericyazine: ["pericyazine", "neulactil"],
          perindopril: ["perindopril", "coversyl"],
          "perindopril/amlodipine": ["perindopril/amlodipine"],
          "perindopril/indapamide": ["perindopril/indapamide"],
          permethrin: ["permethrin", "lyclear"],
          pertuzumab: ["pertuzumab", "perjeta"],
          "pertuzumab/trastuzumab": ["pertuzumab/trastuzumab", "phesgo"],
          pethidine: ["pethidine", "meperidine"],
          phenobarbital: [
            "phenobarbital",
            "phenobarbital teva",
            "phenobarbital accord",
            "phenobarbital bristol",
            "phenobarbital almus",
            "phenobarbital actavis",
          ],
          phenoxybenzamine: ["phenoxybenzamine", "dibenyline"],
          phenylephrine: ["phenylephrine", "phenylephrine hydrochloride"],
          phenytoin: [
            "phenytoin sodium flynn",
            "phenytoin sodium almus",
            "phenytoin sodium teva",
            "phenytoin sodium milpharm",
            "phenytoin sodium nrim",
            "phenytoin infatabs",
            "epanutin",
          ],
          phenol: ["phenol"],
          phenylbutazone: ["phenylbutazone"],
          phenelzine: ["phenelzine", "nardil"],
          phenindione: ["phenindione"],
          phentolamine: ["phentolamine", "rogitine"],
          "phenylephrine/tropicamide": [
            "phenylephrine/tropicamide",
            "mydriasert",
          ],
          phosphate: [
            "potassium acid phosphate",
            "phosphate enema",
            "joulies phosphate",
            "phosphate polyfusor",
            "phosphate sandoz",
            "fleet phosphate",
            "fleet ready-to-use",
          ],
          physostigmine: ["physostigmine salicylate", "antilirium"],
          physioneal: ["physioneal"],
          phytomenadione: ["phytomenadione", "konakion", "vitamin k1"],
          pilocarpine: ["pilocarpine", "salagen", "minims pilocarpine"],
          pimecrolimus: ["pimecrolimus", "elidel"],
          pimozide: ["pimozide", "orap"],
          pioglitazone: ["pioglitazone", "actos"],
          pipotiazine: ["pipotiazine", "piportil"],
          piracetam: ["piracetam", "nootropil"],
          pirfenidone: ["pirfenidone", "esbriet"],
          piroxicam: ["piroxicam", "feldene"],
          pivmecillinam: ["pivmecillinam", "selexid"],
          pixantrone: ["pixantrone", "pixuvri"],
          pizotifen: ["pizotifen", "sandomigran"],
          plerixafor: ["plerixafor", "mozobil"],
          plenvu: ["plenvu"],
          "pneumococcal vaccine": [
            "ppv vaccine",
            "pcv vaccine",
            "prevenar",
            "pneumovax",
            "synflorix",
          ],
          podophyllotoxin: ["podophyllotoxin", "warticon", "condyline"],
          "polatuzumab-vedotin": ["polatuzumab-vedotin", "polivy"],
          polihexanide: ["polihexanide", "prontosan"],
          "polyvinyl alcohol": [
            "polyvinyl alcohol",
            "liquifilm tears",
            "sno tears",
          ],
          polycal: ["polycal"],
          pomalidomide: ["pomalidomide", "imnovid"],
          ponatinib: ["ponatinib", "iclusig"],
          ponesimod: ["ponesimod", "ponvory"],
          poractant: ["poractant alpha", "poractant", "curosurf"],
          posaconazole: ["posaconazole", "noxafil"],
          "potassium/glucose/sodium chloride": [
            "potassium/glucose/sodium chloride",
          ],
          "potassium/glucose": ["potassium/glucose"],
          "potassium/sodium chloride": ["potassium/sodium chloride"],
          "potassium ascorbate": ["potassium ascorbate"],
          "potassium chloride": ["potassium chloride", "kay-cee-l"],
          "potassum chloride/potassium bicarbonate": [
            "potassum chloride/potassium bicarbonate",
            "potassum chloride/potassium bicarb",
            "sando-k",
            "potassium bicarbonate/pota",
            "Potassium Bicarb/Potassium Chloride",
          ],
          "potassium acetate": ["potassium acetate"],
          "potassium phosphate": ["potassium phosphate"],
          "potassium iodide": ["potassium iodide"],
          "potassium citrate": ["potassium citrate", "effercitrate"],
          "potassium acid phosphate": ["potassium acid phosphate"],
          "potassium permanganate": ["potassium permanganate"],
          "potassium canrenoate": ["potassium canrenoate"],
          "povidone iodine": ["povidone iodine", "betadine", "videne"],
          "povidone iodine/boric acid": ["povidone iodine/boric acid"],
          pramipexole: ["pramipexole", "mirapexin"],
          prasugrel: ["prasugrel", "efient"],
          pravastatin: ["pravastatin", "lipostat"],
          prazosin: ["prazosin", "hypovase"],
          praziquantel: ["praziquantel", "biltricide"],
          prednisolone: ["prednsiolone", "pred forte"],
          pregabalin: [
            "pregabalin",
            "lyrica",
            "alzain",
            "axalid",
            "lecaent",
            "rewisca",
          ],
          pregestimil: ["pregestimil lipil"],
          premarin: ["premarin"],
          premique: ["premique"],
          prempak: ["prempak"],
          prilocaine: ["prilocaine"],
          "prilocaine/felypressin": [
            "prilocaine/felypressin",
            "citanest with octapressin",
          ],
          primidone: ["primidone", "mysoline"],
          "imipenem/cilastatin": ["imipenem/cilastatin", "primaxin"],
          primaquine: ["primaquine"],
          pristinamycin: ["pristinamycin", "pyostacine"],
          propantheline: ["propantheline", "pro-banthine"],
          probenecid: ["probenecid"],
          probiotics: [
            "probiotics",
            "vsl#3",
            "symprove",
            "bio-kult",
            "optibac",
          ],
          procainamide: ["procainamide"],
          procyclidine: ["procyclidine", "kemadrin", "arpicolin"],
          procarbazine: ["procarbazine"],
          "pro-cal": ["pro-cal"],
          procaine: ["procaine"],
          "procaine penicillin": [
            "procaine penicillin",
            "procaine penicillin g",
            "procaine benzylpenicillin",
          ],
          Prochlorperazine: ["Prochlorperazine", "Buccastem", "Stemetil"],
          proctosedyl: ["proctosedyl"],
          proflavine: ["proflavine"],
          progesterone: [
            "progesterone",
            "utrogestan",
            "crinone",
            "lutigest",
            "cyclogest",
          ],
          proguanil: ["proguanil", "paludrine"],
          promethazine: ["promethazine", "phenergan"],
          promazine: ["promazine"],
          prontoderm: ["prontoderm"],
          prontosan: ["prontosan"],
          propamidine: ["propamidine isetionate", "golden eye"],
          propofol: ["propofol", "diprivan", "propoven"],
          propranolol: [
            "propranolol",
            "inderal",
            "bedranol",
            "beta-prograne",
            "syprol",
          ],
          propafenone: ["propafenone", "arythmol"],
          propiverine: ["propiverine", "detrunorm"],
          propylthiouracil: ["propylthiouracil"],
          proshield: ["proshield"],
          protirelin: ["protirelin"],
          protamine: ["protamine sulphate"],
          prothrombin: ["prothrombin complex", "beriplex", "octaplex"],
          protifar: ["protifar"],
          proxymetacaine: ["proxymetacaine", "proxymetacaine minims"],
          "proxymetacaine/fluorescein": ["proxymetacaine/fluorescein"],
          prucalopride: ["prucalopride", "resolor"],
          pseudoephedrine: ["pseudoephedrine", "sudafed"],
          psoriderm: ["psoriderm"],
          pyrazinamide: ["pyrazinamide"],
          pyridoxine: ["pyridoxine", "vitamin b6"],
          pyrimethamine: ["pyrimethamine", "daraprim"],
          pyridostigmine: ["pyridostigmine", "mestinon"],
          quetiapine: ["quetiapine", "seroquel"],
          quinapril: ["quinapril", "accupro"],
          quinagolide: ["quinagolide", "norprolac"],
          quinine: [
            "quinine sulphate",
            "quinine dihydrochloride",
            "quinine bisulphate",
          ],
          quizartinib: ["quizartinib", "vanflyta"],
          rabeprazole: ["rabeprazole", "pariet"],
          "rabies vaccine": ["rabies vaccine", "rabipur", "rabies verorab"],
          raloxifene: ["raloxifene", "evista"],
          raltitrexed: ["raltitrexed", "tomudex"],
          raltegravir: ["raltegravir", "isentress"],
          ramipril: ["ramipril"],
          ranibizumab: ["ranibizumab", "lucentis", "ongavia"],
          ranolazine: ["ranolazine", "ranexa"],
          rasagiline: ["rasagiline", "azilect"],
          rasburicase: ["rasburicase", "fasturtec"],
          ravulizumab: ["ravulizumab", "ultomiris"],
          reboxetine: ["reboxetine", "edronax"],
          regorafenib: ["regorafenib", "stivarga"],
          relvar: ["relvar ellipta", "fluticasone furoate/vilanterol"],
          "relugolix/estradiol/norethisterone": [
            "relugolix/estradiol/norethisterone",
            "ryeqo",
          ],
          remdesivir: ["remdesivir", "veklury"],
          remifentanil: ["remifentanil", "ultiva"],
          renapro: ["renapro"],
          renastart: ["renastart"],
          renavit: ["renavit"],
          repaglinide: ["repaglinide", "prandin"],
          reslizumab: ["reslizumab", "cinqaero"],
          resonium: [
            "resonium",
            "resonium a",
            "calcium resonium",
            "sps",
            "sodium polystyrene sulfonate",
          ],
          retigabine: ["retigabine", "trobalt"],
          rezolsta: ["rezolsta", "darunavir/cobicistat"],
          riamet: ["riamet", "artemether/lumefantrine"],
          ribavirin: ["ribavirin", "rebetol", "copegus"],
          riboflavin: ["riboflavin", "vitamin b2"],
          ribociclib: ["ribociclib", "kisqali"],
          rifampicin: ["rifampicin", "rifadin", "rimactane"],
          rifabutin: ["rifabutin", "mycobutin"],
          rifaximin: ["rifaximin", "targaxan", "xifaxanta"],
          rifater: ["rifater", "rifampicin/isoniazid/pyrazinamide"],
          "isoniazid/rifampicin": ["isoniazid/rifampicin", "rifinah"],
          rigevidon: ["rigevidon"],
          rilpivirine: ["rilpivirine", "edurant"],
          riluzole: ["riluzole", "rilutek", "teglutik"],
          rimexolone: ["rimexolone", "vexol"],
          rimegepant: ["rimegepant", "vydura"],
          riociguat: ["riociguat", "adempas"],
          risankizumab: ["risankizumab", "skyrizi"],
          risedronate: ["risedronate sodium", "actonel"],
          risperidone: ["risperidone", "risperdal", "risperdal consta"],
          ritonavir: ["ritonavir", "norvir"],
          rituximab: [
            "rituximab",
            "mabthera",
            "truxima",
            "ruxience",
            "rixathon",
            "riximyo",
            "blitzima",
          ],
          rivaroxaban: ["rivaroxaban", "xarelto"],
          rivastigmine: ["rivastigmine", "exelon"],
          rizatriptan: ["rizatriptan", "maxalt"],
          rocuronium: ["rocuronium bromide", "rocuronium", "esmeron"],
          roflumilast: ["roflumilast", "daxas"],
          romiplostim: ["romiplostim", "nplate"],
          romosozumab: ["romosozumab", "evenity"],
          ropeginterferon: ["ropeginterferon alfa-2b", "besremi"],
          ropivacaine: ["ropivacaine", "naropin"],
          ropinirole: ["ropinirole", "requip", "ralnea", "spiroco"],
          rosuvastatin: ["rosuvastatin", "crestor"],
          rotavirus: ["rotavirus", "rotarix", "rotateq"],
          rotigotine: ["rotigotine", "neupro"],
          roxadustat: ["roxadustat", "evrenzo"],
          "rsv vaccine": ["rsv vaccine", "arexvy", "beyfortus"],
          rucaparib: ["rucaparib", "rubraca"],
          rufinamide: ["rufinamide", "inovelon"],
          ruxolitinib: ["ruxolitinib", "jakavi"],
          saccharin: ["saccharin"],
          sacituzumab: ["sacituzumab govitecan", "trodelvy"],
          "sacubitril/valsartan": ["sacubitril/valsartan", "entresto"],
          safinamide: ["safinamide", "xadago"],
          salactol: ["salactol"],
          salbutamol: ["salbutamol", "salamol", "Ventolin", "albuterol"],
          "salbutamol/ipratropium": ["salbutamol/ipratropium", "combivent"],
          "salicylic acid": ["salicylic acid"],
          salmeterol: ["salmeterol", "serevent"],
          sandocal: ["sandocal", "calvive", "sandocal", "Sandocal/Calvive"],
          sarilumab: ["sarilumab", "kevzara"],
          sativex: ["sativex", "nabiximols"],
          saxagliptin: ["saxagliptin", "onglyza"],
          scandishake: ["scandishake"],
          scheriproct: ["scheriproct"],
          secukinumab: ["secukinumab", "cosentyx"],
          selegiline: ["selegiline", "eldepryl", "zelapar"],
          selexipag: ["selexipag", "uptravi"],
          selenium: ["selenium", "selenase"],
          selinexor: ["selinexor", "nexpovio"],
          selpercatinib: ["selpercatinib", "retsevmo"],
          semaglutide: ["semaglutide", "ozempic", "rybelsus", "wegovy"],
          "semisodium valproate": [
            "semisodium valproate",
            "depakote",
            "valproic acid",
            "convulex",
            "syonell",
            "belvo",
          ],
          senna: ["senna", "senokot", "manevac", "sennosides"],
          sertraline: ["sertraline", "lustral"],
          sevelamer: ["sevelamer", "renagel", "renvela"],
          sevoflurane: ["sevoflurane"],
          "short chain fatty acid": ["short chain fatty acid"],
          sildenafil: [
            "sildenafil",
            "viagra",
            "revatio",
            "granpidam",
            "nipatra",
          ],
          "silver nitrate": ["silver nitrate"],
          "silver sulfadiazine": ["silver sulfadiazine", "flamazine"],
          simbrinza: ["simbrinza", "brinzolamide/brimonidine"],
          simeticone: ["simeticone", "infacol"],
          simeprevir: ["simeprevir", "olysio"],
          "simple eye": ["simple eye ointment"],
          "simple linctus": ["simple linctus", "simple paediatric linctus"],
          simvastatin: ["simvastatin", "zocor", "simvador"],
          siopel: ["siopel"],
          siponimod: ["siponimod", "mayzent"],
          sirdupla: ["sirdupla"],
          sirolimus: ["sirolimus", "rapamune"],
          sitagliptin: ["sitagliptin", "januvia"],
          "sitagliptin/metformin": ["sitagliptin/metfromin", "janumet"],
          sma: ["sma high energy", "sma powder lactose free"],
          "smallpox vaccine": [
            "smallpox vaccine",
            "smallpox/monkeypox vaccine",
            "imvanex",
            "jynneos",
          ],
          smofkabiven: [
            "smofkabiven",
            "smofkabiven ef",
            "smofkabiven en",
            "smofkabiven lo",
          ],
          smoflipid: ["smoflipid"],
          "sodium aurothiomalate": ["sodium aurothiomalate", "myocrisin"],
          "sodium acetate": ["sodium acetate"],
          "sodium bicarbonate": ["sodium bicarbonate"],
          "sodium benzoate": ["sodium benzoate"],
          "sodium chloride": ["sodium chloride", "saline"],
          "Sodium cromoglicate": ["Sodium cromoglicate", "cromoglicate"],
          "sodium citrate": ["sodium citrate"],
          "sodium valproate": [
            "Sodium Valp. (Epilim)",
            "Epilim",
            "Sodium Valp. (Episenta)",
            "Episenta",
            "Sodium valp.",
            "Dyzantil",
            "Epival",
            "Depakin",
          ],
          solifenacin: ["solifenacin"],
          somatropin: [
            "somatropin",
            "genotropin",
            "norditropin",
            "zomacton",
            "humatrope",
            "saizen",
            "omnitrope",
            "nutropin",
          ],
          somatrogon: ["somatrogon", "ngenla"],
          sorafenib: ["sorafenib", "nexavar"],
          sos: ["s.o.s"],
          sotalol: ["sotalol", "beta-cardone", "sotacor"],
          sotorasib: ["sotorasib", "lumykras"],
          sotrovimab: ["sotrovimab", "xevudy"],
          spectinomycin: ["spectinomycin"],
          spiolto: ["spiolto", "tiotropium/olodaterol"],
          spironolactone: ["spironolactone", "aldactone"],
          sprilon: ["sprilon"],
          stalevo: ["stalevo", "levodopa/carbidopa/entacapone"],
          stanek: ["stanek"],
          stanozolol: ["stanozolol"],
          stiripentol: ["stiripentol", "diacomit"],
          streptomycin: ["streptomycin"],
          streptokinase: ["streptokinase", "streptase"],
          stribild: [
            "stribild",
            "elvitegravir/cobicistat/emtricitabine/tenofovir",
          ],
          strontium: ["strontium", "protelos", "aresto"],
          suboxone: ["suboxone", "buprenorphine/naloxone"],
          sucralfate: ["sucralfate", "antepsin"],
          sucrose: ["sucrose"],
          "sucroferric oxyhydroxide": ["sucroferric oxyhydroxide", "velphoro"],
          sudocrem: ["sudocrem"],
          sugammadex: ["sugammadex", "bridion"],
          sulfinpyrazone: ["sulfinpyrazone"],
          sulfasalazine: ["sulfasalazine", "salazopyrin"],
          sulpiride: ["sulpiride", "dolmatil", "sulpor"],
          sulfadiazine: ["sulfadiazine"],
          "sulphur hexafluoride": ["sulphur hexafluoride", "sonovue"],
          sulphamethoxypyridazine: ["sulphamethoxypyridazine"],
          sultiame: ["sultiame", "ospolot"],
          sumatriptan: ["sumatriptan", "imigran"],
          sunitinib: ["sunitinib", "sutent"],
          suxamethonium: [
            "suxamethonium chloride",
            "suxamethonium",
            "anectine",
          ],
          symbicort: ["symbicort", "budesonide/formoterol"],
          symtuza: ["symtuza", "darunavir/cobicistat/emtricitabine/tenofovir"],
          syntometrine: ["syntometrine", "ergometrine/oxytocin"],
          syreniring: ["syreniring"],
          tacrolimus: [
            "tacrolimus",
            "prograf",
            "adoport",
            "advagraf",
            "envarsus",
            "modigraf",
          ],
          tadalafil: ["tadalafil", "cialis", "adcirca"],
          tafluprost: ["tafluprost", "saflutan"],
          talazoparib: ["talazoparib", "talzenna"],
          talc: ["sterile talc"],
          tamoxifen: ["tamoxifen", "nolvadex"],
          tamsulosin: ["tamsulosin", "flomax", "pinexel", "tamfrex"],
          "tamsulosin/solifenacin": ["tamsulosin/solifenacin", "vesomni"],
          tapentadol: ["tapentadol", "palexia"],
          taurolidine: ["taurolidine", "taurolock"],
          tazarotene: ["tazarotene", "zorac"],
          "piperacillin/tazobactam": ["piperacillin/tazobactam", "tazocin"],
          teclistamab: ["teclistamab", "tecvayli"],
          teduglutide: ["teduglutide", "revestive"],
          teicoplanin: ["teicoplanin", "targocid"],
          telaprevir: ["telaprevir", "incivo"],
          telmisartan: ["telmisartan", "micardis"],
          "telmisartan/hydrochlorothiazide": [
            "telmisartan/hydrochlorothiazide",
            "micardis plus",
          ],
          temazepam: ["temazepam", "normison"],
          temozolomide: ["temozolomide", "temodal"],
          temocillin: ["temocillin", "negaban"],
          temsirolimus: ["temsirolimus", "torisel"],
          tenecteplase: ["tenecteplase", "metalyse"],
          tenofovir: [
            "tenofovir alafenamide",
            "tenofovir disoproxil",
            "viread",
          ],
          tepotinib: ["tepotinib", "tepmetko"],
          terazosin: ["terazosin", "hytrin"],
          terbinafine: ["terbinafine", "lamisil"],
          terbutaline: ["terbutaline", "bricanyl"],
          teriflunomide: ["teriflunomide", "aubagio"],
          teriparatide: [
            "teriparatide",
            "terrosa",
            "forsteo",
            "movymia",
            "osmunda",
          ],
          terlipressin: ["terlipressin", "glypressin", "variquel"],
          testosterone: [
            "testosterone",
            "testosterone esters",
            "testosterone undecanoate",
            "testosterone enanthate",
            "testosterone propionate",
            "testogel",
            "tostran",
            "restandol",
            "sustanon",
            "nebido",
          ],
          tetracaine: [
            "tetracaine",
            "ametop",
            "minims tetracaine hydrochloride",
          ],
          tetracycline: ["tetracycline"],
          tetracosactide: ["tetracosactide"],
          tetrabenazine: ["tetrabenazine", "xenazine", "revocon"],
          tezepelumab: ["tezepelumab", "tezspire"],
          thalidomide: ["thalidomide"],
          trometamol: ["trometamol", "tris"],
          theophylline: ["theophylline", "nuelin", "uniphyllin", "slo-phyllin"],
          thiamine: ["thiamine", "vitamin b1", "benerva"],
          thiotepa: ["thiotepa", "tepadina"],
          thiopental: ["thiopental sodium", "thiopentone"],
          tioguanine: ["tioguanine", "lanvis"],
          tiagabine: ["tiagabine", "gabitril"],
          tibolone: ["tibolone", "livial"],
          ticagrelor: ["ticagrelor", "brilique"],
          tigecycline: ["tigecycline", "tygacil"],
          timodine: ["timodine"],
          timolol: ["timolol", "timolol maleate", "timoptol", "betim"],
          "timolol/bendroflumethiazide": ["timolol/bendroflumethiazide"],
          tinzaparin: ["tinzaparin", "innohep"],
          tioconazole: ["tioconazole", "trosyl"],
          tiopronin: ["tiopronin"],
          tiotropium: ["tiotropium", "spiriva", "braltus", "acopair"],
          tiratricol: ["tiratricol", "emcitate"],
          tirbanibulin: ["tirbanibulin", "klisyri"],
          tirofiban: ["tirofiban", "aggrastat"],
          tirzepatide: ["tirzepatide", "mounjaro"],
          tisseel: ["tisseel"],
          tivozanib: ["tivozanib", "fotivda"],
          tizanidine: ["tizanidine", "zanaflex"],
          tobramycin: [
            "tobramycin",
            "tobi",
            "bramitob",
            "tymbrineb",
            "vantobra",
          ],
          tocilizumab: ["tocilizumab", "roactemra", "tyenne"],
          tocopherol: ["alpha tocopherol acetate", "vitamin e"],
          tocofersolan: ["tocofersolan"],
          tofacitinib: ["tofacitinib", "xeljanz"],
          tolbutamide: ["tolbutamide"],
          tolcapone: ["tolcapone", "tasmar"],
          tolterodine: ["tolterodine", "detrusitol"],
          tolvaptan: ["tolvaptan", "samsca", "jinarc"],
          topiramate: ["topiramate", "topamax"],
          topotecan: ["topotecan", "hycamtin"],
          trametinib: ["trametinib", "mekinist"],
          tramadol: [
            "tramadol",
            "zydol",
            "zamadol",
            "marol",
            "maxitram",
            "tramquel",
          ],
          "tramadol/paracetamol": ["tramadol/paracetamol", "tramacet"],
          "tranexamic acid": ["tranexamic acid", "cyclokapron", "cyklokapron"],
          tranylcypromine: ["tranylcypromine", "parnate"],
          trandolapril: ["trandolapril", "gopten"],
          transvasin: ["transvasin"],
          trastuzumab: [
            "trastuzumab",
            "herceptin",
            "herzuma",
            "ontruzant",
            "kadcyla",
            "enhertu",
            "ogivri",
            "trazimera",
          ],
          travoprost: ["travoprost", "travatan"],
          "travoprost/timolol": ["travoprost/timolol", "duotrav"],
          trazodone: ["trazodone", "molipaxin"],
          trelegy: [
            "trelegy",
            "trelegy ellipta",
            "fluticasone/umeclidinium/vilanterol",
          ],
          tretinoin: ["tretinoin", "retin-a", "airol"],
          triamcinolone: [
            "triamcinolone",
            "adcortyl",
            "kenalog",
            "triesence",
            "nasacort",
          ],
          "trichloracetic acid": ["trichloracetic acid"],
          trientine: ["trientine dihydrochloride", "cufence", "cuprior"],
          trifluorothymidine: ["trifluorothymidine"],
          trifluoperazine: ["trifluoperazine", "stelazine"],
          "trifluridine/tipiracil": ["trifluridine-tipiracil", "lonsurf"],
          trihexyphenidyl: ["trihexyphenidyl", "benzhexol"],
          trimethoprim: ["trimethoprim", "monotrim"],
          trimipramine: ["trimipramine", "surmontil"],
          trimbow: [
            "trimbow",
            "beclometasone/formoterol/glycopyrronium",
            "beclometasone/extrafine/parti3 ",
          ],
          trimovate: ["trimovate", "clobetasone/oxytetracycline/nystatin"],
          triomel: ["triomel"],
          triptorelin: ["triptorelin", "decapeptyl", "gonapeptyl", "salvacyl"],
          trisequens: ["trisequens"],
          triumeq: ["triumeq", "dolutegravir/abacavir/lamivudine"],
          tropicamide: ["tropicamide", "mydriacyl", "minims tropicamide"],
          trospium: ["trospium", "regurin", "flotros"],
          truvada: ["truvada", "emtricitabine/tenofovir"],
          tryptophan: ["tryptophan", "optimax"],
          tucatinib: ["tucatinib", "tukysa"],
          "typhoid vaccine": [
            "typhoid vaccine",
            "vivotif",
            "typherix",
            "typhim vi",
          ],
          tyrozets: ["tyrozets"],
          ubiquinone: ["ubiquinone coenzyme q10", "coq10"],
          ulipristal: ["ulipristal acetate", "ellaone", "esmya"],
          ultibro: ["ultibro", "indacaterol/glycopyrronium"],
          umeclidinium: ["umeclidinium", "incruse ellipta"],
          upadacitinib: ["upadacitinib", "rinvoq"],
          urea: ["urea", "hydromol forte"],
          uridine: ["uridine triacetate", "xuriden"],
          urographin: ["urographin"],
          urokinase: ["urokinase", "syner-kinase"],
          "ursodeoxycholic acid": [
            "ursodeoxycholic acid",
            "ursofalk",
            "urso",
            "cholurso",
          ],
          ustekinumab: ["ustekinumab", "stelara", "pyzchiva", "wezenla"],
          uvistat: ["uvistat"],
          valaciclovir: ["valaciclovir", "valtrex"],
          valganciclovir: ["valganciclovir", "valcyte"],
          valsartan: ["valsartan", "diovan"],
          "valsartan/hydrochlorothiazide": [
            "valsartan/hydrochlorothiazide",
            "co-diovan",
          ],
          vamin: ["vamin", "vaminolact"],
          vancomycin: ["vancomycin", "vancocin", "vancomycin flynn"],
          "vancomycin/heparin": ["vancomycin/heparin"],
          vardenafil: ["vardenafil", "levitra"],
          varenicline: ["varenicline", "champix"],
          "varicella-zoster vaccine": [
            "varicella-zoster vaccine",
            "varilrix",
            "varivax",
            "shingrix",
            "zostavax",
          ],
          vasopressin: ["vasopressin", "empressin"],
          vecuronium: ["vecuronium bromide", "norcuron"],
          vedolizumab: ["vedolizumab", "entyvio"],
          vemurafenib: ["vemurafenib", "zelboraf"],
          venlafaxine: ["venlafaxine", "efexor", "alventa", "venaxx"],
          venetoclax: ["venetoclax", "venclyxto"],
          verapamil: ["verapamil", "securon", "vertab", "cordilox", "univer"],
          viatim: ["viatim"],
          viekirax: ["viekirax", "ombitasvir/paritaprevir/ritonavir"],
          vigabatrin: ["vigabatrin", "sabril"],
          vildagliptin: ["vildagliptin", "galvus"],
          vinblastine: ["vinblastine sulphate"],
          vincristine: ["vincristine sulphate", "oncovin"],
          vindesine: ["vindesine"],
          vinflunine: ["vinflunine", "javlor"],
          vinorelbine: ["vinorelbine", "navelbine"],
          "viper antiserum": ["viper venom antiserum", "viperfav"],
          viscoat: ["viscoat"],
          "vitamin a": [
            "vitamin a",
            "retinol",
            "retinol palmitate",
            "vitamin a palmitate",
          ],
          "vitamin b compound": ["vitamin b compound strong", "vigranon b"],
          "vitamins a and d": ["vitamins a and d", "abidec"],
          vitlipid: ["vitlipid"],
          voclosporin: ["voclosporin", "lupkynis"],
          volplex: ["volplex"],
          volumatic: [
            "volumatic spacer device",
            "volumatic with paediatric mask",
          ],
          "von willebrand factor": [
            "von willebrand factor",
            "wilfactin",
            "wilstart",
          ],
          voractiv: ["voractiv"],
          voriconazole: ["voriconazole", "vfend"],
          vortioxetine: ["vortioxetine", "brintellix"],
          vosevi: ["vosevi", "sofosbuvir/velpatasvir/voxilaprevir"],
          "vsl#3": ["vsl#3"],
          warfarin: ["warfarin sodium", "warfarin", "marevan"],
          "water for injection": ["water for injection"],
          "water for irrigation": [
            "sterile water for irrigation",
            "wilaqua sterile water",
          ],
          "water for inhalation": ["water for inhalation"],
          wysoy: ["wysoy formula"],
          xalacom: ["xalacom", "latanoprost/timolol"],
          xipamide: ["xipamide", "diurexan"],
          xylometazoline: [
            "xylometazoline hcl",
            "Otrivine Adult",
            "Otrivine Child",
            "galpseud",
            "Otrivine Allergy Relief",
            "Otrivine Congestion Relief",
          ],
          yasmin: ["yasmin", "lucette"],
          yes: ["yes vm gel", "yes wb lubricant gel"],
          zafirlukast: ["zafirlukast", "accolate"],
          zanamivir: ["zanamivir", "relenza"],
          zanubrutinib: ["zanubrutinib", "brukinsa"],
          zepatier: ["zepatier", "elbasvir/grazoprevir"],
          zerobase: ["zerobase"],
          zerocream: ["zerocream"],
          zerodouble: ["zerodouble"],
          zidovudine: ["zidovudine", "retrovir", "azt"],
          "zidovudine/lamivudine": ["zidovudine/lamivudine", "combivir"],
          zirconium: ["zirconium"],
          zinc: ["zinc sulphate", "zinc acetate", "zincomed", "solvazinc"],
          zineryt: ["zineryt", "erythromycin/zinc"],
          "zoledronic acid": ["zoledronic acid", "zometa", "aclasta"],
          zolmitriptan: ["zolmitriptan", "zomig"],
          zolpidem: ["zolpidem", "stilnoct"],
          zonisamide: ["zonisamide", "zonegran"],
          zopiclone: ["zopiclone", "zimovane"],
          zuclopenthixol: [
            "zuclopenthixol",
            "zuclopenthixol decanoate",
            "clopixol",
          ],
        },
      };

      // Formulation Dictionary with Priority System
      // Priority 3: Branded/specific devices or formulations
      // Priority 2: Specific formulation types/categories
      // Priority 1: Generic terms

      const formulationDict = {
        oral: {
          liquid: {
            priority_groups: {
              specific_formulations: {
                priority: 2,
                terms: {
                  concentrated: [
                    "concentrated oral solution",
                    "concentrate for oral solution",
                    "oral concentrate",
                    "conc oral soln",
                    "concentrated soln",
                    "conc soln",
                  ],
                  specific_solution: [
                    "oral solution",
                    "oral soln",
                    "solution for oral use",
                    "oral drops solution",
                    "oral soln drops",
                  ],
                  specific_suspension: [
                    "oral suspension",
                    "oral susp",
                    "powder for oral suspension",
                    "powder for susp",
                    "pwd for oral susp",
                    "granules for oral suspension",
                    "granules for susp",
                    "gran for oral susp",
                    "suspension for oral use",
                    "oral suspension sugar free",
                    "oral susp sf",
                    "suspension sf",
                    "susp sugar free",
                  ],
                  specific_syrup: [
                    "oral syrup",
                    "syrup bp",
                    "syrup sugar free",
                    "syr sf",
                  ],
                  specific_drops: [
                    "oral drops",
                    "oral liquid drops",
                    "drops for oral use",
                    "oral use drops",
                    "concentrate drops",
                  ],
                  specific_emulsion: [
                    "oral emulsion",
                    "oral drops emulsion",
                    "emulsion for oral use",
                    "oral emuls",
                    "emulsion oral",
                    "oral liquid emulsion",
                  ],
                },
              },
              generic_terms: {
                priority: 1,
                terms: [
                  "solution",
                  "soln",
                  "elixir",
                  "liquid",
                  "mixture",
                  "mixt",
                  "oral liquid",
                  "liquid oral",
                  "suspension",
                  "susp",
                  "syrup",
                  "syr",
                  "drops",
                  "liquid drops",
                  "dropper bottle",
                  "drop",
                  "oral drop",
                  "emulsion",
                  "liquid emulsion",
                  "emuls",
                ],
              },
            },
          },
          solid: {
            tablet_formulations: {
              priority_groups: {
                specific_formulations: {
                  priority: 2,
                  terms: {
                    film_coated: [
                      "film coated tablet",
                      "film-coated tablet",
                      "film coated tablets",
                      "film-coated tablets",
                      "fc tablet",
                      "f/c tablet",
                      "f.c. tablet",
                      "f c tablet",
                      "filmed coated",
                      "fc",
                      "f/c",
                      "f.c.",
                      "f c",
                    ],
                    dispersible_tablets: [
                      "dispersible tablet",
                      "disp tablet",
                      "d tablet",
                      "soluble tablet",
                      "orodispersible tablet",
                      "orodisp tablet",
                      "orodisp. tablet",
                      "dispersible tablets",
                      "soluble tablets",
                      "oral dispersible tablet",
                    ],
                    sublingual_tablets: [
                      "sublingual tablet",
                      "sl tablet",
                      "s/l tablet",
                      "s.l. tablet",
                      "s l tablet",
                      "sublingual film",
                    ],
                    buccal: ["buccal tablet", "buccal film"],
                    chewable: [
                      "chewable tablet",
                      "chew tablet",
                      "chew tab",
                      "chew tabs",
                    ],
                    chewing_gum: ["chewing gum", "chewing-gum"],
                  },
                },
                generic_terms: {
                  priority: 1,
                  terms: {
                    basic_tablets: [
                      "tablet",
                      "tab",
                      "tabs",
                      "tablets",
                      "caplet",
                      "caplets",
                    ],
                    dispersible_terms: [
                      "dispersible",
                      "disp.",
                      "disp",
                      "soluble",
                      "orodispersible",
                      "orodisp.",
                      "orodisp",
                    ],
                    sublingual_terms: [
                      "sublingual",
                      "sl",
                      "s/l",
                      "s.l.",
                      "s l",
                    ],
                    buccal_terms: ["buccal"],
                    chewable_terms: ["chewable", "gum"],
                  },
                },
              },
            },
          },
          capsule: {
            priority_groups: {
              specific_formulations: {
                priority: 2,
                terms: {
                  hard_capsules: [
                    "hard capsule",
                    "hard cap",
                    "hard caps",
                    "hard gelatin capsule",
                    "hard gel capsule",
                    "hgc",
                  ],
                  soft_capsules: [
                    "soft capsule",
                    "soft cap",
                    "soft caps",
                    "soft gelatin capsule",
                    "soft gel capsule",
                    "sgc",
                  ],
                },
              },
              generic_terms: {
                priority: 1,
                terms: ["capsule", "cap", "caps", "capsules"],
              },
            },
          },
          sublingual_spray: {
            priority_groups: {
              specific_formulations: {
                priority: 2,
                terms: [
                  "sublingual spray",
                  "s/l spray",
                  "sl spray",
                  "sub-lingual spray",
                  "oral spray for sublingual use",
                  "spray for sublingual use",
                  "sublingual oral spray",
                  "under tongue spray",
                ],
              },
              generic_terms: {
                priority: 1,
                terms: ["mouth spray", "oral spray", "oromucosal spray"],
              },
            },
          },
          other: {
            priority_groups: {
              specific_formulations: {
                priority: 2,
                terms: {
                  granules_powders: [
                    "oral powder",
                    "powder for oral solution",
                    "oral granules",
                    "effervescent granules",
                    "powder for oral suspension",
                    "granules for oral suspension",
                    "oral powder sachet",
                    "sachet",
                    "sachets",
                    "powder for solution",
                    "powder for susp",
                    "powder for suspension",
                  ],
                  oro_dispersible: [
                    "oral lyophilisate",
                    "oro-dispersible tablet",
                    "orodispersible tablet",
                    "orodispersible film",
                    "oral film",
                    "mouth dissolving tablet",
                    "mouth dissolving film",
                    "lyophilized tablet",
                    "lyophilised tablet",
                  ],
                },
              },
              generic_terms: {
                priority: 1,
                terms: [
                  "granules",
                  "sachets",
                  "powder sachets",
                  "gran",
                  "gran sachet",
                  "melt",
                  "orodisp tab",
                  "oro tab",
                  "orodispersible",
                  "oral dispersible",
                  "rapidly dispersible",
                ],
              },
            },
          },
        },

        parenteral: {
          injection: {
            priority_groups: {
              specific_formulations: {
                priority: 2,
                terms: {
                  solution: [
                    "injection solution",
                    "solution for injection",
                    "soln for injection",
                    "concentrate for solution for injection",
                    "conc for soln for inj",
                    "concentrate for injection",
                    "conc for inj",
                    "solution concentrate",
                    "soln conc",
                    "solution for inj",
                    "sterile solution",
                  ],
                  powder: [
                    "powder for injection",
                    "powder for reconstitution",
                    "powder for solution",
                    "lyophilised powder",
                    "lyophilized powder",
                    "dry powder for injection",
                    "powder and solvent",
                    "powder for concentrate",
                    "powder for concentrate for solution",
                    "sterile powder",
                    "powder for solution for injection",
                  ],
                  suspension: [
                    "suspension for injection",
                    "injectable suspension",
                    "suspension injection",
                    "sterile suspension",
                    "suspension injectable",
                  ],
                  implant: [
                    "depot injection",
                    "long-acting injection",
                    "long acting injection",
                    "subcutaneous implant",
                    "implantation matrix",
                    "matrix implant",
                  ],
                },
              },
              generic_terms: {
                priority: 1,
                terms: [
                  "injection",
                  "injectable solution",
                  "inj",
                  "injectable",
                  "for injection",
                  "for inj",
                  "injectable soln",
                  "inj soln",
                  "injection soln",
                  "solution injectable",
                  "sterile soln",
                  "pwd for inj",
                  "pwd for recon",
                  "pwd for soln",
                  "lyo powder",
                  "dry pwd for inj",
                  "pwd and solvent",
                  "pwd for conc",
                  "pwd for conc for soln",
                  "pwd for soln for inj",
                  "susp for inj",
                  "inj susp",
                  "susp inj",
                  "sterile susp",
                  "implant",
                  "depot inj",
                  "depot",
                  "la injection",
                  "l/a injection",
                  "sc implant",
                  "s/c implant",
                ],
              },
            },
            container: {
              priority_groups: {
                specific_devices: {
                  priority: 3,
                  terms: {
                    Flexpen: [
                      "Flexpen",
                      "Flex Pen",
                      "Flex-Pen",
                      "Flexpens",
                      "Flex Pens",
                      "Flex-Pens",
                    ],
                    Flextouch: ["Flextouch", "Flex Touch", "Flex-Touch"],
                    Solostar: ["Solostar", "Solo Star", "Flex-Touch"],
                    Doublestar: ["Doublestar", "Double Star", "Double-Star"],
                    KwikPen: ["KwikPen", "Kwik Pen", "Kwik-Pen"],
                    Innolet: ["Innolet"],
                  },
                },
                specific_containers: {
                  priority: 2,
                  terms: {
                    Cartridge: [
                      "cartridges",
                      "cart",
                      "carts",
                      "pre-filled cartridge",
                      "prefilled cartridge",
                      "pre filled cartridge",
                    ],
                    Pre_filled_pens: [
                      "pre-filled pen",
                      "prefilled pen",
                      "pre filled pen",
                      "pens",
                      "pen",
                    ],
                    autoinjector: [
                      "autoinjector",
                      "auto-injector",
                      "auto injector",
                    ],
                  },
                },
                generic_terms: {
                  priority: 1,
                  terms: [
                    "ampoule",
                    "ampoules",
                    "amp",
                    "amps",
                    "vial",
                    "vials",
                    "syringe",
                    "syr",
                  ],
                },
              },
            },
          },
          infusion: {
            priority_groups: {
              specific_formulations: {
                priority: 2,
                terms: {
                  solution: [
                    "concentrate for infusion",
                    "iv infusion",
                    "i/v infusion",
                    "i.v. infusion",
                    "intravenous infusion",
                    "solution for infusion",
                    "soln for inf",
                    "concentrate for solution for infusion",
                    "sterile concentrate for infusion",
                  ],
                  powder: [
                    "powder for infusion",
                    "powder for solution for infusion",
                    "powder for concentrate",
                    "powder for iv infusion",
                    "sterile powder for infusion",
                  ],
                  bags: [
                    "infusion bag",
                    "iv bag",
                    "i/v bag",
                    "i.v. bag",
                    "intravenous bag",
                    "infusion container",
                    "flexible bag",
                    "plastic infusion bag",
                  ],
                },
              },
              generic_terms: {
                priority: 1,
                terms: [
                  "infusion",
                  "conc for inf",
                  "iv solution",
                  "i/v solution",
                  "i.v. solution",
                  "infusion solution",
                  "inf soln",
                  "solution for iv infusion",
                  "soln for i/v inf",
                  "conc for soln for inf",
                  "sterile conc for inf",
                  "pwd for inf",
                  "pwd for soln for inf",
                  "pwd for conc",
                  "pwd for i/v inf",
                  "sterile pwd for inf",
                  "inf bag",
                  "inf container",
                  "flex bag",
                  "plastic inf bag",
                ],
              },
            },
          },
          intrathecal: {
            priority_groups: {
              specific_formulations: {
                priority: 2,
                terms: {
                  solution: [
                    "intrathecal injection",
                    "solution for intrathecal injection",
                    "intrathecal use",
                    "for intrathecal use",
                  ],
                  implant: [
                    "intrathecal implant",
                    "implant for intrathecal use",
                  ],
                },
              },
              generic_terms: {
                priority: 1,
                terms: [
                  "intrathecal",
                  "it injection",
                  "i/t injection",
                  "i.t. injection",
                  "intrathecal soln",
                  "it soln",
                  "soln for it inj",
                  "it implant",
                  "i/t implant",
                  "i.t. implant",
                ],
              },
            },
          },
          epidural: {
            priority_groups: {
              specific_formulations: {
                priority: 2,
                terms: [
                  "epidural injection",
                  "epidural infusion",
                  "solution for epidural use",
                  "soln for epi use",
                  "epidural solution",
                  "for epidural use",
                ],
              },
              generic_terms: {
                priority: 1,
                terms: [
                  "epidural",
                  "epi injection",
                  "epi infusion",
                  "epi soln",
                ],
              },
            },
          },
        },

        inhaled: {
          priority_groups: {
            specific_devices: {
              priority: 3,
              terms: {
                Ellipta: ["Ellipta", "Ellipta Inhaler"],
                Turbohaler: [
                  "turbohaler",
                  "turbuhaler",
                  "turbo inhaler",
                  "turbo haler",
                ],
                Accuhaler: ["diskus", "accuhaler"],
                Easyhaler: ["easyhaler", "easy haler", "easy-haler"],
                Easibreathe: [
                  "easybreathe",
                  "easy breathe",
                  "easy-breathe",
                  "easibreathe",
                  "easi breathe",
                  "easi-breathe",
                ],
                Nexthaler: ["Nexthaler", "next haler", "next-haler"],
                Spiromax: ["spiromax", "spiro max", "spiro-max"],
                Genuair: ["genuair", "genu air", "genu-air"],
                Breezhaler: ["breezhaler", "breeze haler", "breeze-haler"],
                Handihaler: ["handihaler", "handi haler", "handi-haler"],
                Clickhaler: ["clickhaler", "click haler", "click-haler"],
                Novolizer: ["novolizer", "novo lizer", "novo-lizer"],
                Respimat: [
                  "respimat",
                  "spiolto",
                  "soft mist inhaler",
                  "soft-mist inhaler",
                ],
              },
            },
            device_types: {
              priority: 2,
              terms: {
                mdi: [
                  "mdi",
                  "m.d.i.",
                  "m/d/i",
                  "pmdi",
                  "p.m.d.i.",
                  "p/m/d/i",
                  "pressurized inhaler",
                  "pressurised inhaler",
                  "metered dose inhaler",
                  "aerosol inhaler",
                  "pressurized metered dose inhaler",
                  "pressurised metered dose inhaler",
                ],
                dpi: [
                  "dpi",
                  "d.p.i.",
                  "d/p/i",
                  "dry powder inhaler",
                  "inhalation powder",
                  "powder for inhalation",
                  "pwd for inhal",
                  "inhal powder",
                  "powder inhaler",
                  "pwd inhaler",
                  "dry powder for inhalation",
                  "dry pwd for inhal",
                ],
                nebulizer: [
                  "nebulizer solution",
                  "nebuliser solution",
                  "neb solution",
                  "nebulization solution",
                  "nebulisation solution",
                  "respules",
                  "solution for nebulisation",
                  "soln for nebulization",
                  "nebulizer soln",
                  "nebuliser soln",
                  "solution for nebulizer",
                  "soln for nebuliser",
                  "powder for nebulizer solution",
                  "powder for nebuliser solution",
                  "pwd for neb soln",
                  "nebuliser powder",
                  "nebulizer powder",
                  "neb powder",
                  "powder for nebulization",
                  "pwd for nebulisation",
                ],
                soft_mist: ["soft mist", "soft-mist", "smi", "s.m.i.", "s/m/i"],
              },
            },
            generic_terms: {
              priority: 1,
              terms: [
                "inhaler",
                "inhaled",
                "inhaler",
                "aero inhaler",
                "puffer",
                "pressurized inhalation solution",
                "pressurised inhalation solution",
                "press inhal soln",
                "inhaler device",
                "inhalation aerosol",
                "inhal aerosol",
                "aerosol for inhalation",
                "CFC free",
                "cfc-free",
                "cfc free inhaler",
                "cfc-free inhaler",
                "evohaler",
                "neb",
                "nebs",
                "nebules",
                "nebule",
              ],
            },
          },
        },

        topical: {
          skin: {
            priority_groups: {
              specific_formulations: {
                priority: 2,
                terms: {
                  cream: ["cream", "crm", "sudocrem"],
                  ointment: ["ointment", "oint"],
                  gel: ["gel"],
                  lotion: ["lotion", "lot"],
                  solution: [
                    "cutaneous solution",
                    "topical solution",
                    "top soln",
                    "liquid application",
                    "cutaneous suspension",
                    "skin solution",
                    "solution for topical use",
                    "soln for topical use",
                    "cutaneous soln",
                    "topical soln",
                  ],
                  scalp_application: ["scalp application"],
                  powder: [
                    "powder",
                    "pwd",
                    "dusting powder",
                    "topical powder",
                    "top powder",
                    "cutaneous powder",
                    "cutaneous spray powder",
                    "powder for topical use",
                    "pwd for topical use",
                  ],
                  patch: [
                    "patch",
                    "patches",
                    "transdermal patch",
                    "td patch",
                    "t/d patch",
                    "t.d. patch",
                    "plaster",
                    "medicated plaster",
                    "transdermal system",
                    "tds",
                    "t.d.s.",
                    "t/d/s",
                    "skin patch",
                    "matrix patch",
                    "therapeutic patch",
                  ],
                  foam: [
                    "foam",
                    "cutaneous foam",
                    "topical foam",
                    "top foam",
                    "foam for topical use",
                    "skin foam",
                  ],
                  spray: [
                    "spray",
                    "cutaneous spray",
                    "topical spray",
                    "top spray",
                    "spray for topical use",
                    "skin spray",
                  ],
                },
              },
            },
          },
          eye: {
            priority_groups: {
              specific_formulations: {
                priority: 2,
                terms: {
                  drops: [
                    "eye drops",
                    "eyedrops",
                    "ophthalmic drops",
                    "opth drops",
                    "collyrium",
                    "eye drop",
                    "preservative-free eye drops",
                    "pf eye drops",
                    "p/f eye drops",
                    "p.f. eye drops",
                    "eye drops emulsion",
                    "eye drop emulsion",
                    "drops for eye use",
                    "ophthalmic solution",
                    "opth soln",
                  ],
                  ointment: [
                    "eye ointment",
                    "ophthalmic ointment",
                    "opth ointment",
                    "eye oint",
                    "ophthalmic oint",
                    "ointment for eye",
                  ],
                  gel: [
                    "ophthalmic gel",
                    "eye gel",
                    "opth gel",
                    "gel for eye use",
                  ],
                  injection: [
                    "intravitreal injection",
                    "intraocular injection",
                    "ivt injection",
                    "i.v.t. injection",
                    "i/v/t injection",
                    "injection for eye",
                  ],
                },
              },
            },
          },
          ear: {
            priority_groups: {
              specific_formulations: {
                priority: 2,
                terms: {
                  drops: [
                    "ear drops",
                    "otic drops",
                    "ear drop",
                    "drops for ear use",
                    "otic solution",
                    "aural drops",
                  ],
                  spray: [
                    "ear spray",
                    "otic spray",
                    "aural spray",
                    "spray for ear use",
                  ],
                },
              },
            },
          },
          nasal: {
            priority_groups: {
              specific_formulations: {
                priority: 2,
                terms: {
                  spray: [
                    "nasal spray",
                    "nasal drops",
                    "intranasal spray",
                    "spray for nasal use",
                    "nose spray",
                    "spray for nose",
                  ],
                  solution: [
                    "nasal solution",
                    "nasal soln",
                    "solution for nasal use",
                    "nose drops solution",
                  ],
                  ointment: [
                    "nasal ointment",
                    "nasal oint",
                    "ointment for nasal use",
                    "nose ointment",
                  ],
                },
              },
            },
          },
        },

        rectal: {
          priority_groups: {
            specific_formulations: {
              priority: 2,
              terms: {
                suppository: [
                  "suppository",
                  "supp",
                  "supps",
                  "rectal suppository",
                  "rect supp",
                  "suppositories",
                  "supp for rectal use",
                  "rectal supp",
                  "suppository for rectal use",
                ],
                enema: [
                  "enema",
                  "rectal solution",
                  "rect soln",
                  "retention enema",
                  "ret enema",
                  "rectal suspension",
                  "rect susp",
                  "solution for rectal use",
                  "suspension for rectal use",
                ],
                foam: [
                  "rectal foam",
                  "rect foam",
                  "foam for rectal use",
                  "rectal foam spray",
                  "rect foam spray",
                ],
                ointment: [
                  "rectal ointment",
                  "rect oint",
                  "rectal cream",
                  "rect cream",
                  "anal cream",
                  "anal ointment",
                  "ointment for rectal use",
                  "cream for rectal use",
                  "anal oint",
                ],
              },
            },
          },
        },

        vaginal: {
          priority_groups: {
            specific_formulations: {
              priority: 2,
              terms: {
                tablet: [
                  "vaginal tablet",
                  "vag tab",
                  "pessary",
                  "vaginal pessary",
                  "vag pessary",
                  "pess",
                  "tablet for vaginal use",
                  "pessary tablet",
                  "vaginal insert",
                ],
                cream: [
                  "vaginal cream",
                  "vag cream",
                  "vag crm",
                  "cream for vaginal use",
                  "vaginal crm",
                ],
                ring: [
                  "vaginal ring",
                  "vag ring",
                  "ring for vaginal use",
                  "contraceptive ring",
                  "vaginal delivery system",
                ],
                gel: [
                  "vaginal gel",
                  "vag gel",
                  "gel for vaginal use",
                  "vaginal application",
                ],
              },
            },
          },
        },

        medical_gases: {
          priority_groups: {
            specific_formulations: {
              priority: 2,
              terms: {
                gas: ["medical gas", "compressed gas", "inhalation gas"],
                liquid: ["cryogenic gas"],
              },
            },
          },
        },
      };
      const unitConversions = {
        mass: {
          // Nano units
          ng: 0.000001, // nanograms to mg
          nanogram: 0.000001,
          nanograms: 0.000001,

          // Micro units
          mcg: 0.001, // micrograms to mg
          microg: 0.001,
          microgram: 0.001,
          micrograms: 0.001,
          μg: 0.001,
          ug: 0.001,

          // Milli units
          mg: 1, // base unit
          milligram: 1,
          milligrams: 1,

          // Gram units
          g: 1000,
          gram: 1000,
          grams: 1000,

          // Units (for medications measured in units)
          unit: 1,
          units: 1,
          u: 1,
          iu: 1,
        },
        volume: {
          ml: 1,
          mL: 1,
          millilitre: 1,
          milliliter: 1,
          l: 1000,
          L: 1000,
          litre: 1000,
          liter: 1000,
        },
        percentage: {
          "%": 1,
          percent: 1,
          percentage: 1,
        },
      };
      // Create unit pattern strings
      const massUnits = Object.keys(unitConversions.mass).join("|");
      const volumeUnits = Object.keys(unitConversions.volume).join("|");
      // Function to standardize units
      function standardizeUnit(value, unit) {
        if (!unit) return value;

        // If value is a string (might contain commas), sanitize it
        if (typeof value === "string") {
          value = parseFloat(sanitizeNumber(value));
        }

        const unitLower = unit.toLowerCase();

        if (
          unitLower.match(
            /^(unit|units?|u|iu|i\.u\.|international\s*units?|i\s*units?)$/i
          )
        ) {
          // For units, do exact numerical comparison without any conversion
          return value;
        }
        {
          return value;
        }

        // Handle special case for zero values
        if (value === 0) return 0;

        // Convert everything to base unit (mg for mass)
        if (unitConversions.mass[unitLower]) {
          const conversionFactor = unitConversions.mass[unitLower];
          const converted = value * conversionFactor;
          console.log(`Converting ${value} ${unit} to ${converted} mg`); // Debug log
          return converted;
        } else if (unitConversions.volume[unitLower]) {
          return value * unitConversions.volume[unitLower];
        } else if (unitConversions.percentage[unitLower]) {
          return value;
        }

        return null;
      }

      function findMedicationMatch(inputName) {
        // Normalize input: lowercase, remove extra spaces and standardize separators
        const normalizedInput = inputName
          .toLowerCase()
          .replace(/\s+with\s+/g, " ")
          .replace(/\s+and\s+/g, " ")
          .replace(/\s*[\/,+&]\s*/g, " ")
          .trim();

        console.log("Normalized input:", normalizedInput);

        // Helper function to check if a term is a complete word in the input
        function isCompleteWord(term, input) {
          const pattern = new RegExp(`\\b${term}\\b`, "i");
          return pattern.test(input);
        }

        let bestMatch = null;
        let bestMatchLength = 0; // Track the length of the best matching term
        let bestMatchScore = 0; // Track how much of the input is matched

        // Search through the medication dictionary
        for (const [standardName, aliases] of Object.entries(
          medicationDict.medications
        )) {
          // Get all possible forms of the medication name
          const allForms = [
            standardName.toLowerCase(),
            ...aliases.map((a) => a.toLowerCase()),
          ];

          for (const form of allForms) {
            // For combination drugs (containing /)
            if (form.includes("/")) {
              const components = form.split("/").map((c) => c.trim());
              // Check if ALL components are found as complete words in the input
              const allComponentsFound = components.every((comp) =>
                isCompleteWord(comp, normalizedInput)
              );

              if (allComponentsFound) {
                // Calculate total length of matching components
                const matchLength = components.reduce(
                  (sum, comp) => sum + comp.length,
                  0
                );
                if (matchLength > bestMatchLength) {
                  bestMatch = standardName;
                  bestMatchLength = matchLength;
                  bestMatchScore = matchLength;
                }
              }
            }
            // For single drugs (including multi-word drugs)
            else {
              // Check if the entire form appears as complete word(s) in the input
              if (isCompleteWord(form, normalizedInput)) {
                // Calculate how much of the input this match covers
                const matchLength = form.length;
                if (matchLength > bestMatchLength) {
                  bestMatch = standardName;
                  bestMatchLength = matchLength;
                  bestMatchScore = matchLength;
                }
              }
            }
          }
        }

        // If no match found, return "unknown medication"
        return bestMatch || "unknown medication";
      }
      function identifyFormulation(medicationString) {
        const med = medicationString.toLowerCase();

        function searchFormulations(obj, path = []) {
          for (const [category, value] of Object.entries(obj)) {
            if (Array.isArray(value)) {
              if (value.some((term) => med.includes(term.toLowerCase()))) {
                return {
                  mainCategory: path[0] || category,
                  fullPath: [...path, category],
                };
              }
            } else if (typeof value === "object" && value !== null) {
              // Check if this object contains formulation arrays
              if (value.formulations) {
                for (const [formType, terms] of Object.entries(
                  value.formulations
                )) {
                  if (terms.some((term) => med.includes(term.toLowerCase()))) {
                    return {
                      mainCategory: path[0] || category,
                      fullPath: [...path, category, formType],
                    };
                  }
                }
              }
              const result = searchFormulations(value, [...path, category]);
              if (result) return result;
            }
          }
          return null;
        }

        return searchFormulations(formulationDict);
      }

      function findLongestFormulationMatch(medicationString) {
        const med = medicationString.toLowerCase().replace(/\s+/g, " ").trim();
        let matches = [];
        let highestPriority = 0;

        console.log(`\nSearching for formulation in: "${med}"`);

        function searchFormulations(obj, currentPath = []) {
          for (const [category, value] of Object.entries(obj)) {
            // Handle priority_groups structure
            if (category === "priority_groups") {
              for (const [groupType, groupValue] of Object.entries(value)) {
                const priority = groupValue.priority || 1;

                // Handle terms that are objects (with named subcategories)
                if (
                  groupValue.terms &&
                  typeof groupValue.terms === "object" &&
                  !Array.isArray(groupValue.terms)
                ) {
                  for (const [subCategory, termList] of Object.entries(
                    groupValue.terms
                  )) {
                    if (Array.isArray(termList)) {
                      for (const term of termList) {
                        checkForMatch(term, priority, [
                          ...currentPath,
                          groupType,
                          subCategory,
                        ]);
                      }
                    }
                  }
                }
                // Handle terms that are arrays
                else if (groupValue.terms && Array.isArray(groupValue.terms)) {
                  for (const term of groupValue.terms) {
                    checkForMatch(term, priority, [...currentPath, groupType]);
                  }
                }
              }
            }
            // Handle nested objects that aren't priority_groups
            else if (
              typeof value === "object" &&
              value !== null &&
              !Array.isArray(value)
            ) {
              searchFormulations(value, [...currentPath, category]);
            }
          }
        }

        function checkForMatch(term, priority, path) {
          // Create pattern that allows for variable spacing between words
          const termRegex = term.includes(".")
            ? new RegExp(term.replace(/\./g, "\\."), "i")
            : new RegExp(`\\b${term.split(" ").join("\\s+")}\\b`, "i");

          if (med.match(termRegex)) {
            console.log(
              `Found match: "${term}" (priority: ${priority}) at path: ${path.join(
                "/"
              )}`
            );

            // If this priority is higher, clear previous matches
            if (priority > highestPriority) {
              matches = [];
              highestPriority = priority;
              console.log(
                `New highest priority (${priority}), clearing previous matches`
              );
            }

            // Only add if it's at the highest priority level
            if (priority === highestPriority) {
              matches.push({
                match: term,
                mainCategory: path[0],
                fullPath: path,
                priority: priority,
              });
              console.log(`Added match at priority ${priority}: ${term}`);
            }
          }
        }

        searchFormulations(formulationDict);

        console.log("Final matches:", matches);

        if (matches.length > 0) {
          return matches;
        }
        return null;
      }

      function compareFormulations(med1, med2) {
        if (!med1 || !med2) return null;

        // Normalize spaces in both medication strings
        med1 = med1.replace(/\s+/g, " ").trim();
        med2 = med2.replace(/\s+/g, " ").trim();

        const forms1 = findLongestFormulationMatch(med1);
        const forms2 = findLongestFormulationMatch(med2);

        if (!forms1 || !forms2) return null;

        function getBaseRoute(form) {
          if (form.mainCategory === "oral" || form.mainCategory === "oral") {
            return "oral";
          }
          return form.mainCategory;
        }

        // If medications are exactly the same string
        if (med1 === med2) {
          return "match";
        }

        // Get base routes using the first form from each array
        const route1 = getBaseRoute(forms1[0]);
        const route2 = getBaseRoute(forms2[0]);

        // Helper function to determine if terms belong to the same formulation group
        function areTermsEquivalent(term1, term2) {
          // First check if terms are exactly the same after normalizing spaces
          if (
            term1.replace(/\s+/g, " ").trim() ===
            term2.replace(/\s+/g, " ").trim()
          )
            return true;

          // Function to find which group contains a term
          function findTermGroup(term) {
            function searchGroups(obj) {
              for (const [_, value] of Object.entries(obj)) {
                if (Array.isArray(value)) {
                  // If this is an array and contains the term
                  if (value.includes(term)) {
                    return value;
                  }
                } else if (typeof value === "object" && value !== null) {
                  // Handle priority_groups structure
                  if (value.priority_groups) {
                    for (const group of Object.values(value.priority_groups)) {
                      if (group.terms) {
                        // Handle terms that are arrays
                        if (
                          Array.isArray(group.terms) &&
                          group.terms.includes(term)
                        ) {
                          return group.terms;
                        }
                        // Handle terms that are objects with nested arrays
                        else if (typeof group.terms === "object") {
                          for (const termList of Object.values(group.terms)) {
                            if (
                              Array.isArray(termList) &&
                              termList.includes(term)
                            ) {
                              return termList;
                            }
                          }
                        }
                      }
                    }
                  }
                  // Recursively search nested objects
                  const result = searchGroups(value);
                  if (result) return result;
                }
              }
              return null;
            }
            return searchGroups(formulationDict);
          }

          const group1 = findTermGroup(term1);
          const group2 = findTermGroup(term2);

          // Terms are equivalent if they're found in the same array
          return (
            group1 &&
            group2 &&
            group1 === group2 &&
            group1.includes(term1) &&
            group1.includes(term2)
          );
        }

        // Check if all formulations match, considering equivalent terms
        const allFormsMatch =
          forms1.every((f1) =>
            forms2.some((f2) => areTermsEquivalent(f1.match, f2.match))
          ) &&
          forms2.every((f2) =>
            forms1.some((f1) => areTermsEquivalent(f2.match, f1.match))
          );

        if (
          allFormsMatch &&
          isModifiedRelease(med1) === isModifiedRelease(med2) &&
          isEntericCoated(med1) === isEntericCoated(med2)
        ) {
          return "match";
        }

        // If they share some formulations or the same base route
        const hasPartialMatch =
          forms1.some((f1) =>
            forms2.some((f2) => areTermsEquivalent(f1.match, f2.match))
          ) || route1 === route2;

        if (hasPartialMatch) {
          return "similar";
        }

        return "different";
      }
      function isModifiedRelease(med) {
        // First check standard MR terms
        const mrTerms = [
          /\bm[\/\.]?r\b/i, // m/r, m.r, mr
          /\bs[\/\.]?r\b/i, // s/r, s.r, sr
          /\bp[\/\.]?r\b/i, // p/r, p.r, pr
          /\be[\/\.]?r\b/i, // e/r, e.r, er
          /\bc[\/\.]?r\b/i, // c/r, c.r, cr
          /\bx[\/\.]?l\b/i, // x/l, x.l, xl
          /\bmodified.?release\b/i,
          /\bsustained.?release\b/i,
          /\bprolonged.?release\b/i,
          /\bextended.?release\b/i,
          /\bcontrolled.?release\b/i,
        ];

        if (mrTerms.some((regex) => regex.test(med))) {
          return true;
        }

        // Special check for nifedipine and diltiazem
        const medLower = med.toLowerCase();
        if (
          (medLower.includes("nifedipine") || medLower.includes("diltiazem")) &&
          (medLower.includes("once daily") || medLower.includes("twice daily"))
        ) {
          return true;
        }

        return false;
      }
      function isEntericCoated(med) {
        const ecTerms = [
          /\be[\/\.]?c\b/i, // e/c, e.c, ec
          /\bg[\/\.]?r\b/i, // g/r, g.r, gr
          /\benteric.?coated\b/i,
          /\bgastro.?resistant\b/i,
          /\bgastro.?protected\b/i,
        ];

        return ecTerms.some((regex) => regex.test(med));
      }
      function sanitizeNumber(numberStr) {
        if (!numberStr) return "";
        // Convert to string if it's a number
        let cleaned = numberStr.toString();
        // Remove all spaces
        cleaned = cleaned.replace(/\s+/g, "");
        // Remove commas while preserving decimal points
        cleaned = cleaned.replace(/,/g, "");
        // Convert to float
        return cleaned;
      }
      function isStandaloneNumber(text, numberMatch) {
        const index = text.indexOf(numberMatch);
        if (index === -1) return false;

        // Only check character before the number
        if (index > 0) {
          const charBefore = text[index - 1];
          // If the character before is a letter or dash, this number is part of a word
          if (/[A-Za-z\-]/.test(charBefore)) {
            return false;
          }
        }

        return true;
      }
      function extractStrength(medicationString) {
        console.log(`Extracting strength from: "${medicationString}"`);
        const strengths = [];

        // First find formulation terms to determine cutoff point
        const textToAnalyze = medicationString;

        console.log(`Analyzing strength in: "${textToAnalyze}"`);

        function isStandaloneNumber(text, numberMatch) {
          const index = text.indexOf(numberMatch);
          if (index === -1) return false;
          if (index > 0) {
            const charBefore = text[index - 1];
            if (/[A-Za-z\-]/.test(charBefore)) {
              return false;
            }
          }
          return true;
        }

        // Clean the string and normalize /dose patterns
        const cleanedString = textToAnalyze.replace(/\/\s*dose\b/gi, "");
        console.log(`Cleaned string (removed /dose): "${cleanedString}"`);

        // First try to match drug-name-prefixed pattern
        const drugStrengthPattern =
          /(?:^|\s|\/|\[)([A-Za-z\s]+?)?\s*(\d+(?:\.\d+)?)\s*((?:mg|mcg|g|microgram|micrograms|milligram|milligrams|gram|grams|unit|units|u|iu)s?)/gi;
        let drugStrengthMatches = [
          ...cleanedString.matchAll(drugStrengthPattern),
        ];

        // If we found multiple strength components with drug names
        if (drugStrengthMatches.length > 1) {
          const strengthValues = drugStrengthMatches
            .map((match) => ({
              value: parseFloat(match[2]),
              unit: match[3].toLowerCase(),
            }))
            .filter(Boolean);

          if (strengthValues.length > 1) {
            return [
              {
                original: cleanedString,
                values: strengthValues.map((sv) => sv.value),
                units: strengthValues.map((sv) => sv.unit),
                isCombination: true,
                combinationType:
                  strengthValues.length === 3 ? "triple" : "double",
                fullMatch: strengthValues
                  .map((sv) => `${sv.value}${sv.unit}`)
                  .join("/"),
              },
            ];
          }
        }

        // Enhanced unit patterns with all variants
        const unitsVariants =
          "unit|units?|u|iu|i\\.u\\.|international\\s*units?|i\\s*units?";
        const massUnitPattern = `mg|mcg|g|microgram|micrograms|milligram|milligrams|gram|grams|${unitsVariants}|μg|ug`;
        const volumeUnitPattern =
          "ml|mL|ML|millilitre|milliliter|l|L|litre|liter";
        const percentageUnitPattern = "%|percent|percentage";

        // Modified number pattern to better handle commas in larger numbers
        const numberPattern = "([0-9]+(?:,[0-9]+)*(?:\\.[0-9]*)?|\\.[0-9]+)";
        // Unified pattern for numbers with optional units
        const numberWithUnits = `${numberPattern}\\s*(${massUnitPattern})?`;

        // Define pattern variations - all with case-insensitive flag "i"
        const patterns = [
          // Triple combination pattern
          {
            pattern: new RegExp(
              `${numberWithUnits}\\s*\\/\\s*${numberWithUnits}\\s*\\/\\s*${numberWithUnits}`,
              "i"
            ),
            handler: (match) => {
              if (!isStandaloneNumber(cleanedString, match[1])) return null;
              const [_, val1, unit1, val2, unit2, val3, unit3] = match;
              const lastUnit = (unit3 || unit2 || unit1 || "").toLowerCase();

              return {
                original: match[0],
                values: [
                  standardizeUnit(
                    val1.replace(/,/g, ""),
                    unit1?.toLowerCase() || lastUnit
                  ),
                  standardizeUnit(
                    val2.replace(/,/g, ""),
                    unit2?.toLowerCase() || lastUnit
                  ),
                  standardizeUnit(
                    val3.replace(/,/g, ""),
                    unit3?.toLowerCase() || lastUnit
                  ),
                ],
                units: [
                  (unit1 || lastUnit).toLowerCase(),
                  (unit2 || lastUnit).toLowerCase(),
                  (unit3 || lastUnit).toLowerCase(),
                ],
                isCombination: true,
                combinationType: "triple",
                fullMatch: match[0],
              };
            },
          },

          // Units/volume pattern specifically
          {
            pattern: new RegExp(
              `${numberPattern}\\s*(?:${unitsVariants})\\s*\\/\\s*(?:${volumeUnitPattern})\\b`,
              "i"
            ),
            handler: (match) => {
              if (!isStandaloneNumber(cleanedString, match[1])) return null;
              const [fullMatch] = match;
              const parts = fullMatch.split(/\//).map((part) => part.trim());
              const numberMatch = parts[0].match(
                new RegExp(`${numberPattern}\\s*(${unitsVariants})`, "i")
              );

              if (numberMatch) {
                return {
                  original: fullMatch,
                  values: [
                    parseFloat(numberMatch[1].replace(/,/g, "")),
                    "unit",
                    1,
                    "ml",
                  ],
                  isConcentration: true,
                  combinationType: "concentration",
                  fullMatch: fullMatch,
                };
              }
              return null;
            },
          },

          // Modified concentration pattern to handle missing volume value
          {
            pattern: new RegExp(
              `${numberPattern}\\s*(${massUnitPattern})\\s*\\/\\s*(?:${numberPattern}\\s*)?(?:${volumeUnitPattern})\\b`,
              "i"
            ),
            handler: (match) => {
              if (!isStandaloneNumber(cleanedString, match[1])) return null;
              const [fullMatch, val1, unit1, val2, unit2] = match;
              return {
                original: match[0],
                values: [
                  parseFloat(val1.replace(/,/g, "")),
                  unit1.toLowerCase(),
                  parseFloat(val2?.replace(/,/g, "") || 1),
                  unit2?.toLowerCase() || "ml",
                ],
                isConcentration: true,
                combinationType: "concentration",
                fullMatch: match[0],
              };
            },
          },

          // Double combination pattern
          {
            pattern: new RegExp(
              `${numberWithUnits}\\s*\\/\\s*${numberWithUnits}`,
              "i"
            ),
            handler: (match) => {
              if (!isStandaloneNumber(cleanedString, match[1])) return null;
              const [_, val1, unit1, val2, unit2] = match;
              const lastUnit = (unit2 || unit1 || "").toLowerCase();

              return {
                original: match[0],
                values: [
                  standardizeUnit(
                    val1.replace(/,/g, ""),
                    unit1?.toLowerCase() || lastUnit
                  ),
                  standardizeUnit(
                    val2.replace(/,/g, ""),
                    unit2?.toLowerCase() || lastUnit
                  ),
                ],
                units: [
                  (unit1 || lastUnit).toLowerCase(),
                  (unit2 || lastUnit).toLowerCase(),
                ],
                isCombination: true,
                combinationType: "double",
                fullMatch: match[0],
              };
            },
          },

          // Percentage pattern
          {
            pattern: new RegExp(
              `${numberPattern}\\s*(${percentageUnitPattern})`,
              "i"
            ),
            handler: (match) => {
              if (!isStandaloneNumber(cleanedString, match[1])) return null;
              const [_, value, unit] = match;
              return {
                original: match[0],
                values: [parseFloat(value.replace(/,/g, ""))],
                units: [unit?.toLowerCase()],
                isPercentage: true,
                combinationType: "single",
                fullMatch: match[0],
              };
            },
          },

          // Single strength pattern
          {
            pattern: new RegExp(numberWithUnits, "i"),
            handler: (match) => {
              if (!isStandaloneNumber(cleanedString, match[1])) return null;
              const [_, value, unit] = match;
              return {
                original: match[0],
                values: [parseFloat(value.replace(/,/g, ""))],
                units: [unit?.toLowerCase()],
                isCombination: false,
                combinationType: "single",
                fullMatch: match[0],
              };
            },
          },
        ];

        // Try each pattern in order
        for (const { pattern, handler } of patterns) {
          const match = cleanedString.match(pattern);
          if (match) {
            console.log(`Found match with pattern:`, pattern);
            console.log(`Match details:`, match);

            const result = handler(match);
            console.log(`Processed result:`, result);

            if (result) {
              strengths.push(result);
              break;
            }
          }
        }

        console.log("Final extracted strengths:", strengths);
        return strengths;
      }
      function standardizeStrength(strengthObj) {
        if (!strengthObj?.values?.length) return null;

        // For combination medications
        if (strengthObj.isCombination) {
          if (strengthObj.isConcentration) {
            // Handle concentration strengths
            const [
              numeratorValue,
              numeratorUnit,
              denominatorValue,
              denominatorUnit,
            ] = strengthObj.values;
            const standardNumerator = standardizeUnit(
              parseFloat(numeratorValue),
              numeratorUnit
            );
            let standardDenominator = parseFloat(denominatorValue || 1);

            if (denominatorUnit?.toLowerCase().startsWith("l")) {
              standardDenominator *= 1000;
            }

            if (standardNumerator === null || !standardDenominator) return null;

            return {
              values: [standardNumerator / standardDenominator],
              units: ["mg/ml"],
              isConcentration: true,
            };
          }

          // Handle regular combinations
          return {
            values: strengthObj.values
              .map((val, i) => {
                if (typeof val === "string") val = parseFloat(val);
                return standardizeUnit(val, strengthObj.units?.[i]);
              })
              .filter((v) => v !== null && !isNaN(v)),
          };
        }

        // For percentage values
        if (strengthObj.isPercentage) {
          return {
            values: [parseFloat(strengthObj.values[0])],
            isPercentage: true,
          };
        }

        // For single strengths
        const value = parseFloat(strengthObj.values[0]);
        const unit = strengthObj.units?.[0];

        if (!isNaN(value)) {
          if (unit) {
            const standardized = standardizeUnit(value, unit);
            return standardized !== null ? { values: [standardized] } : null;
          }
          return { values: [value] };
        }

        return null;
      }

      function extractCombinationStrengths(medicationString) {
        console.log(
          `\nAttempting to extract combination strengths from: "${medicationString}"`
        );

        if (!medicationString) {
          console.log("Null or empty medication string");
          return null;
        }

        // Ignore /dose patterns
        if (medicationString.toLowerCase().includes("/dose")) {
          console.log("Skipping due to /dose pattern");
          return null;
        }

        const results = {
          values: [],
          units: [],
        };

        try {
          // Regular expression to match numbers with optional units
          const numberPattern = new RegExp(
            `((?:\\d{1,3}(?:,\\d{3})*|\\d+)(?:\\.\\d*)?)` +
              `\\s*(mg|g|mcg|microgram|micrograms|milligram|milligrams|gram|grams|unit|units|u|%)?`,
            "gi"
          );
          // Split by / but ignore /dose
          const parts = medicationString
            .split(/(?<!\/dose)\//)
            .map((part) => part.trim());
          console.log("Split parts:", parts);

          let lastUnit = null;

          // Process each part
          parts.forEach((part, index) => {
            console.log(`\nProcessing part ${index + 1}: "${part}"`);

            const matches = [...part.matchAll(numberPattern)];
            console.log(
              `Found ${matches.length} number matches in this part:`,
              matches
            );

            if (matches.length > 0) {
              // Take the last number+unit combination in this part
              const lastMatch = matches[matches.length - 1];
              const value = parseFloat(lastMatch[1]);
              const unit = lastMatch[2] ? lastMatch[2].toLowerCase() : null;

              console.log(`Extracted value: ${value}, unit: ${unit}`);

              if (!isNaN(value)) {
                results.values.push(value);
                if (unit) {
                  lastUnit = unit;
                  results.units.push(unit);
                } else {
                  results.units.push(lastUnit);
                }
                console.log(
                  `Added to results - values: ${results.values}, units: ${results.units}`
                );
              } else {
                console.log(`Warning: Invalid number found: ${lastMatch[1]}`);
              }
            } else {
              console.log("No numbers found in this part");
            }
          });

          // If no units were found at all, clear units array
          if (results.units.every((unit) => unit === null)) {
            console.log(
              "No units found in entire string, clearing units array"
            );
            results.units = [];
          }

          console.log("Final results:", results);
          return results;
        } catch (error) {
          console.error("Error in extractCombinationStrengths:", error);
          return null;
        }
      }

      function compareCombinations(med1, med2) {
        console.log(
          `\nComparing combinations:\nMed1: "${med1}"\nMed2: "${med2}"`
        );

        try {
          const combo1 = extractCombinationStrengths(med1);
          const combo2 = extractCombinationStrengths(med2);

          console.log("Extracted combinations:");
          console.log("Combo1:", combo1);
          console.log("Combo2:", combo2);

          if (!combo1 || !combo2) {
            console.log("One or both combinations could not be extracted");
            return null;
          }

          if (combo1.values.length !== combo2.values.length) {
            console.log(
              `Different number of values: ${combo1.values.length} vs ${combo2.values.length}`
            );
            return false;
          }

          // If no units in either combination, compare just the values
          if (combo1.units.length === 0 && combo2.units.length === 0) {
            console.log("Comparing without units");
            const matches = combo1.values.every((value, index) => {
              const matches = Math.abs(value - combo2.values[index]) < 0.000001;
              console.log(
                `Comparing ${value} with ${combo2.values[index]}: ${matches}`
              );
              return matches;
            });
            console.log(`Values-only comparison result: ${matches}`);
            return matches;
          }

          // Compare values and units
          console.log("Comparing values with units");
          for (let i = 0; i < combo1.values.length; i++) {
            const value1 = standardizeUnit(combo1.values[i], combo1.units[i]);
            const value2 = standardizeUnit(combo2.values[i], combo2.units[i]);

            console.log(`Comparing standardized values:`);
            console.log(
              `Value1: ${combo1.values[i]} ${combo1.units[i]} -> ${value1}`
            );
            console.log(
              `Value2: ${combo2.values[i]} ${combo2.units[i]} -> ${value2}`
            );

            if (Math.abs(value1 - value2) > 0.000001) {
              console.log("Values do not match");
              return false;
            }
          }

          console.log("All values match");
          return true;
        } catch (error) {
          console.error("Error in compareCombinations:", error);
          return null;
        }
      }
      function compareStrengths(med1, med2) {
        const strengths1 = extractStrength(med1);
        const strengths2 = extractStrength(med2);

        if (!strengths1?.length || !strengths2?.length) return null;

        // Handle concentration vs solid dose comparison
        const isConcentration1 = strengths1[0].isConcentration;
        const isConcentration2 = strengths2[0].isConcentration;

        // If one is a concentration and the other isn't, they're not comparable
        if (isConcentration1 !== isConcentration2) {
          return "different";
        }

        // Handle dual expression strengths (e.g. "800 Unit (20mcg)")
        const dualStrength1 = med1.match(
          /(\d+)\s*Unit\s*\((\d+)\s*(mc?g|mg)\)/i
        );
        const dualStrength2 = med2.match(
          /(\d+)\s*Unit\s*\((\d+)\s*(mc?g|mg)\)/i
        );

        if (dualStrength1 && dualStrength2) {
          const unit1 = parseFloat(dualStrength1[1]);
          const unit2 = parseFloat(dualStrength2[1]);
          const mass1 = standardizeUnit(
            parseFloat(dualStrength1[2]),
            dualStrength1[3]
          );
          const mass2 = standardizeUnit(
            parseFloat(dualStrength2[2]),
            dualStrength2[3]
          );

          return Math.abs(unit1 - unit2) < 0.000001 &&
            Math.abs(mass1 - mass2) < 0.000001
            ? "match"
            : "different";
        }
        // For single strengths with units
        // For single strengths with units
        if (
          strengths1[0].values.length === 1 &&
          strengths2[0].values.length === 1
        ) {
          const value1 = parseFloat(strengths1[0].values[0]);
          const value2 = parseFloat(strengths2[0].values[0]);
          const unit1 = strengths1[0].units[0]?.toLowerCase();
          const unit2 = strengths2[0].units[0]?.toLowerCase();

          // Special handling for Unit values
          if (
            unit1?.match(/^(unit|units?|u|iu)$/i) &&
            unit2?.match(/^(unit|units?|u|iu)$/i)
          ) {
            return Math.abs(value1 - value2) < 0.000001 ? "match" : "different";
          }

          // General comparison for other single-component medications
          const standardized1 = standardizeUnit(value1, unit1);
          const standardized2 = standardizeUnit(value2, unit2);

          if (standardized1 !== null && standardized2 !== null) {
            return Math.abs(standardized1 - standardized2) < 0.000001
              ? "match"
              : "different";
          }
        }
        console.log(
          `\nComparing strengths between:\nMed1: "${med1}"\nMed2: "${med2}"`
        );

        try {
          if (!med1 || !med2) return null;

          const strengths1 = extractStrength(med1);
          const strengths2 = extractStrength(med2);

          if (!strengths1?.length || !strengths2?.length) return null;
          if (strengths1[0].isPercentage && strengths2[0].isPercentage) {
            const value1 = parseFloat(strengths1[0].values[0]);
            const value2 = parseFloat(strengths2[0].values[0]);

            // Direct comparison for percentages
            const tolerance = 0.000001;
            if (Math.abs(value1 - value2) < tolerance) {
              return "match";
            }
            return "different"; // No "similar" category for percentages
          }
          if (strengths1[0].isCombination && strengths2[0].isCombination) {
            if (strengths1[0].values.length !== strengths2[0].values.length) {
              return "different";
            }

            // Compare each value in the combination
            for (let i = 0; i < strengths1[0].values.length; i++) {
              const value1 = standardizeUnit(
                strengths1[0].values[i],
                strengths1[0].units[i]
              );
              const value2 = standardizeUnit(
                strengths2[0].values[i],
                strengths2[0].units[i]
              );

              if (Math.abs(value1 - value2) > 0.000001) {
                return "different";
              }
            }
            return "match";
          }

          // Standardize strengths
          const standardized1 = standardizeStrength(strengths1[0]);
          const standardized2 = standardizeStrength(strengths2[0]);

          if (!standardized1?.values || !standardized2?.values)
            return "different";

          // Create fingerprints
          const fingerprint1 = createFingerprint(standardized1.values);
          const fingerprint2 = createFingerprint(standardized2.values);

          if (!fingerprint1 || !fingerprint2) return "different";

          console.log(`Fingerprint 1: ${fingerprint1}`);
          console.log(`Fingerprint 2: ${fingerprint2}`);

          if (fingerprint1 === fingerprint2) return "match";

          // Check for proportional equivalence
          if (standardized1.values.length === standardized2.values.length) {
            const ratios1 = getRatios(standardized1.values);
            const ratios2 = getRatios(standardized2.values);

            if (compareRatios(ratios1, ratios2)) return "similar";
          }

          return "different";
        } catch (error) {
          console.error("Error in compareStrengths:", error);
          return null;
        }
      }
      function calculateConcentration(values) {
        if (values.length < 4) return null;

        let [amount, massUnit, volume, volumeUnit] = values;

        // If volume is null or undefined, set it to 1
        volume = volume || 1;

        const standardAmount = standardizeUnit(amount, massUnit);
        let standardVolume = volume;

        if (
          volumeUnit?.toLowerCase().includes("l") &&
          !volumeUnit.toLowerCase().includes("ml")
        ) {
          standardVolume *= 1000; // Convert L to mL
        }

        return standardAmount / standardVolume;
      }
      function createFingerprint(standardizedValues) {
        if (!Array.isArray(standardizedValues)) return null;

        // Filter out any non-numeric values and convert strings to numbers
        const numericValues = standardizedValues
          .map((v) => (typeof v === "string" ? parseFloat(v) : v))
          .filter((v) => typeof v === "number" && !isNaN(v));

        if (numericValues.length === 0) return null;

        // Sort numerically and create fingerprint
        return numericValues
          .sort((a, b) => a - b)
          .map((v) => v.toFixed(9))
          .join("|");
      }
      function getRatios(values) {
        const base = values[0];
        return values.slice(1).map((v) => v / base);
      }

      function compareRatios(ratios1, ratios2) {
        const tolerance = 0.000001;
        const sortedRatios1 = [...ratios1].sort((a, b) => a - b);
        const sortedRatios2 = [...ratios2].sort((a, b) => a - b);

        return sortedRatios1.every(
          (ratio, idx) => Math.abs(ratio - sortedRatios2[idx]) <= tolerance
        );
      }
      function standardizeConcentration(strength) {
        if (!strength || !strength.values || strength.values.length < 4)
          return null;

        // Normalize values and units
        const numeratorValue = parseFloat(strength.values[0]);
        const numeratorUnit = strength.values[1]
          ?.toLowerCase()
          .replace(/\s+/g, "");
        const denominatorValue = parseFloat(strength.values[2]);
        const denominatorUnit = strength.values[3]
          ?.toLowerCase()
          .replace(/\s+/g, "");

        // Standardize to mg/mL
        const standardNumerator = standardizeUnit(
          numeratorValue,
          numeratorUnit
        );
        const standardDenominator = standardizeUnit(
          denominatorValue,
          denominatorUnit
        );

        return standardNumerator / standardDenominator;
      }
      function compareMedicationLists() {
        // Get tables and their formats
        const table1Container = document.getElementById("table1Container");
        const table2Container = document.getElementById("table2Container");
        const table1 = table1Container.querySelector(".data-table");
        const table2 = table2Container.querySelector(".data-table");
        const format1 = table1Container.dataset.format;
        const format2 = table2Container.dataset.format;

        if (!table1 || !table2) {
          alert("Please process both medication lists first");
          return;
        }

        // Get medications from both tables
        const getMedicationsFromTable = (table) => {
          const meds = [];
          const rows = table.querySelectorAll("tbody tr");
          rows.forEach((row, index) => {
            const cells = row.querySelectorAll("td");
            if (cells.length >= 2) {
              const medName = cells[1].textContent.trim();
              const instructions = cells[2]?.textContent.trim() || "";
              const comments = cells[3]?.textContent.trim() || "";

              const standardizedName = findMedicationMatch(medName);

              meds.push({
                original: medName,
                standardized: standardizedName,
                instructions,
                comments,
                index,
              });

              console.log(`Processed: ${medName} -> ${standardizedName}`);
            }
          });
          return meds;
        };

        const list1Meds = getMedicationsFromTable(table1);
        const list2Meds = getMedicationsFromTable(table2);

        // Initialize comparison results
        const matches = [];
        const onlyInList1 = [];
        const onlyInList2 = [];

        // Group medications by standardized name
        const list1MedsByStandard = {};
        const list2MedsByStandard = {};

        // Group list 1 medications
        list1Meds.forEach((med) => {
          if (med.standardized) {
            if (!list1MedsByStandard[med.standardized]) {
              list1MedsByStandard[med.standardized] = [];
            }
            list1MedsByStandard[med.standardized].push(med);
          }
        });

        // Group list 2 medications
        list2Meds.forEach((med) => {
          if (med.standardized) {
            if (!list2MedsByStandard[med.standardized]) {
              list2MedsByStandard[med.standardized] = [];
            }
            list2MedsByStandard[med.standardized].push(med);
          }
        });

        // Compare grouped medications
        Object.keys(list1MedsByStandard).forEach((standardName) => {
          const meds1 = list1MedsByStandard[standardName];
          const meds2 = list2MedsByStandard[standardName] || [];

          if (meds2.length > 0) {
            // Compare formulations and strengths
            meds1.forEach((med1) => {
              // Try to find exact instruction match first
              const exactMatch = meds2.find(
                (med2) =>
                  !med2.matched && med1.instructions === med2.instructions
              );

              if (exactMatch) {
                matches.push({
                  list1: med1,
                  list2: exactMatch,
                  formulationComparison: compareFormulations(
                    med1.original,
                    exactMatch.original
                  ),
                  strengthComparison: compareStrengths(
                    med1.original,
                    exactMatch.original
                  ),
                });
                exactMatch.matched = true;
              } else {
                // Find best match based on formulation and strength
                let bestMatch = null;
                let bestScore = -1;

                meds2.forEach((med2) => {
                  if (!med2.matched) {
                    const formulationScore = calculateFormulationSimilarity(
                      med1.original,
                      med2.original
                    );
                    const strengthMatch =
                      compareStrengths(med1.original, med2.original) === "match"
                        ? 1
                        : 0;
                    const totalScore = formulationScore + strengthMatch;

                    if (totalScore > bestScore) {
                      bestScore = totalScore;
                      bestMatch = med2;
                    }
                  }
                });

                if (bestMatch && bestScore > 0) {
                  matches.push({
                    list1: med1,
                    list2: bestMatch,
                    formulationComparison: compareFormulations(
                      med1.original,
                      bestMatch.original
                    ),
                    strengthComparison: compareStrengths(
                      med1.original,
                      bestMatch.original
                    ),
                  });
                  bestMatch.matched = true;
                } else {
                  matches.push({
                    list1: med1,
                    list2: null,
                    formulationComparison: null,
                    strengthComparison: null,
                  });
                }
              }
            });

            // Add remaining unmatched meds from list 2
            meds2
              .filter((med2) => !med2.matched)
              .forEach((med2) => {
                matches.push({
                  list1: null,
                  list2: med2,
                  formulationComparison: null,
                  strengthComparison: null,
                });
              });
          } else {
            // No matching medications in list 2
            meds1.forEach((med1) => {
              onlyInList1.push(med1);
            });
          }
        });

        // Find medications only in list 2
        Object.keys(list2MedsByStandard).forEach((standardName) => {
          if (!list1MedsByStandard[standardName]) {
            list2MedsByStandard[standardName].forEach((med2) => {
              onlyInList2.push(med2);
            });
          }
        });

        // Display results
        displayComparisonResults(
          matches,
          onlyInList1,
          onlyInList2,
          format1,
          format2
        );
      }
      function displayComparisonResults(
        matches,
        onlyInList1,
        onlyInList2,
        format1,
        format2
      ) {
        let resultsContainer = document.getElementById("comparisonResults");
        if (!resultsContainer) {
          resultsContainer = document.createElement("div");
          resultsContainer.id = "comparisonResults";
          document.body.appendChild(resultsContainer);
        }

        const list1Header = getFormatTitleForComparison(format1, 1);
        const list2Header = getFormatTitleForComparison(format2, 2);

        // Group matches by standardized name with optimal pairing logic
        const matchedMedications = {};
        matches.forEach((match) => {
          const standardName =
            match.list1?.standardized ||
            match.list2?.standardized ||
            "unknown medication";
          if (!matchedMedications[standardName]) {
            matchedMedications[standardName] = {
              list1: [],
              list2: [],
              pairings: [],
            };
          }
          if (match.list1)
            matchedMedications[standardName].list1.push(match.list1);
          if (match.list2)
            matchedMedications[standardName].list2.push(match.list2);
        });

        // Calculate optimal pairings for each medication group
        Object.values(matchedMedications).forEach((group) => {
          const pairings = [];
          const used1 = new Set();
          const used2 = new Set();

          // Calculate similarity scores for all possible pairs
          const scores = [];
          group.list1.forEach((med1, i) => {
            group.list2.forEach((med2, j) => {
              const similarity = calculateFormulationSimilarity(
                med1.original,
                med2.original
              );
              scores.push({ med1Index: i, med2Index: j, score: similarity });
            });
          });

          // Sort pairs by similarity score
          scores.sort((a, b) => b.score - a.score);

          // Assign pairs starting with most similar
          scores.forEach(({ med1Index, med2Index, score }) => {
            if (!used1.has(med1Index) && !used2.has(med2Index)) {
              pairings.push({
                list1: group.list1[med1Index],
                list2: group.list2[med2Index],
                similarity: score,
              });
              used1.add(med1Index);
              used2.add(med2Index);
            }
          });

          // Add remaining unpaired medications
          group.list1.forEach((med1, i) => {
            if (!used1.has(i)) {
              pairings.push({ list1: med1, list2: null, similarity: 0 });
            }
          });
          group.list2.forEach((med2, i) => {
            if (!used2.has(i)) {
              pairings.push({ list1: null, list2: med2, similarity: 0 });
            }
          });

          group.pairings = pairings;
        });

        // Sort function to put unknown medications at the end
        const sortMedications = (a, b) => {
          if (a[0] === "unknown medication" && b[0] !== "unknown medication")
            return 1;
          if (a[0] !== "unknown medication" && b[0] === "unknown medication")
            return -1;
          return a[0].localeCompare(b[0]);
        };

        let html = `
        <h2>Medication Comparison Results</h2>
        
        <h3>Matching Medications (${matches.length} entries)</h3>
        <table class="data-table comparison-table">
            <thead>
                <tr>
                    <th>Include</th>
                    <th>Standard Medication Name</th>
                    <th>${list1Header}</th>
                    <th>${list2Header}</th>
                </tr>
            </thead>
            <tbody>
                ${Object.entries(matchedMedications)
                  .sort(sortMedications)
                  .map(([standardName, meds]) => {
                    return meds.pairings
                      .map(
                        (pair, index) => `
                            ${
                              index === 0
                                ? `
                                <tr class="medication-group">
                                    <td rowspan="${meds.pairings.length}">
                                        <input type="checkbox" class="report-select" data-type="match">
                                    </td>
                                    <td rowspan="${meds.pairings.length}">${standardName}</td>
                            `
                                : '<tr class="medication-subrow">'
                            }
                                    <td>${
                                      pair.list1
                                        ? formatMedicationDetails(
                                            pair.list1,
                                            pair.list2
                                          )
                                        : "—"
                                    }</td>
                                    <td>${
                                      pair.list2
                                        ? formatMedicationDetails(
                                            pair.list2,
                                            pair.list1
                                          )
                                        : "—"
                                    }</td>
                                </tr>
                        `
                      )
                      .join("");
                  })
                  .join("")}
            </tbody>
        </table>

        <h3>Medications Only in ${list1Header} (${
          onlyInList1.length
        } entries)</h3>
        <table class="data-table comparison-table">
            <thead>
                <tr>
                    <th>Include</th>
                    <th>Standard Medication Name</th>
                    <th>Full Medication Details</th>
                </tr>
            </thead>
            <tbody>
                ${Object.entries(
                  onlyInList1.reduce((groups, med) => {
                    const standardName =
                      med.standardized || "unknown medication";
                    if (!groups[standardName]) groups[standardName] = [];
                    groups[standardName].push(med);
                    return groups;
                  }, {})
                )
                  .sort(sortMedications)
                  .map(
                    ([standardName, meds]) => `
                    <tr class="medication-group">
                        <td rowspan="${meds.length}">
                            <input type="checkbox" class="report-select" data-type="list1" checked>
                        </td>
                        <td rowspan="${meds.length}">${standardName}</td>
                        <td>${formatMedicationDetails(meds[0])}</td>
                    </tr>
                    ${meds
                      .slice(1)
                      .map(
                        (med) => `
                        <tr class="medication-subrow">
                            <td>${formatMedicationDetails(med)}</td>
                        </tr>
                    `
                      )
                      .join("")}
                `
                  )
                  .join("")}
            </tbody>
        </table>

        <h3>Medications Only in ${list2Header} (${
          onlyInList2.length
        } entries)</h3>
        <table class="data-table comparison-table">
            <thead>
                <tr>
                    <th>Include</th>
                    <th>Standard Medication Name</th>
                    <th>Full Medication Details</th>
                </tr>
            </thead>
            <tbody>
                ${Object.entries(
                  onlyInList2.reduce((groups, med) => {
                    const standardName =
                      med.standardized || "unknown medication";
                    if (!groups[standardName]) groups[standardName] = [];
                    groups[standardName].push(med);
                    return groups;
                  }, {})
                )
                  .sort(sortMedications)
                  .map(
                    ([standardName, meds]) => `
                    <tr class="medication-group">
                        <td rowspan="${meds.length}">
                            <input type="checkbox" class="report-select" data-type="list2" checked>
                        </td>
                        <td rowspan="${meds.length}">${standardName}</td>
                        <td>${formatMedicationDetails(meds[0])}</td>
                    </tr>
                    ${meds
                      .slice(1)
                      .map(
                        (med) => `
                        <tr class="medication-subrow">
                            <td>${formatMedicationDetails(med)}</td>
                        </tr>
                    `
                      )
                      .join("")}
                `
                  )
                  .join("")}
            </tbody>
        </table>

        <div style="text-align: center; margin: 20px;">
            <button onclick="generateReport()" class="generate-report-btn">
                Generate Report
            </button>
        </div>
    `;

        resultsContainer.innerHTML = html;
      }

      function calculateFormulationSimilarity(med1, med2) {
        const forms1 = findLongestFormulationMatch(med1);
        const forms2 = findLongestFormulationMatch(med2);

        if (!forms1 || !forms2) return 0;

        // Create sets of formulation terms
        const formSet1 = new Set(forms1.map((f) => f.match));
        const formSet2 = new Set(forms2.map((f) => f.match));

        // Calculate Jaccard similarity coefficient
        const intersection = new Set(
          [...formSet1].filter((x) => formSet2.has(x))
        );
        const union = new Set([...formSet1, ...formSet2]);

        // Calculate base similarity score
        let score = intersection.size / union.size;

        // Add bonus for matching modified release status
        if (isModifiedRelease(med1) === isModifiedRelease(med2)) {
          score += 0.1;
        }

        // Add bonus for matching enteric coating status
        if (isEntericCoated(med1) === isEntericCoated(med2)) {
          score += 0.1;
        }

        // Add bonus for exact route match
        const route1 = forms1[0]?.mainCategory;
        const route2 = forms2[0]?.mainCategory;
        if (route1 === route2) {
          score += 0.2;
        }

        return score;
      }
      function highlightFormulationTerms(text, comparisonMed) {
        if (!text) return text;

        let result = text;

        function findFormulationTerms(obj) {
          let terms = [];
          for (const [_, value] of Object.entries(obj)) {
            if (Array.isArray(value)) {
              terms = [...terms, ...value];
            } else if (typeof value === "object" && value !== null) {
              terms = [...terms, ...findFormulationTerms(value)];
            }
          }
          return terms;
        }

        const terms = findFormulationTerms(formulationDict);

        // Modified release patterns - expanded to include all variations
        const mrPatterns = [
          /\bm[\/\.]?r\b/i,
          /\bs[\/\.]?r\b/i,
          /\bp[\/\.]?r\b/i,
          /\be[\/\.]?r\b/i,
          /\bc[\/\.]?r\b/i,
          /\bx[\/\.]?l\b/i,
          /\bmodified[\-\s]?release\b/i,
          /\bsustained[\-\s]?release\b/i,
          /\bprolonged[\-\s]?release\b/i,
          /\bextended[\-\s]?release\b/i,
          /\bcontrolled[\-\s]?release\b/i,
          /\bsr\b/i,
          /\bmr\b/i,
          /\bpr\b/i,
          /\ber\b/i,
          /\bcr\b/i,
          /\bxl\b/i,
        ];

        // Enteric coated patterns - exact matches only
        const ecPatterns = [
          /\be[\/\.]c\b/i,
          /\bg[\/\.]r\b/i,
          /\benteric[\-\s]?coated\b/i,
          /\bgastro[\-\s]?resistant\b/i,
          /\bgastro[\-\s]?protected\b/i,
          /\bec\b/i,
          /\bgr\b/i,
        ];

        terms.sort((a, b) => b.length - a.length);

        const comparisonResult = comparisonMed
          ? compareFormulations(text, comparisonMed)
          : null;

        // Apply highlighting to m/r terms first
        mrPatterns.forEach((pattern) => {
          result = result.replace(pattern, (match) => {
            let className = "formulation-term";
            if (comparisonResult === "match") {
              className = "formulation-match";
            } else if (comparisonResult === "similar") {
              className = "formulation-similar";
            } else if (comparisonResult === "different") {
              className = "formulation-different";
            }
            return `<span class="${className}">${match}</span>`;
          });
        });

        // Apply highlighting to e/c terms
        ecPatterns.forEach((pattern) => {
          result = result.replace(pattern, (match) => {
            let className = "formulation-term";
            if (comparisonResult === "match") {
              className = "formulation-match";
            } else if (comparisonResult === "similar") {
              className = "formulation-similar";
            } else if (comparisonResult === "different") {
              className = "formulation-different";
            }
            return `<span class="${className}">${match}</span>`;
          });
        });

        // Apply highlighting to other formulation terms with exact word matching
        terms.forEach((term) => {
          if (term.includes(".")) {
            // For terms with dots (like s.l.), create exact match pattern
            const exactPattern = new RegExp(term.replace(/\./g, "\\."), "gi");
            result = result.replace(exactPattern, (match) => {
              let className = "formulation-term";
              if (comparisonResult === "match") {
                className = "formulation-match";
              } else if (comparisonResult === "similar") {
                className = "formulation-similar";
              } else if (comparisonResult === "different") {
                className = "formulation-different";
              }
              return `<span class="${className}">${match}</span>`;
            });
          } else {
            // For regular terms, use word boundary matching
            const pattern = new RegExp(`\\b${term}\\b`, "gi");
            result = result.replace(pattern, (match) => {
              let className = "formulation-term";
              if (comparisonResult === "match") {
                className = "formulation-match";
              } else if (comparisonResult === "similar") {
                className = "formulation-similar";
              } else if (comparisonResult === "different") {
                className = "formulation-different";
              }
              return `<span class="${className}">${match}</span>`;
            });
          }
        });

        return result;
      }
      function formatMedicationDetails(med1, med2) {
        if (!med2) {
          // Single medication display - no comparison needed
          return `
            <div class="medication-detail">
                <div class="original-name">${highlightFormulationAndStrength(
                  med1.original
                )}</div>
                <div class="instructions">${med1.instructions}</div>
                ${
                  med1.comments
                    ? `<div class="comments">${med1.comments}</div>`
                    : ""
                }
            </div>
        `;
        }

        const formulationComparison = compareFormulations(
          med1.original,
          med2.original
        );
        const strengthComparison = compareStrengths(
          med1.original,
          med2.original
        );

        // Helper function to determine highlight class based on comparison results
        function getHighlightClass(text, type) {
          if (type === "formulation") {
            switch (formulationComparison) {
              case "match":
                return "formulation-match";
              case "similar":
                return "formulation-similar";
              case "different":
                return "formulation-different";
              default:
                return "formulation-term";
            }
          } else if (type === "strength") {
            switch (strengthComparison) {
              case "match":
                return "strength-match";
              case "different":
                return "strength-different";
              default:
                return "strength-term";
            }
          }
          return "";
        }

        return `
        <div class="medication-detail">
            <div class="original-name">
                ${highlightFormulationAndStrength(med1.original, med2.original)}
            </div>
            <div class="instructions">${med1.instructions}</div>
            ${
              med1.comments
                ? `<div class="comments">${med1.comments}</div>`
                : ""
            }
        </div>
    `;
      }

      function highlightFormulationAndStrength(text, comparisonMed) {
        let result = highlightFormulationTerms(text, comparisonMed);

        if (comparisonMed) {
          const strengthComparison = compareStrengths(text, comparisonMed);
          const strengths = extractStrength(text);

          const packSizePatterns = [
            /\(\d+\s*(?:PK|Pack|Packs?)\)/i, // (30 Pack)
            /\d+\s*(?:PK|Pack|Packs?)\b/i, // 30 Pack
            /(?:PK|Pack|Packs?)\s*\d+/i, // Pack 30
            /\(\d+\s*(?:tablet|cap|capsule|dose|sachet)s?\)/i, // (30 tablets)
            /\d+\s*(?:tablet|cap|capsule|dose|sachet)s?\b/i, // 30 tablets
            /Pack\s+(?:of\s+)?\d+\b/i, // Pack of 30
            /\(\s*\d+\s*\)\s*(?=\])/i, // (30)] but only at the end
            /\d+\s*G\]/i, // Matches numbers followed by G] (with optional spaces)
            /\d+\s*ML\]/i, // Matches numbers followed by ML] (with optional spaces)
            /\d+\s*L\]/i, // Matches numbers followed by L] (with optional spaces)
            /\(\d+\s*(?:Day|Days?)\)/i, // Matches (X Day) or (X Days)
          ];

          const numberPattern = "\\d+(?:\\.\\d+)?";
          const unitsPattern =
            "(?:mg|mcg|g|microgram|micrograms|milligram|milligrams|gram|grams|unit|units|u|iu|ml|mL|ML|millilitre|milliliter|l|L|litre|liter)s?";

          // Separate pattern for percentages
          const percentagePattern = new RegExp(
            `(${numberPattern}\\s*%)(?!\\s*(?:PK|pk|Pk|pK|Pack|Packs?)\\b|\\s*\\])`,
            "gi"
          );

          const strengthPatterns = [
            // Triple combination
            new RegExp(
              `(${numberPattern}\\s*(?:${unitsPattern})?\\s*\\/\\s*${numberPattern}\\s*(?:${unitsPattern})?\\s*\\/\\s*${numberPattern}\\s*(?:${unitsPattern})?)(?!\\s*(?:PK|pk|Pk|pK|Pack|Packs?)\\b)`,
              "gi"
            ),

            // Standard concentration
            new RegExp(
              `(${numberPattern}\\s*(?:${unitsPattern})?\\s*\\/\\s*(?:${numberPattern}\\s*)?(?:${unitsPattern})?)(?!\\s*(?:PK|pk|Pk|pK|Pack|Packs?)\\b)`,
              "gi"
            ),

            // Double combination
            new RegExp(
              `(${numberPattern}\\s*(?:${unitsPattern})?\\s*\\/\\s*${numberPattern}\\s*(?:${unitsPattern})?)(?!\\s*(?:PK|pk|Pk|pK|Pack|Packs?)\\b)`,
              "gi"
            ),

            // Single strength with units
            new RegExp(
              `(${numberPattern}\\s*(?:${unitsPattern})?)(?!\\s*(?:PK|pk|Pk|pK|Pack|Packs?)\\b)`,
              "gi"
            ),
          ];

          let className =
            strengthComparison === "match"
              ? "strength-match"
              : strengthComparison === "similar"
              ? "strength-similar"
              : strengthComparison === "different"
              ? "strength-different"
              : "strength-term";

          // Handle percentage matches first
          const percentMatches = Array.from(text.matchAll(percentagePattern));
          for (const match of percentMatches) {
            if (isStandaloneNumber(text, match[1].replace("%", ""))) {
              result = result.replace(
                match[1],
                `<span class="${className}">${match[1]}</span>`
              );
            }
          }

          // Handle other strength patterns
          strengthPatterns.forEach((pattern) => {
            const matches = text.matchAll(pattern);
            for (const match of matches) {
              if (isStandaloneNumber(text, match[1])) {
                let isExcluded = false;
                const matchText = match[1];
                const matchPosition = text.indexOf(matchText);

                packSizePatterns.forEach((packPattern) => {
                  const packMatch = text.match(packPattern);
                  if (
                    packMatch &&
                    packMatch.index <= matchPosition &&
                    packMatch.index + packMatch[0].length >=
                      matchPosition + matchText.length
                  ) {
                    isExcluded = true;
                  }
                });

                if (!isExcluded) {
                  result = result.replace(
                    match[1],
                    `<span class="${className}">${match[1]}</span>`
                  );
                }
              }
            }
          });
        }

        return result;
      }
      function generateReport() {
        const matchingMeds = [];
        const discontinuedMeds = [];
        const newMeds = [];

        const reportSelects = document.querySelectorAll(
          ".report-select:checked"
        );

        reportSelects.forEach((checkbox) => {
          const row = checkbox.closest("tr");
          const type = checkbox.dataset.type;
          const standardName = row.querySelector("td:nth-child(2)").textContent;

          if (type === "match") {
            // Process main row
            const list1Cell = row.querySelector("td:nth-child(3)");
            const list2Cell = row.querySelector("td:nth-child(4)");

            const list1Details = list1Cell
              ? extractMedicationAndInstructions(list1Cell)
              : "";
            const list2Details = list2Cell
              ? extractMedicationAndInstructions(list2Cell)
              : "";

            matchingMeds.push({
              standardName,
              list1Details: list1Details !== "—" ? list1Details : "",
              list2Details: list2Details !== "—" ? list2Details : "",
            });

            // Process subrows
            let nextRow = row.nextElementSibling;
            while (nextRow && nextRow.classList.contains("medication-subrow")) {
              const subList1Cell = nextRow.querySelector("td:nth-child(1)");
              const subList2Cell = nextRow.querySelector("td:nth-child(2)");

              const subList1Details = subList1Cell
                ? extractMedicationAndInstructions(subList1Cell)
                : "";
              const subList2Details = subList2Cell
                ? extractMedicationAndInstructions(subList2Cell)
                : "";

              if (subList1Details !== "—" || subList2Details !== "—") {
                matchingMeds.push({
                  standardName,
                  list1Details: subList1Details !== "—" ? subList1Details : "",
                  list2Details: subList2Details !== "—" ? subList2Details : "",
                });
              }
              nextRow = nextRow.nextElementSibling;
            }
          } else if (type === "list1") {
            const detailsCell = row.querySelector("td:nth-child(3)");
            const details = detailsCell
              ? extractMedicationAndInstructions(detailsCell)
              : "";

            discontinuedMeds.push({
              standardName,
              details: details !== "—" ? details : "",
            });

            // Process subrows
            let nextRow = row.nextElementSibling;
            while (nextRow && nextRow.classList.contains("medication-subrow")) {
              const subDetailsCell = nextRow.querySelector("td:nth-child(1)");
              const subDetails = subDetailsCell
                ? extractMedicationAndInstructions(subDetailsCell)
                : "";

              if (subDetails !== "—") {
                discontinuedMeds.push({
                  standardName,
                  details: subDetails,
                });
              }
              nextRow = nextRow.nextElementSibling;
            }
          } else if (type === "list2") {
            const detailsCell = row.querySelector("td:nth-child(3)");
            const details = detailsCell
              ? extractMedicationAndInstructions(detailsCell)
              : "";

            newMeds.push({
              standardName,
              details: details !== "—" ? details : "",
            });

            // Process subrows
            let nextRow = row.nextElementSibling;
            while (nextRow && nextRow.classList.contains("medication-subrow")) {
              const subDetailsCell = nextRow.querySelector("td:nth-child(1)");
              const subDetails = subDetailsCell
                ? extractMedicationAndInstructions(subDetailsCell)
                : "";

              if (subDetails !== "—") {
                newMeds.push({
                  standardName,
                  details: subDetails,
                });
              }
              nextRow = nextRow.nextElementSibling;
            }
          }
        });

        displayReport(matchingMeds, discontinuedMeds, newMeds);
      }

      function displayReport(matchingMeds, discontinuedMeds, newMeds) {
        const reportContainer = document.createElement("div");
        reportContainer.id = "reportContainer";
        reportContainer.className = "report-container";

        const list1Header = document.querySelector(
          "#comparisonResults th:nth-child(3)"
        ).textContent;
        const list2Header = document.querySelector(
          "#comparisonResults th:nth-child(4)"
        ).textContent;

        // Format medication details for report
        function formatReportMedication(med) {
          return highlightFormulationTerms(med);
        }

        // Group medications by standardName
        const groupedMatchingMeds = matchingMeds.reduce((acc, med) => {
          if (!acc[med.standardName]) {
            acc[med.standardName] = [];
          }
          acc[med.standardName].push(med);
          return acc;
        }, {});

        const groupedDiscontinuedMeds = discontinuedMeds.reduce((acc, med) => {
          if (!acc[med.standardName]) {
            acc[med.standardName] = [];
          }
          acc[med.standardName].push(med);
          return acc;
        }, {});

        const groupedNewMeds = newMeds.reduce((acc, med) => {
          if (!acc[med.standardName]) {
            acc[med.standardName] = [];
          }
          acc[med.standardName].push(med);
          return acc;
        }, {});

        const html = `
    ${
      Object.keys(groupedMatchingMeds).length > 0
        ? `
        <table class="data-table report-table">
            <thead>
                <tr>
                    <th>Medication in Common</th>
                    <th>${list1Header}</th>
                    <th>${list2Header}</th>
                    <th>Comments</th>
                </tr>
            </thead>
            <tbody>
                ${Object.entries(groupedMatchingMeds)
                  .map(([standardName, meds]) =>
                    meds
                      .map(
                        (med, index) => `
                        <tr>
                            <td>${index === 0 ? standardName : ""}</td>
                            <td>${
                              med.list1Details
                                ? formatReportMedication(med.list1Details)
                                : "—"
                            }</td>
                            <td>${
                              med.list2Details
                                ? formatReportMedication(med.list2Details)
                                : "—"
                            }</td>
                            <td contenteditable="true" class="comments-cell">—</td>
                        </tr>
                    `
                      )
                      .join("")
                  )
                  .join("")}
            </tbody>
        </table>
    `
        : ""
    }

       ${
         Object.keys(groupedDiscontinuedMeds).length > 0
           ? `
           <table class="data-table report-table">
               <thead>
                   <tr>
                       <th>Discontinued Medication</th>
                       <th>Details</th>
                       <th>Comments</th>
                   </tr>
               </thead>
               <tbody>
                   ${Object.entries(groupedDiscontinuedMeds)
                     .map(([standardName, meds]) =>
                       meds
                         .map(
                           (med, index) => `
                           <tr>
                               <td>${index === 0 ? standardName : ""}</td>
                               <td>${
                                 med.details
                                   ? formatReportMedication(med.details)
                                   : "—"
                               }</td>
                               <td contenteditable="true" class="comments-cell">—</td>
                           </tr>
                       `
                         )
                         .join("")
                     )
                     .join("")}
               </tbody>
           </table>
       `
           : ""
       }

       ${
         Object.keys(groupedNewMeds).length > 0
           ? `
           <table class="data-table report-table">
               <thead>
                   <tr>
                       <th>New Medication</th>
                       <th>Details</th>
                       <th>Comments</th>
                   </tr>
               </thead>
               <tbody>
                   ${Object.entries(groupedNewMeds)
                     .map(([standardName, meds]) =>
                       meds
                         .map(
                           (med, index) => `
                           <tr>
                               <td>${index === 0 ? standardName : ""}</td>
                               <td>${
                                 med.details
                                   ? formatReportMedication(med.details)
                                   : "—"
                               }</td>
                               <td contenteditable="true" class="comments-cell">—</td>
                           </tr>
                       `
                         )
                         .join("")
                     )
                     .join("")}
               </tbody>
           </table>
       `
           : ""
       }

       <div class="report-controls">
           <button onclick="copyReport()" class="copy-btn">Copy Report</button>
           <button onclick="printReport()" class="print-btn">Print Report</button>
           <button onclick="closeReport()" class="close-btn">Close</button>
       </div>
   `;

        reportContainer.innerHTML = html;
        document.body.appendChild(reportContainer);

        // Add event listeners for the comments cells
        reportContainer.querySelectorAll(".comments-cell").forEach((cell) => {
          cell.addEventListener("focus", function () {
            if (this.textContent === "—") {
              this.textContent = "";
            }
          });

          cell.addEventListener("blur", function () {
            if (!this.textContent.trim()) {
              this.textContent = "—";
            }
          });
        });
      }
      // Add the copy function
      function copyReport() {
        const reportContainer = document.getElementById("reportContainer");

        // Create a temporary container for the formatted copy
        const tempContainer = document.createElement("div");

        // Clone the content but exclude the buttons
        const reportContent = reportContainer.cloneNode(true);
        reportContent.querySelector(".report-controls").remove();

        // Add some inline styles for the copy
        const styleElement = document.createElement("style");
        styleElement.textContent = `
        .report-container {
            font-family: Arial, sans-serif;
            padding: 20px;
        }
        .data-table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 30px;  /* Increased bottom margin for tables */
        }
        .data-table th, .data-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .data-table th {
            background-color: #f5f5f5;
        }
        h2 {
            color: #333;
            font-size: 20px;  /* Larger font size for main title */
            margin-bottom: 30px;  /* Increased spacing after title */
            padding-bottom: 10px;  /* Added padding for visual separation */
            border-bottom: 2px solid #333;  /* Added underline for emphasis */
        }
        h3 {
            color: #666;
            font-size: 16px;  /* Subtitle size */
            margin: 25px 0 15px 0;  /* Increased top margin for spacing */
        }
        /* Ensure first h3 has proper spacing after h2 */
        h2 + h3 {
            margin-top: 30px;
        }
    `;

        tempContainer.appendChild(styleElement);
        tempContainer.appendChild(reportContent);

        // Create a blob with the HTML content
        const blob = new Blob([tempContainer.innerHTML], { type: "text/html" });

        // Create a ClipboardItem with both HTML and plain text formats
        const data = new ClipboardItem({
          "text/html": blob,
          "text/plain": new Blob([reportContainer.innerText], {
            type: "text/plain",
          }),
        });

        // Copy to clipboard
        navigator.clipboard
          .write([data])
          .then(() => {
            // Show feedback to user
            const copyBtn = document.querySelector(".copy-btn");
            const originalText = copyBtn.textContent;
            copyBtn.textContent = "Copied!";
            setTimeout(() => {
              copyBtn.textContent = originalText;
            }, 2000);
          })
          .catch((err) => {
            console.error("Failed to copy report:", err);
            alert("Failed to copy report to clipboard");
          });
      }

      // Helper function remains the same
      function extractMedicationAndInstructions(cell) {
        if (!cell || cell.textContent.trim() === "—") return "";

        const medicationDetail = cell.querySelector(".medication-detail");
        if (!medicationDetail) return cell.textContent.trim();

        const originalName =
          medicationDetail.querySelector(".original-name")?.textContent || "";
        const instructions =
          medicationDetail.querySelector(".instructions")?.textContent || "";

        return [originalName, instructions].filter(Boolean).join(" ");
      }

      function printReport() {
        window.print();
      }

      function closeReport() {
        document.getElementById("reportContainer").remove();
      }
      function processInputData(data) {
        console.log("Starting processInputData");

        // Standard header for all formats
        let processedData = "Medication\tInstructions\tComments\n";

        if (isGNCRFormat(data)) {
          return formatGNCRData(data);
        } else if (isCurrentMedsFormat(data)) {
          return formatCurrentMedsData(data);
        } else if (isHMTFormat(data)) {
          return formatHMTData(data);
        } else if (isDischargeMedicationFormat(data)) {
          return formatDischargeMedicationData(data);
        } else if (isRecentTTOFormat(data)) {
          return formatRecentTTOData(data);
        } else if (isMSXLFormat(data)) {
          return formatMSXLData(data);
        }

        return processedData;
      }

      function mergeSelectedRows(listNumber) {
        const table = document.querySelector(
          `#table${listNumber}Container table`
        );
        const selectedRows = table.querySelectorAll("input.row-select:checked");

        if (selectedRows.length < 2) {
          alert("Please select at least 2 rows to merge");
          return;
        }

        // Get data from selected rows
        const rowsData = Array.from(selectedRows).map((checkbox) => {
          const row = checkbox.closest("tr");
          const cells = Array.from(
            row.querySelectorAll("td:not(.select-cell)")
          );
          return {
            medication: cells[0].textContent.trim(),
            instructions: cells[1].textContent.trim(),
            comments: cells[2].textContent.trim(),
          };
        });

        // Merge the data
        const mergedRow = {
          medication: rowsData
            .map((r) => r.medication)
            .filter((m) => m !== "—")
            .join("; "),
          instructions: rowsData
            .map((r) => r.instructions)
            .filter((i) => i !== "—")
            .join("; "),
          comments: rowsData
            .map((r) => r.comments)
            .filter((c) => c !== "—")
            .join("; "),
        };

        // Create new row
        const newRow = document.createElement("tr");
        newRow.innerHTML = `
        <td class="select-cell">
            <input type="checkbox" class="row-select" onchange="updateRowSelection(this)">
        </td>
        <td class="table-cell" contenteditable="true">${
          mergedRow.medication || "—"
        }</td>
        <td class="table-cell" contenteditable="true">${
          mergedRow.instructions || "—"
        }</td>
        <td class="table-cell" contenteditable="true">${
          mergedRow.comments || "—"
        }</td>
    `;

        // Replace rows
        const firstSelectedRow = selectedRows[0].closest("tr");
        firstSelectedRow.parentNode.insertBefore(newRow, firstSelectedRow);
        selectedRows.forEach((checkbox) => checkbox.closest("tr").remove());
      }
      function cleanInputData(data) {
        // Only remove completely blank lines while preserving leading spaces in non-blank lines
        return data
          .split("\n")
          .filter((line) => line.length > 0) // Keep any line with content, even if just spaces
          .join("\n");
      }
      function isCurrentMedsFormat(data) {
        // Split into lines and trim empty lines
        const lines = data.split("\n").filter((line) => line.trim());

        // Check for header
        const headerIndex = lines.findIndex(
          (line) => line.trim() === "Current Medications"
        );
        if (headerIndex === -1) return false;

        // Check if there's at least one line after the header that looks like a medication
        // (contains brackets and ends with something like SCH or PRN)
        if (headerIndex + 1 < lines.length) {
          const nextLine = lines[headerIndex + 1];
          return (
            nextLine.includes("(") &&
            (nextLine.endsWith("SCH") ||
              nextLine.endsWith("PRN") ||
              nextLine.includes("Protocol") ||
              nextLine.includes("STA") ||
              nextLine.includes("ONE"))
          );
        }

        return false;
      }
      function hasCompleteBrackets(text) {
        let bracketCount = 0;
        for (let char of text) {
          if (char === "(") bracketCount++;
          if (char === ")") bracketCount--;
        }
        return bracketCount === 0 && text.includes("(") && text.includes(")");
      }
      function formatCurrentMedsData(data) {
        const lines = data.split("\n");
        let processedRows = [];
        let currentMedication = "";
        let currentInstructions = "";
        let currentComments = [];

        // Add header row
        processedRows.push(
          ["Medication", "Instructions", "Comments"].join("\t")
        );

        function hasCompleteBrackets(text) {
          let bracketCount = 0;
          for (let char of text) {
            if (char === "(") bracketCount++;
            if (char === ")") bracketCount--;
          }
          return bracketCount === 0 && text.includes("(") && text.includes(")");
        }

        function isNewMedication(text) {
          // Check for complete brackets or @ sign
          if (hasCompleteBrackets(text) || text.includes("@")) {
            return true;
          }

          // Check for trigger words at end of line
          const triggerWords = ["SCH", "PRN", "Protocol", "STA", "ONE"];
          const trimmedText = text.trim();
          return triggerWords.some((word) =>
            trimmedText.toUpperCase().endsWith(word)
          );
        }

        // Find the "Current Medications" line
        let startIndex = lines.findIndex(
          (line) => line.trim() === "Current Medications"
        );
        if (startIndex === -1) return processedRows.join("\n");

        // Start processing from two lines after "Current Medications"
        let i = startIndex + 1;

        console.log("Starting processing from line:", i);

        while (i < lines.length) {
          const line = lines[i];
          const trimmedLine = line.trim();

          console.log(`\nProcessing line ${i}: "${line}"`);

          // Only process non-empty lines
          if (trimmedLine) {
            // Check if this is a new medication line
            if (isNewMedication(trimmedLine)) {
              // Save previous entry if exists
              if (currentMedication) {
                console.log("New medication line - saving previous entry:", {
                  medication: currentMedication,
                  instructions: currentInstructions,
                  comments: [...currentComments],
                });
                processedRows.push(
                  [
                    currentMedication,
                    currentInstructions,
                    currentComments.length ? currentComments.join(", ") : "",
                  ].join("\t")
                );
              }

              if (hasCompleteBrackets(trimmedLine)) {
                // Process bracket-based format
                let lastClosingBracketIndex = -1;
                let bracketCount = 0;
                for (let j = 0; j < trimmedLine.length; j++) {
                  if (trimmedLine[j] === "(") bracketCount++;
                  if (trimmedLine[j] === ")") {
                    bracketCount--;
                    if (bracketCount === 0) {
                      lastClosingBracketIndex = j;
                    }
                  }
                }

                currentMedication = trimmedLine
                  .substring(0, lastClosingBracketIndex + 1)
                  .trim();
                currentInstructions = trimmedLine
                  .substring(lastClosingBracketIndex + 1)
                  .trim();
              } else if (trimmedLine.includes("@")) {
                // Process @ sign format
                const parts = trimmedLine.split("@");
                currentMedication = parts[0].trim();
                currentInstructions = "@" + parts.slice(1).join("@").trim();
              } else {
                // Process trigger word format - attempt to find medication name in parentheses
                const match = trimmedLine.match(/^(.*?\))(.*)$/);
                if (match) {
                  currentMedication = match[1].trim();
                  currentInstructions = match[2].trim();
                } else {
                  // If no parentheses found, use whole line
                  currentMedication = trimmedLine;
                  currentInstructions = "";
                }
              }

              currentComments = []; // Reset comments for new medication

              console.log("Started new medication entry:", {
                medication: currentMedication,
                instructions: currentInstructions,
              });
            } else {
              // This is a comment line
              if (currentMedication) {
                console.log("Adding comment:", trimmedLine);
                currentComments.push(trimmedLine);
                console.log("Current comments:", [...currentComments]);
              }
            }
          }
          i++;
        }

        // Add final entry if exists
        if (currentMedication) {
          console.log("Saving final entry:", {
            medication: currentMedication,
            instructions: currentInstructions,
            comments: [...currentComments],
          });
          processedRows.push(
            [
              currentMedication,
              currentInstructions,
              currentComments.length ? currentComments.join(", ") : "",
            ].join("\t")
          );
        }

        return processedRows.join("\n");
      }
      function isHMTFormat(data) {
        console.log("Checking if HMT format...");
        const rows = data.split("\n");
        for (let row of rows) {
          const columns = row.split("\t"); // Don't trim here
          if (columns[0] === " Medication") {
            // Check for exact match including leading space
            console.log("Found HMT format - ' Medication' column detected");
            return true;
          }
        }
        console.log("Not HMT format - no ' Medication' column found");
        return false;
      }

      function formatHMTData(data) {
        const rows = data.split("\n");
        let processedRows = [];
        let currentMedication = null;
        let currentInstructions = null;
        let currentComments = null;
        let headerColumns = [];
        let headerFound = false;

        // Define which columns should go to comments
        const commentColumns = ["Active", "Recorded", "Status"];

        // Add our standard header
        processedRows.push(
          ["Medication", "Instructions", "Comments"].join("\t")
        );

        // First find the header row and get all column headers
        let headerRowIndex = -1;
        for (let i = 0; i < rows.length; i++) {
          const columns = rows[i].split("\t");
          if (columns[0] === " Medication") {
            headerFound = true;
            headerRowIndex = i;
            headerColumns = columns.map((h) => h.trim());
            console.log("Found headers:", headerColumns);
            break;
          }
        }

        if (!headerFound) {
          console.warn('Not valid HMT format - " Medication" column not found');
          return null;
        }

        function isNewMedicationLine(columns) {
          if (!columns[0]) return false;

          const firstColumn = columns[0].trim();

          // Skip lines that are clearly continuations
          if (firstColumn.startsWith("[")) return false;
          if (firstColumn.includes("]") && !firstColumn.includes("["))
            return false;

          // Check if the first column exactly matches a medication in the dictionary
          const matchResult = findMedicationMatch(firstColumn);
          const isExactMatch =
            matchResult !== "unknown medication" &&
            Object.entries(medicationDict.medications).some(
              ([standardName, aliases]) => {
                return [
                  standardName.toLowerCase(),
                  ...aliases.map((a) => a.toLowerCase()),
                ].includes(firstColumn.toLowerCase());
              }
            );

          if (isExactMatch) {
            return true;
          }

          // If there's an instruction in column 1, it might be a new medication line
          if (columns[1]) {
            const instructionPattern = /^(\d|See Taper|See Protocol)/;
            return instructionPattern.test(columns[1].trim());
          }

          return false;
        }

        // Process each row
        for (let i = headerRowIndex + 1; i < rows.length; i++) {
          let columns = rows[i].split("\t").map((col) => col.trim());

          // Skip empty rows
          if (columns.every((col) => !col)) continue;

          if (isNewMedicationLine(columns)) {
            // Save previous entry if exists
            if (currentMedication) {
              processedRows.push(
                [
                  currentMedication,
                  currentInstructions || "",
                  currentComments || "",
                ].join("\t")
              );
            }

            // Start new entry
            currentMedication = columns[0];
            currentInstructions = columns[1];
            let instructionExtras = [];
            let commentParts = [];

            // Handle additional columns
            for (let j = 2; j < columns.length; j++) {
              if (columns[j] && headerColumns[j]) {
                const header = headerColumns[j];
                const value = columns[j];

                if (commentColumns.includes(header)) {
                  commentParts.push(`${header}: ${value}`);
                } else {
                  instructionExtras.push(
                    `<strong>${header}: ${value}</strong>`
                  );
                }
              }
            }

            // Add extras to instructions if any exist
            if (instructionExtras.length > 0) {
              currentInstructions += "; " + instructionExtras.join("; ");
            }

            // Set comments
            currentComments = commentParts.join(", ");
          } else {
            // This is a continuation line
            if (columns[0]) {
              const trimmedContent = columns[0].trim();

              // If this is a bracketed continuation of the previous medication
              if (trimmedContent.startsWith("[")) {
                currentMedication = currentMedication
                  ? `${currentMedication} ${trimmedContent}`
                  : trimmedContent;
              }
              // If this contains a closing bracket, it's the end of the medication name
              else if (trimmedContent.includes("]")) {
                currentMedication = currentMedication
                  ? `${currentMedication} ${trimmedContent}`
                  : trimmedContent;

                // Process any remaining content after the bracket as instructions
                const afterBracket = trimmedContent.split("]")[1];
                if (afterBracket && afterBracket.trim()) {
                  currentInstructions = currentInstructions
                    ? `${currentInstructions} ${afterBracket.trim()}`
                    : afterBracket.trim();
                }
              }
              // If this is a continuation from comments/additional info
              else if (!isNewMedicationLine(columns) && currentInstructions) {
                currentInstructions += `; <strong>${columns[0].trim()}</strong>`;
              }
              // Otherwise treat as medication name continuation
              else {
                currentMedication = currentMedication
                  ? `${currentMedication} ${trimmedContent}`
                  : trimmedContent;
              }
            }

            // Handle instructions column
            if (columns[1]) {
              currentInstructions = currentInstructions
                ? `${currentInstructions} ${columns[1].trim()}`
                : columns[1].trim();
            }

            // Handle any additional columns
            const additionalContent = columns
              .slice(2)
              .filter((col) => col.trim())
              .join(" ");
            if (additionalContent) {
              currentInstructions += `; <strong>${additionalContent}</strong>`;
            }
          }
        }

        // Add final entry if exists
        if (currentMedication) {
          processedRows.push(
            [
              currentMedication,
              currentInstructions || "",
              currentComments || "",
            ].join("\t")
          );
        }

        return processedRows.join("\n");
      }
      function isDischargeMedicationFormat(data) {
        try {
          const cleanedData = cleanInputData(data);
          const rows = cleanedData.split("\n").filter((row) => row.trim());

          // Look for either header pattern
          return rows.some(
            (row) =>
              row.trim() === "- Medications" ||
              row.trim() === "Medications Prescribed on Discharge"
          );
        } catch (error) {
          console.error("Error in isDischargeMedicationFormat:", error);
          return false;
        }
      }

      function formatDischargeMedicationData(data) {
        let processedRows = [];
        processedRows.push(["Medication", "Instructions"].join("\t"));

        // Find the start of medication list
        const rows = data.split(/\n/).filter((row) => row.trim());
        let startIndex = -1;

        // Look for either header and start after it
        for (let i = 0; i < rows.length; i++) {
          if (rows[i].trim() === "Medications Prescribed on Discharge") {
            startIndex = i + 1;
            break;
          }
        }

        if (startIndex === -1) {
          for (let i = 0; i < rows.length; i++) {
            if (rows[i].trim() === "- Medications") {
              startIndex = i + 1;
              break;
            }
          }
        }

        // If we found a starting point, process the medications
        if (startIndex !== -1) {
          for (let i = startIndex; i < rows.length; i++) {
            const line = rows[i].trim();
            if (!line) continue; // Skip empty lines

            // Check for medication format with square brackets
            const medicationMatch = line.match(/(.*?)\[(.*?)\](.*)/);
            if (medicationMatch) {
              const medicationName =
                medicationMatch[1].trim() +
                " [" +
                medicationMatch[2].trim() +
                "]";
              const instructions = medicationMatch[3]
                .replace(/^,\s*/, "")
                .trim();
              processedRows.push([medicationName, instructions].join("\t"));
            }
          }
        }

        return processedRows.join("\n");
      }
      function isGNCRFormat(data) {
        try {
          if (!data || typeof data !== "string") {
            console.log("GNCR Format Check: Invalid data type or empty");
            return false;
          }

          const cleanedData = cleanInputData(data);
          const rows = cleanedData.split("\n").filter((row) => row.trim());

          if (rows.length === 0) {
            console.log("GNCR Format Check: No rows after filtering");
            return false;
          }

          const headerRow = rows[0].trim();
          const headers = headerRow
            .split("\t")
            .map((h) => h.trim().toLowerCase());
          const requiredHeaders = ["medication item", "dosage instruction"];
          const hasRequiredHeaders = requiredHeaders.every((header) =>
            headers.includes(header)
          );

          return hasRequiredHeaders;
        } catch (error) {
          console.error("GNCR Format check error:", error);
          return false;
        }
      }

      function formatGNCRData(data) {
        try {
          const rows = data.split("\n").filter((row) => row.trim());
          console.log("Initial row count:", rows.length);

          let processedRows = [];
          processedRows.push(
            ["Medication", "Instructions", "Comments"].join("\t")
          );

          // Get header indices for required and optional columns
          const headers = rows[0]
            .split("\t")
            .map((h) => h.trim().toLowerCase());
          const medicationIdx = headers.indexOf("medication item");
          const instructionIdx = headers.indexOf("dosage instruction");
          const quantityIdx = headers.indexOf("quantity"); // May be -1 if not present
          const issueDateIdx = headers.indexOf("issue date"); // May be -1 if not present

          console.log("Column indices:", {
            medicationIdx,
            instructionIdx,
            quantityIdx,
            issueDateIdx,
          });

          // Get all additional column indices (any column that isn't one of the main ones)
          const mainIndices = [
            medicationIdx,
            instructionIdx,
            quantityIdx,
            issueDateIdx,
          ].filter((idx) => idx !== -1);
          const additionalColumnIndices = [];
          for (let i = 0; i < headers.length; i++) {
            if (!mainIndices.includes(i)) {
              additionalColumnIndices.push(i);
            }
          }

          console.log("Additional column indices:", additionalColumnIndices);

          // List of rows to exclude
          const excludeTerms = [
            "acute medication",
            "repeat medication",
            "no recent acute medications",
            "no recent repeat medications",
          ];

          // Process each row starting after header
          for (let i = 1; i < rows.length; i++) {
            const row = rows[i];
            const columns = row.split("\t");

            // Skip if medication column matches any exclude terms
            if (
              columns[medicationIdx] &&
              excludeTerms.includes(columns[medicationIdx].trim().toLowerCase())
            ) {
              console.log("Skipping excluded row:", columns[medicationIdx]);
              continue;
            }

            // Process row if it has a medication
            if (columns[medicationIdx] && columns[medicationIdx].trim()) {
              // Collect additional column information with headers
              const additionalInfo = additionalColumnIndices
                .map((idx) => {
                  if (columns[idx] && columns[idx].trim()) {
                    return `<strong>${headers[idx]}: ${columns[
                      idx
                    ].trim()}</strong>`;
                  }
                  return null;
                })
                .filter(Boolean)
                .join("; ");

              // Create instructions string (just the dosage instruction)
              let instructions = columns[instructionIdx]
                ? columns[instructionIdx].trim()
                : "";
              if (additionalInfo) {
                instructions += instructions
                  ? `; ${additionalInfo}`
                  : additionalInfo;
              }

              // Create comments string including quantity and issue date if present
              const commentParts = [];
              if (quantityIdx !== -1 && columns[quantityIdx]) {
                commentParts.push(`Quantity: ${columns[quantityIdx].trim()}`);
              }
              if (issueDateIdx !== -1 && columns[issueDateIdx]) {
                commentParts.push(
                  `Issue Date: ${columns[issueDateIdx].trim()}`
                );
              }
              const comments = commentParts.join(", ");

              processedRows.push(
                [columns[medicationIdx].trim(), instructions, comments].join(
                  "\t"
                )
              );
            }
          }

          console.log("Final processed row count:", processedRows.length);
          return processedRows.join("\n");
        } catch (error) {
          console.error("Error formatting GNCR data:", error);
          return "Medication\tInstructions\tComments";
        }
      }
      function formatGNCRRow(data) {
        try {
          console.log("Formatting row data:", data);

          // Combine instructions and comments with semicolon and bold comments
          let instructions = data.instructions;
          if (data.comments) {
            instructions = `${instructions}; <strong>${data.comments}</strong>`;
          }

          // Build metadata comments
          let comments = [];
          if (data.quantity) {
            comments.push(`Quantity: ${data.quantity}`);
          }
          if (data.issueDate) {
            comments.push(`Issue Date: ${data.issueDate}`);
          }

          const formattedRow = [
            data.medication,
            instructions.trim(),
            comments.join(", "),
          ].join("\t");

          console.log("Formatted row output:", formattedRow);
          return formattedRow;
        } catch (error) {
          console.error("Error formatting row:", error);
          return `${data.medication || ""}\t${data.instructions || ""}\t`;
        }
      }

      function isRecentTTOFormat(data) {
        const cleanedData = cleanInputData(data);
        const lines = cleanedData.split("\n");
        const headerLine = lines[0].trim();
        return (
          headerLine.includes("Medication") &&
          headerLine.includes("Dosage Information")
        );
      }

      function formatRecentTTOData(data) {
        console.log("Formatting RecentTTO data...");
        const rows = data.split("\n");
        let processedRows = [];
        processedRows.push(
          ["Medication", "Instructions", "Comments"].join("\t")
        );

        // Header row remains unchanged
        for (let i = 1; i < rows.length; i++) {
          const row = rows[i].trim();
          if (!row) continue;

          // Split by tab character
          const columns = row.split("\t");
          if (columns.length < 2) continue;

          const medication = columns[0].trim();
          let instructions = columns[1].trim();
          let comments = columns[2] ? columns[2].trim() : "";

          // Special handling for double-spaced instructions
          if (instructions.includes("  ")) {
            const parts = instructions.split(/\s{2,}/);
            instructions = parts.join(" ");
          }

          processedRows.push([medication, instructions, comments].join("\t"));
        }

        return processedRows.join("\n");
      }
      function isMSXLFormat(data) {
        const cleanedData = cleanInputData(data);
        const lines = cleanedData.split("\n").filter((line) => line.trim());
        if (lines.length === 0) return false;

        const firstLine = lines[0].trim();
        return (
          firstLine.includes("Last Issue") &&
          firstLine.includes("Drug / Dosage / Quantity")
        );
      }
      function formatMSXLData(data) {
        console.log("Formatting MSXL data...");
        const rows = data.split("\n").filter((row) => row.trim());
        let processedRows = [];
        processedRows.push(
          ["Medication", "Instructions", "Comments"].join("\t")
        );

        // Parse headers more carefully
        const headerRow = rows[0];
        const headerColumns = headerRow
          .split(/\t|\s{2,}/)
          .filter((h) => h.trim());
        console.log("Header columns:", headerColumns);

        // Helper function to split by commas while respecting parentheses
        function splitRespectingParentheses(str) {
          let parts = [];
          let currentPart = "";
          let parenthesesCount = 0;

          for (let i = 0; i < str.length; i++) {
            if (str[i] === "(") parenthesesCount++;
            if (str[i] === ")") parenthesesCount--;

            if (str[i] === "," && parenthesesCount === 0) {
              parts.push(currentPart.trim());
              currentPart = "";
            } else {
              currentPart += str[i];
            }
          }

          if (currentPart) {
            parts.push(currentPart.trim());
          }

          return parts;
        }

        // Process each line
        for (let i = 1; i < rows.length; i++) {
          const row = rows[i].trim();
          if (
            !row ||
            row === "Acute Medication" ||
            row === "Repeat Medication"
          ) {
            console.log("Skipping row:", row);
            continue;
          }

          console.log("\nProcessing row:", row);

          // Split the row by tabs or multiple spaces
          const rowParts = row.split(/\t|\s{2,}/).filter((part) => part.trim());
          console.log("Row parts:", rowParts);

          if (rowParts.length < 2) continue;

          const lastIssue = rowParts[0].trim();
          const drugInfo = rowParts[1].trim();

          // Process additional columns with their actual headers
          const additionalInfo = [];
          for (let j = 2; j < rowParts.length; j++) {
            const value = rowParts[j].trim();
            if (value && headerColumns[j]) {
              additionalInfo.push(
                `<strong>${headerColumns[j]}: ${value}</strong>`
              );
            }
          }

          // Split drug info using parentheses-aware splitting
          const drugParts = splitRespectingParentheses(drugInfo);
          if (drugParts.length < 2) continue;

          const medication = drugParts[0].trim();
          const dosageInstructions = drugParts.slice(1, -1).join(",").trim();
          const quantity = drugParts[drugParts.length - 1].trim();

          // Combine instructions with additional info
          let instructions = dosageInstructions;
          if (additionalInfo.length > 0) {
            instructions += "; " + additionalInfo.join("; ");
          }

          // Create comments
          const comments = [`Last Issue: ${lastIssue}`, `Quantity: ${quantity}`]
            .filter(Boolean)
            .join(", ");

          processedRows.push([medication, instructions, comments].join("\t"));
        }

        return processedRows.join("\n");
      }
      function formatRow(data) {
        try {
          // Combine instructions and patient comments
          let instructions = data.instructions;
          if (data.comments) {
            instructions = `${instructions} (${data.comments})`;
          }

          // Format comments section with quantity and issue date
          let comments = [];
          if (data.quantity) {
            comments.push(`Quantity: ${data.quantity}`);
          }
          if (data.issueDate) {
            comments.push(`Issue Date: ${data.issueDate}`);
          }

          const formattedRow = [
            data.medication,
            instructions.trim(),
            comments.join(", "),
          ].join("\t");

          console.log("Formatted row:", formattedRow);
          return formattedRow;
        } catch (error) {
          console.error("Row formatting error:", error);
          return null;
        }
      }
      function formatProcessedRow(row) {
        // Clean up and format the instructions
        let instructions = row.instructions || "";
        if (row.comments) {
          instructions = instructions
            ? `${instructions} (${row.comments})`
            : row.comments;
        }

        // Build comments combining quantity and issue date
        let comments = [];
        if (row.quantity) {
          comments.push(`Quantity: ${row.quantity}`);
        }
        if (row.issueDate) {
          comments.push(`Issue Date: ${row.issueDate.replace(/\n/g, " ")}`);
        }

        return [row.medication, instructions.trim(), comments.join(", ")].join(
          "\t"
        );
      }
      function convertToTable(data, listNumber, format) {
        const rows = data.split("\n");
        const title = getFormatTitle(format, listNumber);

        let tableHTML = `
        <h2>${title}</h2>
        <div class="table-controls">
            <button onclick="resetTable(${listNumber})" class="reset-btn">Reset Table</button>
            <button onclick="mergeSelectedRows(${listNumber})" class="merge-btn">Merge Selected</button>
            <button onclick="deleteSelectedRows(${listNumber})" class="delete-btn">Delete Selected</button>
        </div>
        <table class="data-table">
            <thead>
                <tr>
                    <th class="select-header">Select</th>
                    <th>Medication</th>
                    <th>Instructions</th>
                    <th>Comments</th>
                </tr>
            </thead>
            <tbody>`;

        for (let i = 1; i < rows.length; i++) {
          const columns = rows[i].split("\t");
          if (columns.length >= 2) {
            tableHTML += `
                <tr data-row="${i}">
                    <td class="select-cell">
                        <input type="checkbox" class="row-select" onchange="updateRowSelection(this)">
                    </td>
                    <td class="table-cell" contenteditable="true">${
                      columns[0] || "—"
                    }</td>
                    <td class="table-cell" contenteditable="true">${
                      columns[1] || "—"
                    }</td>
                    <td class="table-cell" contenteditable="true">${
                      columns[2] || "—"
                    }</td>
                </tr>`;
          }
        }

        tableHTML += `</tbody></table>`;

        const tableContainer = document.getElementById(
          `table${listNumber}Container`
        );
        tableContainer.dataset.originalData = data;
        tableContainer.dataset.format = format;
        tableContainer.innerHTML = tableHTML;

        addTableStyles();
      }

      function addTableStyles() {
        if (document.getElementById("table-styles")) return;

        const style = document.createElement("style");
        style.id = "table-styles";
        style.textContent = `
        * {
            font-family: Verdana, sans-serif;
            font-size: 10pt;
        }

        h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 12pt;
            font-weight: 600;
            font-family: Verdana, sans-serif;
        }

        .table-controls {
            margin-bottom: 10px;
            display: flex;
            gap: 10px;
        }
        
        .reset-btn, .delete-btn, .merge-btn {
            font-family: Verdana, sans-serif;
            font-size: 10pt;
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }
        
        .reset-btn {
            background-color: #2196F3;
            color: white;
        }
        
        .delete-btn {
            background-color: #f44336;
            color: white;
        }

        .merge-btn {
            background-color: #FF9800;
            color: white;
        }

        .merge-btn:hover {
            background-color: #F57C00;
        }

        .data-table {
            font-family: Verdana, sans-serif;
            font-size: 10pt;
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        
        .data-table th, .data-table td {
            font-family: Verdana, sans-serif;
            font-size: 10pt;
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        .data-table td.table-cell {
            min-width: 150px;
            max-width: 300px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: normal;
            word-wrap: break-word;
            font-family: Verdana, sans-serif;
            font-size: 10pt;
        }

        .select-header, .select-cell {
            width: 50px;
            text-align: center !important;
        }
        
        .data-table th {
            background-color: #f5f5f5;
            font-weight: 600;
        }
        
        .table-cell {
            position: relative;
            min-height: 1.2em;
        }
        
        .table-cell:focus {
            outline: 2px solid #2196F3;
            background-color: #fff;
            padding: 7px;
        }
        
        .table-cell:empty::before {
            content: '—';
            color: #999;
        }
        
        .data-table tr.selected {
            background-color: #e3f2fd;
        }
        
        .row-select {
            cursor: pointer;
            width: 16px;
            height: 16px;
        }

        .table-container h2 {
            margin-top: 0;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
            font-family: Verdana, sans-serif;
            font-size: 12pt;
        }
    `;
        document.head.appendChild(style);
      }
      function initializeTableBehavior(listNumber) {
        const table = document.querySelector(
          `#table${listNumber}Container table`
        );

        // Cell editing behavior
        table.querySelectorAll('td[contenteditable="true"]').forEach((cell) => {
          cell.addEventListener("blur", () => {
            cell.textContent = cell.textContent.trim() || "—";
          });

          cell.addEventListener("keydown", (e) => {
            if (e.key === "Enter") {
              e.preventDefault();
              cell.blur();
            }
          });
        });
      }

      function updateRowSelection(checkbox) {
        const row = checkbox.closest("tr");
        row.classList.toggle("selected", checkbox.checked);
      }

      function deleteSelectedRows(listNumber) {
        const table = document.querySelector(
          `#table${listNumber}Container table`
        );
        const selectedRows = table.querySelectorAll("input.row-select:checked");

        if (selectedRows.length === 0) {
          alert("No rows selected");
          return;
        }

        if (confirm(`Delete ${selectedRows.length} selected row(s)?`)) {
          selectedRows.forEach((checkbox) => {
            checkbox.closest("tr").remove();
          });
        }
      }

      function resetTable(listNumber) {
        const tableContainer = document.getElementById(
          `table${listNumber}Container`
        );
        const originalData = tableContainer.dataset.originalData;
        const format = tableContainer.dataset.format;

        if (confirm("Reset table to original data?")) {
          convertToTable(originalData, listNumber, format);
        }
      }
      // Toggle between table and textarea views
      function toggleEdit(listNumber) {
        const textarea = document.getElementById(`list${listNumber}`);
        const tableContainer = document.getElementById(
          `table${listNumber}Container`
        );

        if (textarea.classList.contains("hidden")) {
          textarea.classList.remove("hidden");
          tableContainer.classList.add("hidden");
        } else {
          textarea.classList.add("hidden");
          tableContainer.classList.remove("hidden");
          const format = tableContainer.dataset.format;
          convertToTable(textarea.value, listNumber, format);
        }
      }

      function processList(listNumber) {
        const text = document.getElementById(`list${listNumber}`).value;
        const cleanedText = cleanInputData(text);
        let format = "";

        // Check format before processing
        if (isGNCRFormat(cleanedText)) {
          format = "GNCR";
        } else if (isCurrentMedsFormat(cleanedText)) {
          format = "CURRENT_MEDS";
        } else if (isHMTFormat(cleanedText)) {
          format = "HMT";
        } else if (isDischargeMedicationFormat(cleanedText)) {
          format = "DISCHARGE";
        } else if (isRecentTTOFormat(cleanedText)) {
          format = "RECENT_TTO";
        } else if (isMSXLFormat(cleanedText)) {
          format = "MSXL";
        }

        console.log("Detected format:", format);

        const processedData = processInputData(cleanedText);

        if (processedData) {
          convertToTable(processedData, listNumber, format);
        } else {
          console.warn("Unable to process data - format not recognized");
        }
      }
      function getFormatTitle(format, listNumber) {
        switch (format) {
          case "HMT":
          case "MSXL":
          case "RECENT_TTO":
          case "GNCR":
            return `List ${listNumber} (medication history)`;
          case "CURRENT_MEDS":
            return `List ${listNumber} (current medications)`;
          case "DISCHARGE":
            return `List ${listNumber} (discharge medications)`;
          default:
            return `List ${listNumber}`;
        }
      }
      function getFormatTitleForComparison(format, listNumber) {
        let baseTitle;
        switch (format) {
          case "HMT":
          case "MSXL":
          case "RECENT_TTO":
          case "GNCR":
            baseTitle = "Medication History";
            break;
          case "CURRENT_MEDS":
            baseTitle = "Current Medications";
            break;
          case "DISCHARGE":
            baseTitle = "Discharge Medications";
            break;
          default:
            baseTitle = "Medication List";
        }
        return `${baseTitle} (List ${listNumber})`;
      }
      function getListTypeHeader(format) {
        switch (format) {
          case "HMT":
          case "MSXL":
          case "RECENT_TTO":
          case "GNCR":
            return "Medication History";
          case "CURRENT_MEDS":
            return "Current Medications";
          case "DISCHARGE":
            return "Discharge Medications";
          default:
            return "Medication Details";
        }
      }

      function handlePaste(event, listNumber) {
        // Prevent the default paste behavior
        event.preventDefault();

        // Get the clipboard data as text
        const text = event.clipboardData.getData("text");

        // Set the textarea value
        event.target.value = text;

        // Process the list immediately after paste
        processList(listNumber);
      }
    </script>
  </body>
</html>
